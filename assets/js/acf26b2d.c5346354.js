"use strict";(self.webpackChunkmeoo_space=self.webpackChunkmeoo_space||[]).push([[4130],{3905:(r,e,t)=>{t.d(e,{Zo:()=>c,kt:()=>k});var n=t(7294);function a(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function o(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),t.push.apply(t,n)}return t}function l(r){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?o(Object(t),!0).forEach((function(e){a(r,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(t,e))}))}return r}function i(r,e){if(null==r)return{};var t,n,a=function(r,e){if(null==r)return{};var t,n,a={},o=Object.keys(r);for(n=0;n<o.length;n++)t=o[n],e.indexOf(t)>=0||(a[t]=r[t]);return a}(r,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(r);for(n=0;n<o.length;n++)t=o[n],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(r,t)&&(a[t]=r[t])}return a}var p=n.createContext({}),u=function(r){var e=n.useContext(p),t=e;return r&&(t="function"==typeof r?r(e):l(l({},e),r)),t},c=function(r){var e=u(r.components);return n.createElement(p.Provider,{value:e},r.children)},s={inlineCode:"code",wrapper:function(r){var e=r.children;return n.createElement(n.Fragment,{},e)}},g=n.forwardRef((function(r,e){var t=r.components,a=r.mdxType,o=r.originalType,p=r.parentName,c=i(r,["components","mdxType","originalType","parentName"]),g=u(t),k=a,m=g["".concat(p,".").concat(k)]||g[k]||s[k]||o;return t?n.createElement(m,l(l({ref:e},c),{},{components:t})):n.createElement(m,l({ref:e},c))}));function k(r,e){var t=arguments,a=e&&e.mdxType;if("string"==typeof r||a){var o=t.length,l=new Array(o);l[0]=g;var i={};for(var p in e)hasOwnProperty.call(e,p)&&(i[p]=e[p]);i.originalType=r,i.mdxType="string"==typeof r?r:a,l[1]=i;for(var u=2;u<o;u++)l[u]=t[u];return n.createElement.apply(null,l)}return n.createElement.apply(null,t)}g.displayName="MDXCreateElement"},6779:(r,e,t)=>{t.r(e),t.d(e,{assets:()=>p,contentTitle:()=>l,default:()=>s,frontMatter:()=>o,metadata:()=>i,toc:()=>u});var n=t(7462),a=(t(7294),t(3905));const o={sidebar_position:1,title:"3\u79cd\u65b9\u5f0f\uff01Go Error\u5904\u7406\u6700\u4f73\u5b9e\u8df5",slug:"/3\u79cd\u65b9\u5f0f\uff01Go Error\u5904\u7406\u6700\u4f73\u5b9e\u8df5"},l=void 0,i={unversionedId:"notes/wechat/3\u79cd\u65b9\u5f0f\uff01Go Error\u5904\u7406\u6700\u4f73\u5b9e\u8df5",id:"notes/wechat/3\u79cd\u65b9\u5f0f\uff01Go Error\u5904\u7406\u6700\u4f73\u5b9e\u8df5",title:"3\u79cd\u65b9\u5f0f\uff01Go Error\u5904\u7406\u6700\u4f73\u5b9e\u8df5",description:"Untitled",source:"@site/docs/notes/wechat/3\u79cd\u65b9\u5f0f\uff01Go Error\u5904\u7406\u6700\u4f73\u5b9e\u8df5.md",sourceDirName:"notes/wechat",slug:"/3\u79cd\u65b9\u5f0f\uff01Go Error\u5904\u7406\u6700\u4f73\u5b9e\u8df5",permalink:"/docs/3\u79cd\u65b9\u5f0f\uff01Go Error\u5904\u7406\u6700\u4f73\u5b9e\u8df5",draft:!1,editUrl:"https://github.com/science09/science09.github.io/tree/main/docs/notes/wechat/3\u79cd\u65b9\u5f0f\uff01Go Error\u5904\u7406\u6700\u4f73\u5b9e\u8df5.md",tags:[],version:"current",lastUpdatedBy:"zhaofeng.luo",sidebarPosition:1,frontMatter:{sidebar_position:1,title:"3\u79cd\u65b9\u5f0f\uff01Go Error\u5904\u7406\u6700\u4f73\u5b9e\u8df5",slug:"/3\u79cd\u65b9\u5f0f\uff01Go Error\u5904\u7406\u6700\u4f73\u5b9e\u8df5"},sidebar:"notes",previous:{title:"\u56fe\u6587\u7ed3\u5408\uff01Redis\u5ef6\u8fdf\u961f\u5217golang\u9ad8\u6548\u5b9e\u8df5",permalink:"/docs/\u56fe\u6587\u7ed3\u5408\uff01Redis\u5ef6\u8fdf\u961f\u5217golang\u9ad8\u6548\u5b9e\u8df5"},next:{title:"\u63a8\u8350\u7cfb\u7edf embedding \u6280\u672f\u5b9e\u8df5\u603b\u7ed3",permalink:"/docs/\u63a8\u8350\u7cfb\u7edf embedding \u6280\u672f\u5b9e\u8df5\u603b\u7ed3"}},p={},u=[{value:"1\u3001\u9519\u8bef\u4e0e\u5f02\u5e38",id:"1\u9519\u8bef\u4e0e\u5f02\u5e38",level:2},{value:"1.1\uff09Error",id:"11error",level:3},{value:"1.2\uff09Exception",id:"12exception",level:3},{value:"1.3\uff09panic",id:"13panic",level:3},{value:"1.4\uff09\u603b\u7ed3",id:"14\u603b\u7ed3",level:3},{value:"\u4e8c\u3001Go\u5904\u7406\u9519\u8bef\u7684\u4e09\u79cd\u65b9\u5f0f",id:"\u4e8cgo\u5904\u7406\u9519\u8bef\u7684\u4e09\u79cd\u65b9\u5f0f",level:2},{value:"2.1\uff09\u7ecf\u5178Go\u903b\u8f91",id:"21\u7ecf\u5178go\u903b\u8f91",level:3},{value:"2.2\uff09\u5c4f\u853d\u8fc7\u7a0b\u4e2d\u7684error\u7684\u5904\u7406",id:"22\u5c4f\u853d\u8fc7\u7a0b\u4e2d\u7684error\u7684\u5904\u7406",level:3},{value:"2.3\uff09\u5229\u7528\u51fd\u6570\u5f0f\u7f16\u7a0b\u5ef6\u8fdf\u8fd0\u884c",id:"23\u5229\u7528\u51fd\u6570\u5f0f\u7f16\u7a0b\u5ef6\u8fdf\u8fd0\u884c",level:2},{value:"2.4\uff09\u4e09\u79cd\u65b9\u5f0f\u5bf9\u6bd4",id:"24\u4e09\u79cd\u65b9\u5f0f\u5bf9\u6bd4",level:3},{value:"\u4e09\u3001\u5206\u5c42\u4e0b\u7684Error Handling",id:"\u4e09\u5206\u5c42\u4e0b\u7684error-handling",level:2},{value:"3.1\uff09\u4e00\u4e2a\u5e38\u89c1\u7684\u4e09\u5c42\u8c03\u7528",id:"31\u4e00\u4e2a\u5e38\u89c1\u7684\u4e09\u5c42\u8c03\u7528",level:3},{value:"3.2\uff09\u95ee\u9898\u603b\u7ed3",id:"32\u95ee\u9898\u603b\u7ed3",level:3},{value:"3.3\uff09Wrap erros",id:"33wrap-erros",level:3},{value:"\u56db\u3001errgroup\u96c6\u4e2d\u9519\u8bef\u5904\u7406",id:"\u56dberrgroup\u96c6\u4e2d\u9519\u8bef\u5904\u7406",level:2},{value:"4.1\uff09\u80cc\u666f",id:"41\u80cc\u666f",level:3},{value:"4.2\uff09errgroup\u51fd\u6570\u7b7e\u540d",id:"42errgroup\u51fd\u6570\u7b7e\u540d",level:3},{value:"4.3\uff09\u4f7f\u7528\u6848\u4f8b",id:"43\u4f7f\u7528\u6848\u4f8b",level:3},{value:"4.4\uff09errgroup\u62d3\u5c55\u5305",id:"44errgroup\u62d3\u5c55\u5305",level:3}],c={toc:u};function s(r){let{components:e,...o}=r;return(0,a.kt)("wrapper",(0,n.Z)({},c,o,{components:e,mdxType:"MDXLayout"}),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Untitled",src:t(8170).Z,width:"1080",height:"461"})),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"\u5bfc\u8bed "),"| \u9519\u8bef\u5904\u7406\u4e00\u76f4\u4ee5\u4e00\u662f\u7f16\u7a0b\u5fc5\u9700\u8981\u9762\u5bf9\u7684\u95ee\u9898\uff0c\u9519\u8bef\u5904\u7406\u5982\u679c\u505a\u7684\u597d\u7684\u8bdd\uff0c\u4ee3\u7801\u7684\u7a33\u5b9a\u6027\u4f1a\u5f88\u597d\u3002\u4e0d\u540c\u7684\u8bed\u8a00\u6709\u4e0d\u540c\u7684\u51fa\u73b0\u5904\u7406\u7684\u65b9\u5f0f\u3002Go\u8bed\u8a00\u4e5f\u4e00\u6837\uff0c\u5728\u672c\u7bc7\u6587\u7ae0\u4e2d\uff0c\u6211\u4eec\u6765\u8ba8\u8bba\u4e00\u4e0bGo\u8bed\u8a00\u7684\u9519\u8bef\u5904\u7406\u65b9\u5f0f\u3002"),(0,a.kt)("h2",{id:"1\u9519\u8bef\u4e0e\u5f02\u5e38"},"1\u3001\u9519\u8bef\u4e0e\u5f02\u5e38"),(0,a.kt)("h3",{id:"11error"},"1.1\uff09Error"),(0,a.kt)("p",null,"\u9519\u8bef\u662f\u7a0b\u5e8f\u4e2d\u53ef\u80fd\u51fa\u73b0\u7684\u95ee\u9898\uff0c\u6bd4\u5982\u8fde\u63a5\u6570\u636e\u5e93\u5931\u8d25\uff0c\u8fde\u63a5\u7f51\u7edc\u5931\u8d25\u7b49\uff0c\u5728\u7a0b\u5e8f\u8bbe\u8ba1\u4e2d\uff0c\u9519\u8bef\u5904\u7406\u662f\u4e1a\u52a1\u7684\u4e00\u90e8\u5206\u3002"),(0,a.kt)("p",null,"Go\u5185\u5efa\u4e00\u4e2aerror\u63a5\u53e3\u7c7b\u578b\u4f5c\u4e3ago\u7684\u9519\u8bef\u6807\u51c6\u5904\u7406"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"http://golang.org/pkg/builtin/#error"},"http://golang.org/pkg/builtin/#error")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},"// \u63a5\u53e3\u5b9a\u4e49\ntype error interface {\n   Error() string\n}\n")),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"http://golang.org/src/pkg/errors/errors.go"},"http://golang.org/src/pkg/errors/errors.go")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-plain",metastring:"text",text:!0},"// \u5b9e\u73b0\nfunc New(text string) error {\n   return &errorString{text}\n}\n\ntype errorString struct {\n   s string\n}\n\nfunc (e *errorString) Error() string {\n   return e.s\n}\n")),(0,a.kt)("h3",{id:"12exception"},"1.2\uff09Exception"),(0,a.kt)("p",null,"\u5f02\u5e38\u662f\u6307\u5728\u4e0d\u8be5\u51fa\u73b0\u95ee\u9898\u7684\u5730\u65b9\u51fa\u73b0\u95ee\u9898\uff0c\u662f\u9884\u6599\u4e4b\u5916\u7684\uff0c\u6bd4\u5982\u7a7a\u6307\u9488\u5f15\u7528\uff0c\u4e0b\u6807\u8d8a\u754c\uff0c\u5411\u7a7amap\u6dfb\u52a0\u952e\u503c\u7b49\u3002"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"\u4eba\u4e3a\u5236\u9020\u88ab\u81ea\u52a8\u89e6\u53d1\u7684\u5f02\u5e38\uff0c\u6bd4\u5982\uff1a\u6570\u7ec4\u8d8a\u754c\uff0c\u5411\u7a7amap\u6dfb\u52a0\u952e\u503c\u5bf9\u7b49\u3002")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"\u624b\u5de5\u89e6\u53d1\u5f02\u5e38\u5e76\u7ec8\u6b62\u5f02\u5e38\uff0c\u6bd4\u5982\uff1a\u8fde\u63a5\u6570\u636e\u5e93\u5931\u8d25\u4e3b\u52a8panic\u3002"))),(0,a.kt)("h3",{id:"13panic"},"1.3\uff09panic"),(0,a.kt)("p",null,"\u5bf9\u4e8e\u771f\u6b63\u610f\u5916\u7684\u60c5\u51b5\uff0c\u90a3\u4e9b\u8868\u793a\u4e0d\u53ef\u6062\u590d\u7684\u7a0b\u5e8f\u9519\u8bef\uff0c\u4e0d\u53ef\u6062\u590d\u624d\u4f7f\u7528panic\u3002\u5bf9\u4e8e\u5176\u4ed6\u7684\u9519\u8bef\u60c5\u51b5\uff0c\u6211\u4eec\u5e94\u8be5\u662f\u671f\u671b\u4f7f\u7528error\u6765\u8fdb\u884c\u5224\u5b9a\u3002"),(0,a.kt)("p",null,"go\u6e90\u4ee3\u7801\u5f88\u591a\u5730\u65b9\u5199panic, \u4f46\u662f\u5de5\u7a0b\u5b9e\u8df5\u4e1a\u52a1\u4ee3\u7801\u4e0d\u8981\u4e3b\u52a8\u5199panic\uff0c\u7406\u8bba\u4e0apanic\u53ea\u5b58\u5728\u4e8eserver\u542f\u52a8\u9636\u6bb5\uff0c\u6bd4\u5982config\u6587\u4ef6\u89e3\u6790\u5931\u8d25\uff0c\u7aef\u53e3\u76d1\u542c\u5931\u8d25\u7b49\u7b49\uff0c\u6240\u6709\u4e1a\u52a1\u903b\u8f91\u7981\u6b62\u4e3b\u52a8panic\uff0c\u6240\u6709\u5f02\u6b65\u7684goroutine\u90fd\u8981\u7528recover\u53bb\u515c\u5e95\u5904\u7406\u3002"),(0,a.kt)("h3",{id:"14\u603b\u7ed3"},"1.4\uff09\u603b\u7ed3"),(0,a.kt)("p",null,"\u7406\u89e3\u4e86\u9519\u8bef\u548c\u5f02\u5e38\u7684\u771f\u6b63\u542b\u4e49\uff0c\u6211\u4eec\u5c31\u80fd\u7406\u89e3Go\u7684\u9519\u8bef\u548c\u5f02\u5e38\u5904\u7406\u7684\u8bbe\u8ba1\u610f\u56fe\u3002\u4f20\u7edf\u7684try...catch...\u7ed3\u6784\uff0c\u5f88\u5bb9\u6613\u8ba9\u5f00\u53d1\u4eba\u5458\u628a\u9519\u8bef\u548c\u5f02\u5e38\u6df7\u4e3a\u4e00\u8c08\uff0c\u751a\u81f3\u628a\u4e1a\u52a1\u9519\u8bef\u5904\u7406\u7684\u4e00\u90e8\u5206\u5f53\u505a\u5f02\u5e38\u6765\u5904\u7406\uff0c\u4e8e\u662f\u4f60\u4f1a\u5728\u7a0b\u5e8f\u4e2d\u770b\u5230\u4e00\u5927\u5806\u7684catch..."),(0,a.kt)("p",null,"Go\u5f00\u53d1\u56e2\u961f\u8ba4\u4e3a\u9519\u8bef\u5e94\u8be5\u660e\u786e\u5730\u5f53\u6210\u4e1a\u52a1\u7684\u4e00\u90e8\u5206\uff0c\u4efb\u4f55\u53ef\u4ee5\u9884\u89c1\u7684\u95ee\u9898\u90fd\u9700\u8981\u505a\u9519\u8bef\u5904\u7406\uff0c\u4e8e\u662f\u5728Go\u4ee3\u7801\u4e2d\uff0c\u4efb\u4f55\u8c03\u7528\u8005\u5728\u63a5\u6536\u51fd\u6570\u8fd4\u56de\u503c\u7684\u540c\u65f6\u4e5f\u9700\u8981\u5bf9\u9519\u8bef\u8fdb\u884c\u5904\u7406\uff0c\u4ee5\u9632\u9057\u6f0f\u4efb\u4f55\u8fd0\u884c\u65f6\u53ef\u80fd\u7684\u9519\u8bef\u3002"),(0,a.kt)("p",null,"\u5f02\u5e38\u5219\u662f\u610f\u6599\u4e4b\u5916\u7684\uff0c\u751a\u81f3\u4f60\u8ba4\u4e3a\u5728\u7f16\u7801\u4e2d\u4e0d\u53ef\u80fd\u53d1\u751f\u7684\uff0cGo\u9047\u5230\u5f02\u5e38\u4f1a\u81ea\u52a8\u89e6\u53d1panic\uff08\u6050\u614c\uff09\uff0c\u89e6\u53d1panic\u7a0b\u5e8f\u4f1a\u81ea\u52a8\u9000\u51fa\u3002\u9664\u4e86\u7a0b\u5e8f\u81ea\u52a8\u89e6\u53d1\u5f02\u5e38\uff0c\u4e00\u4e9b\u4f60\u8ba4\u4e3a\u4e0d\u53ef\u5141\u8bb8\u7684\u60c5\u51b5\u4f60\u4e5f\u53ef\u4ee5\u624b\u52a8\u89e6\u53d1\u5f02\u5e38\u3002"),(0,a.kt)("p",null,"\u53e6\u5916\uff0c\u5728Go\u4e2d\u9664\u4e86\u89e6\u53d1\u5f02\u5e38\uff0c\u8fd8\u53ef\u4ee5\u7ec8\u6b62\u5f02\u5e38\u5e76\u53ef\u9009\u7684\u5bf9\u5f02\u5e38\u8fdb\u884c\u9519\u8bef\u5904\u7406\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u9519\u8bef\u548c\u5f02\u5e38\u662f\u53ef\u4ee5\u76f8\u4e92\u8f6c\u6362\u7684\u3002"),(0,a.kt)("h2",{id:"\u4e8cgo\u5904\u7406\u9519\u8bef\u7684\u4e09\u79cd\u65b9\u5f0f"},"\u4e8c\u3001Go\u5904\u7406\u9519\u8bef\u7684\u4e09\u79cd\u65b9\u5f0f"),(0,a.kt)("h3",{id:"21\u7ecf\u5178go\u903b\u8f91"},"2.1\uff09\u7ecf\u5178Go\u903b\u8f91"),(0,a.kt)("p",null,"\u76f4\u89c2\u7684\u8fd4\u56deerror\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-plain",metastring:"text",text:!0},'type ZooTour interface {\n    Enter() error \n    VisitPanda(panda *Panda) error \n    Leave() error\n}\n\n// \u5206\u6b65\u5904\u7406\uff0c\u6bcf\u4e2a\u6b65\u9aa4\u53ef\u4ee5\u9488\u5bf9\u5177\u4f53\u8fd4\u56de\u7ed3\u679c\u8fdb\u884c\u5904\u7406\nfunc Tour(t ZooTour1, panda *Panda) error {\n    if err := t.Enter(); err != nil {\n        return errors.WithMessage(err, "Enter failed.")\n    }\n    if err := t.VisitPanda(); err != nil {\n        return errors.WithMessage(err, "VisitPanda failed.")\n    }\n    // ...\n\n    return nil\n}\n')),(0,a.kt)("h3",{id:"22\u5c4f\u853d\u8fc7\u7a0b\u4e2d\u7684error\u7684\u5904\u7406"},"2.2\uff09\u5c4f\u853d\u8fc7\u7a0b\u4e2d\u7684error\u7684\u5904\u7406"),(0,a.kt)("p",null,"\u5c06error\u4fdd\u5b58\u5230\u5bf9\u8c61\u5185\u90e8\uff0c\u5904\u7406\u903b\u8f91\u4ea4\u7ed9\u6bcf\u4e2a\u65b9\u6cd5\uff0c\u672c\u8d28\u4e0a\u4ecd\u662f\u987a\u5e8f\u6267\u884c\u3002\u6807\u51c6\u5e93\u7684bufio\u3001database/sql\u5305\u4e2d\u7684Rows\u7b49\u90fd\u662f\u8fd9\u6837\u5b9e\u73b0\u7684\uff0c\u6709\u5174\u8da3\u53ef\u4ee5\u53bb\u770b\u4e0b\u6e90\u7801\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-plain",metastring:"text",text:!0},'type ZooTour interface {\n    Enter() error\n    VisitPanda(panda *Panda) error\n    Leave() error\n    Err() error\n}\n\nfunc Tour(t ZooTour, panda *Panda) error {\n\n    t.Enter()\n    t.VisitPanda(panda)\n    t.Leave()\n    \n    // \u96c6\u4e2d\u7f16\u5199\u4e1a\u52a1\u903b\u8f91\u4ee3\u7801,\u6700\u540e\u7edf\u4e00\u5904\u7406error\n    if err := t.Err(); err != nil {\n        return errors.WithMessage(err, "ZooTour failed")\n    }\n    return nil\n}\n')),(0,a.kt)("h2",{id:"23\u5229\u7528\u51fd\u6570\u5f0f\u7f16\u7a0b\u5ef6\u8fdf\u8fd0\u884c"},"2.3\uff09\u5229\u7528\u51fd\u6570\u5f0f\u7f16\u7a0b\u5ef6\u8fdf\u8fd0\u884c"),(0,a.kt)("p",null,"\u5206\u79bb\u5173\u6ce8\u70b9-\u904d\u5386\u8bbf\u95ee\u7528\u6570\u636e\u7ed3\u6784\u5b9a\u4e49\u8fd0\u884c\u987a\u5e8f\uff0c\u6839\u636e\u573a\u666f\u9009\u62e9\uff0c\u5982\u987a\u5e8f\u3001\u9006\u5e8f\u3001\u4e8c\u53c9\u6811\u6811\u904d\u5386\u7b49\u3002\u8fd0\u884c\u903b\u8f91\u5c06\u4ee3\u7801\u7684\u63a7\u5236\u6d41\u903b\u8f91\u62bd\u79bb\uff0c\u7075\u6d3b\u8c03\u6574\u3002kubernetes\u4e2d\u7684visitor\u5bf9\u6b64\u5c31\u6709\u5f88\u591a\u79cd\u6269\u5c55\u65b9\u5f0f\uff0c\u5206\u79bb\u4e86\u6570\u636e\u548c\u884c\u4e3a\uff0c\u6709\u5174\u8da3\u53ef\u4ee5\u53bb\u6269\u5c55\u9605\u8bfb\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-plain",metastring:"text",text:!0},"type Walker interface {\n    Next MyFunc\n}\ntype SliceWalker struct {\n    index int \n    funs []MyFunc\n} \n\nfunc NewEnterFunc() MyFunc {\n    return func(t ZooTour) error {\n        return t.Enter()\n    }\n}\n\nfunc BreakOnError(t ZooTour, walker Walker) error {\n    for {\n        f := walker.Next() \n        if f == nil {\n            break\n        }\n        if err := f(t); err := nil {\n          // \u9047\u5230\u9519\u8befbreak\u6216\u8005continue\u7ee7\u7eed\u6267\u884c  \n      }\n    }\n}\n")),(0,a.kt)("h3",{id:"24\u4e09\u79cd\u65b9\u5f0f\u5bf9\u6bd4"},"2.4\uff09\u4e09\u79cd\u65b9\u5f0f\u5bf9\u6bd4"),(0,a.kt)("p",null,"\u4e0a\u9762\u8fd9\u4e09\u4e2a\u4f8b\u5b50\uff0c\u662fGo\u9879\u76ee\u5904\u7406\u9519\u8bef\u4f7f\u7528\u9891\u7387\u6700\u9ad8\u7684\u4e09\u79cd\u65b9\u5f0f\uff0c\u4e5f\u53ef\u4ee5\u5e94\u7528\u5728error\u4ee5\u5916\u7684\u5904\u7406\u903b\u8f91\u3002"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"case1: \u5982\u679c\u4e1a\u52a1\u903b\u8f91\u4e0d\u662f\u5f88\u6e05\u695a\uff0c\u6bd4\u8f83\u63a8\u8350case1\uff1b")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"case2: \u4ee3\u7801\u5f88\u5c11\u53bb\u6539\u52a8\uff0c\u7c7b\u4f3c\u6807\u51c6\u5e93\uff0c\u53ef\u4ee5\u4f7f\u7528case2\uff1b")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"case3: \u6bd4\u8f83\u590d\u6742\u7684\u573a\u666f\uff0c\u590d\u6742\u5230\u62bd\u8c61\u6210\u4e00\u79cd\u8bbe\u8ba1\u6a21\u5f0f\u3002"))),(0,a.kt)("h2",{id:"\u4e09\u5206\u5c42\u4e0b\u7684error-handling"},"\u4e09\u3001\u5206\u5c42\u4e0b\u7684Error Handling"),(0,a.kt)("h3",{id:"31\u4e00\u4e2a\u5e38\u89c1\u7684\u4e09\u5c42\u8c03\u7528"},"3.1\uff09\u4e00\u4e2a\u5e38\u89c1\u7684\u4e09\u5c42\u8c03\u7528"),(0,a.kt)("p",null,"\u5728\u5de5\u7a0b\u5b9e\u8df5\u4e2d\uff0c\u4ee5\u4e00\u4e2a\u5e38\u89c1\u7684\u4e09\u5c42\u67b6\u6784\uff08dao->service->controller\uff09\u4e3a\u4f8b\uff0c\u6211\u4eec\u5e38\u89c1\u7684\u9519\u8bef\u5904\u7406\u65b9\u5f0f\u5927\u81f4\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-plain",metastring:"text",text:!0},'// controller\nif err := mode.ParamCheck(param); err != nil {\n    log.Errorf("param=%+v", param)\n    return errs.ErrInvalidParam\n}\n\nreturn mode.ListTestName("")\n\n// service\n_, err := dao.GetTestName(ctx, settleId)\n    if err != nil {\n    log.Errorf("GetTestName failed. err: %v", err)\n    return errs.ErrDatabase\n}\n\n// dao\nif err != nil {\n    log.Errorf("GetTestDao failed. uery: %s error(%v)", sql, err)\n}\n')),(0,a.kt)("h3",{id:"32\u95ee\u9898\u603b\u7ed3"},"3.2\uff09\u95ee\u9898\u603b\u7ed3"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"\u5206\u5c42\u5f00\u53d1\u5bfc\u81f4\u7684\u5904\u5904\u6253\u5370\u65e5\u5fd7\uff1b")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"\u96be\u4ee5\u83b7\u53d6\u8be6\u7ec6\u7684\u5806\u6808\u5173\u8054\uff1b")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"\u6839\u56e0\u4e22\u5931\u3002"))),(0,a.kt)("h3",{id:"33wrap-erros"},"3.3\uff09Wrap erros"),(0,a.kt)("p",null,"Go\u76f8\u5173\u7684\u9519\u8bef\u5904\u7406\u65b9\u6cd5\u5f88\u591a\uff0c\u4f46\u5927\u591a\u4e3a\u8fc7\u6e21\u65b9\u6848\uff0c\u8fd9\u91cc\u5c31\u4e0d\u4e00\u4e00\u5206\u6790\u4e86\uff08\u7c7b\u4f3cgithub.com/juju/errors\u5e93\uff0c\u6709\u5174\u8da3\u53ef\u4ee5\u4e86\u89e3\uff09\u3002\u8fd9\u91cc\u6211\u4ee5github.com/pkg/errors\u4e3a\u4f8b\uff0c\u8fd9\u4e2a\u4e5f\u662f\u5b98\u65b9Proposal\u7684\u91cd\u70b9\u53c2\u8003\u5bf9\u8c61\u3002"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u9519\u8bef\u8981\u88ab\u65e5\u5fd7\u8bb0\u5f55\uff1b")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u5e94\u7528\u7a0b\u5e8f\u5904\u7406\u9519\u8bef\uff0c\u4fdd\u8bc1100%\u5b8c\u6574\u6027\uff1b")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u4e4b\u540e\u4e0d\u518d\u62a5\u544a\u5f53\u524d\u9519\u8bef\uff08\u9519\u8bef\u53ea\u88ab\u5904\u7406\u4e00\u6b21\uff09\u3002"))),(0,a.kt)("p",null,"github.com/pkg/errors\u5305\u4e3b\u8981\u5305\u542b\u4ee5\u4e0b\u51e0\u4e2a\u65b9\u6cd5\uff0c\u5982\u679c\u6211\u4eec\u8981\u65b0\u751f\u6210\u4e00\u4e2a\u9519\u8bef\uff0c\u53ef\u4ee5\u4f7f\u7528New\u51fd\u6570,\u751f\u6210\u7684\u9519\u8bef\uff0c\u81ea\u5e26\u8c03\u7528\u5806\u6808\u4fe1\u606f\u3002\u5982\u679c\u6709\u4e00\u4e2a\u73b0\u6210\u7684error \uff0c\u6211\u4eec\u9700\u8981\u5bf9\u4ed6\u8fdb\u884c\u518d\u6b21\u5305\u88c5\u5904\u7406\uff0c\u8fd9\u65f6\u5019\u6709\u4e09\u4e2a\u51fd\u6570\u53ef\u4ee5\u9009\u62e9\uff08WithMessage/WithStack/Wrapf\uff09\u3002\u5176\u6b21\uff0c\u5982\u679c\u9700\u8981\u5bf9\u6e90\u9519\u8bef\u7c7b\u578b\u8fdb\u884c\u81ea\u5b9a\u4e49\u5224\u65ad\u53ef\u4ee5\u4f7f\u7528Cause,\u53ef\u4ee5\u83b7\u5f97\u6700\u6839\u672c\u7684\u9519\u8bef\u539f\u56e0\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-plain",metastring:"text",text:!0},"// \u65b0\u751f\u6210\u4e00\u4e2a\u9519\u8bef, \u5e26\u5806\u6808\u4fe1\u606f\nfunc New(message string) error\n\n// \u53ea\u9644\u52a0\u65b0\u7684\u4fe1\u606f\nfunc WithMessage(err error, message string) error\n\n// \u53ea\u9644\u52a0\u8c03\u7528\u5806\u6808\u4fe1\u606f\nfunc WithStack(err error) error\n\n// \u540c\u65f6\u9644\u52a0\u5806\u6808\u548c\u4fe1\u606f\nfunc Wrapf(err error, format string, args ...interface{}) error\n\n// \u83b7\u5f97\u6700\u6839\u672c\u7684\u9519\u8bef\u539f\u56e0\nfunc Cause(err error) error\n")),(0,a.kt)("p",null,"\u4ee5\u5e38\u89c1\u7684\u4e00\u4e2a\u4e09\u5c42\u67b6\u6784\u4e3a\u4f8b\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Untitled",src:t(5115).Z,width:"734",height:"682"})),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Dao\u5c42\u4f7f\u7528Wrap\u4e0a\u629b\u9519\u8bef")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-plain",metastring:"text",text:!0},'  if err != nil {\n        if errors.Is(err, sql.ErrNoRows) {\n            return nil, errors.Wrapf(ierror.ErrNotFound, "query:%s", query)\n        }\n        return nil, errors.Wrapf(ierror.ErrDatabase,\n            "query: %s error(%v)", query, err)\n    }\n')),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Service\u5c42\u8ffd\u52a0\u4fe1\u606f")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-plain",metastring:"text",text:!0},'bills, err := a.Dao.GetName(ctx, param)\nif err != nil {\n    return result, errors.WithMessage(err, "GetName failed")\n}\n')),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"MiddleWare\u7edf\u4e00\u6253\u5370\u9519\u8bef\u65e5\u5fd7")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-plain",metastring:"text",text:!0},'// \u8bf7\u6c42\u54cd\u5e94\u7ec4\u88c5\nfunc (Format) Handle(next ihttp.MiddleFunc) ihttp.MiddleFunc {\n    return func(ctx context.Context, req *http.Request, rsp *ihttp.Response) error {\n        format := &format{Time: time.Now().Unix()}\n        err := next(ctx, req, rsp)\n        format.Data = rsp.Data\n        if err != nil {\n            format.Code, format.Msg = errCodes(ctx, err)\n        }\n        rsp.Data = format\n        return nil\n    }\n}\n\n// \u83b7\u53d6\u9519\u8bef\u7801\nfunc errCodes(ctx context.Context, err error) (int, string) {\n    if err != nil {\n        log.CtxErrorf(ctx, "error: [%+v]", err)\n    }\n    var myError = new(erro.IError)\n    if errors.As(err, &myError) {\n        return myError.Code, myError.Msg\n    }\n\n    return code.ServerError, i18n.CodeMessage(code.ServerError)\n}\n')),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u548c\u5176\u4ed6\u5e93\u8fdb\u884c\u534f\u4f5c")),(0,a.kt)("p",null,"\u5982\u679c\u548c\u5176\u4ed6\u5e93\u8fdb\u884c\u534f\u4f5c\uff0c\u8003\u8651\u4f7f\u7528errors.Wrap\u6216\u8005errors.Wrapf\u4fdd\u5b58\u5806\u6808\u4fe1\u606f\u3002\u540c\u6837\u9002\u7528\u4e8e\u548c\u6807\u51c6\u5e93\u534f\u4f5c\u7684\u65f6\u5019\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-plain",metastring:"text",text:!0},'_, err := os.Open(path)\nif err != nil {\n   return errors.Wrapf(err, "Open failed. [%s]", path)\n}\n')),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u5305\u5185\u5982\u679c\u8c03\u7528\u5176\u4ed6\u5305\u5185\u7684\u51fd\u6570\uff0c\u901a\u5e38\u7b80\u5355\u7684\u76f4\u63a5return err")),(0,a.kt)("p",null,"\u6700\u7ec8\u6548\u679c\u6837\u4f8b\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Untitled",src:t(683).Z,width:"1080",height:"160"})),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5173\u952e\u70b9\u603b\u7ed3"),"\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"MyError\u4f5c\u4e3a\u5168\u5c40error\u7684\u5e95\u5c42\u5b9e\u73b0\uff0c\u4fdd\u5b58\u5177\u4f53\u7684\u9519\u8bef\u7801\u548c\u9519\u8bef\u4fe1\u606f\uff1b")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"MyError\u5411\u4e0a\u8fd4\u56de\u9519\u8bef\u65f6\uff0c\u7b2c\u4e00\u6b21\u5148\u7528Wrap\u521d\u59cb\u5316\u5806\u6808\uff0c\u540e\u7eed\u7528WithMessage\u589e\u52a0\u5806\u6808\u4fe1\u606f\uff1b")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"\u8981\u5224\u65aderror\u662f\u5426\u4e3a\u6307\u5b9a\u7684\u9519\u8bef\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528errors.Cause\u83b7\u53d6root error\uff0c\u518d\u8fdb\u884c\u548csentinel error\u5224\u5b9a\uff1b")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"github.com/pkg/errors\u548c\u6807\u51c6\u5e93\u7684error\u5b8c\u5168\u517c\u5bb9\uff0c\u53ef\u4ee5\u5148\u66ff\u6362\u3001\u540e\u7eed\u6539\u9020\u5386\u53f2\u9057\u7559\u7684\u4ee3\u7801\uff1b")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"\u6253\u5370error\u7684\u5806\u6808\u9700\u8981\u7528%+v\uff0c\u800c\u539f\u6765\u7684%v\u4f9d\u65e7\u4e3a\u666e\u901a\u5b57\u7b26\u4e32\u65b9\u6cd5\uff1b\u540c\u65f6\u4e5f\u8981\u6ce8\u610f\u65e5\u5fd7\u91c7\u96c6\u5de5\u5177\u662f\u5426\u652f\u6301\u591a\u884c\u5339\u914d\uff1b")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"log error\u7ea7\u522b\u7684\u6253\u5370\u6808\uff0cwarn\u548cinfo\u53ef\u4e0d\u6253\u5370\u5806\u6808\uff1b")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"\u53ef\u7ed3\u5408\u7edf\u4e00\u9519\u8bef\u7801\u4f7f\u7528\uff1a"),(0,a.kt)("p",{parentName:"li"},(0,a.kt)("a",{parentName:"p",href:"https://google-cloud.gitbook.io/api-design-guide/errors"},"https://google-cloud.gitbook.io/api-design-guide/errors")))),(0,a.kt)("h2",{id:"\u56dberrgroup\u96c6\u4e2d\u9519\u8bef\u5904\u7406"},"\u56db\u3001errgroup\u96c6\u4e2d\u9519\u8bef\u5904\u7406"),(0,a.kt)("p",null,"\u5b98\u65b9\u7684ErrGroup\u975e\u5e38\u7b80\u5355\uff0c\u5176\u5b9e\u5c31\u662f\u89e3\u51b3\u5c0f\u578b\u591a\u4efb\u52a1\u5e76\u53d1\u4efb\u52a1\u3002\u57fa\u672c\u7528\u6cd5golang.org/x/sync/errgroup\u5305\u4e0b\u5b9a\u4e49\u4e86\u4e00\u4e2aGroup struct\uff0c\u5b83\u5c31\u662f\u6211\u4eec\u8981\u4ecb\u7ecd\u7684ErrGroup\u5e76\u53d1\u539f\u8bed\uff0c\u5e95\u5c42\u4e5f\u662f\u57fa\u4e8eWaitGroup\u5b9e\u73b0\u7684\u3002\u5728\u4f7f\u7528ErrGroup\u65f6\uff0c\u6211\u4eec\u8981\u7528\u5230\u4e09\u4e2a\u65b9\u6cd5\uff0c\u5206\u522b\u662fWithContext\u3001Go\u548cWait\u3002"),(0,a.kt)("h3",{id:"41\u80cc\u666f"},"4.1\uff09\u80cc\u666f"),(0,a.kt)("p",null,"\u901a\u5e38\uff0c\u5728\u5199\u4e1a\u52a1\u4ee3\u7801\u6027\u80fd\u4f18\u5316\u65f6\u7ecf\u5e38\u5c06\u4e00\u4e2a\u901a\u7528\u7684\u7236\u4efb\u52a1\u62c6\u6210\u51e0\u4e2a\u5c0f\u4efb\u52a1\u5e76\u53d1\u6267\u884c\u3002\u6b64\u65f6\u9700\u8981\u5c06\u4e00\u4e2a\u5927\u7684\u4efb\u52a1\u62c6\u6210\u51e0\u4e2a\u5c0f\u4efb\u52a1\u5e76\u53d1\u6267\u884c\uff0c\u6765\u63d0\u9ad8QPS\uff0c\u6211\u4eec\u9700\u8981\u518d\u4e1a\u52a1\u4ee3\u7801\u91cc\u5d4c\u5165\u4ee5\u4e0b\u903b\u8f91\uff0c\u4f46\u8fd9\u79cd\u65b9\u5f0f\u5b58\u5728\u95ee\u9898\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"\u6bcf\u4e2a\u8bf7\u6c42\u90fd\u5f00\u542fgoroutinue\uff0c\u4f1a\u6709\u4e00\u5b9a\u7684\u6027\u80fd\u5f00\u9500\u3002")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"\u91ce\u751f\u7684goroutinue\uff0c\u751f\u547d\u5468\u671f\u7ba1\u7406\u6bd4\u8f83\u56f0\u96be\u3002")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"\u6536\u5230\u7c7b\u4f3cSIGQUIT\u4fe1\u53f7\u65f6\uff0c\u65e0\u6cd5\u5e73\u6ed1\u9000\u51fa\u3002"))),(0,a.kt)("h3",{id:"42errgroup\u51fd\u6570\u7b7e\u540d"},"4.2\uff09errgroup\u51fd\u6570\u7b7e\u540d"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-plain",metastring:"text",text:!0},"type Group\n    func WithContext(ctx context.Context) (*Group, context.Context)\n    func (g *Group) Go(f func() error)\n    func (g *Group) Wait() error\n")),(0,a.kt)("p",null,"\u6574\u4e2a\u5305\u5c31\u4e00\u4e2aGroup\u7ed3\u6784\u4f53\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"\u901a\u8fc7WithContext\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u5e26\u53d6\u6d88\u7684Group\uff1b")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"\u5f53\u7136\u9664\u6b64\u4e4b\u5916\u4e5f\u53ef\u4ee5\u96f6\u503c\u7684Group\u4e5f\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\uff0c\u4f46\u662f\u51fa\u9519\u4e4b\u540e\u5c31\u4e0d\u4f1a\u53d6\u6d88\u5176\u4ed6\u7684goroutine\u4e86\uff1b")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Go\u65b9\u6cd5\u4f20\u5165\u4e00\u4e2afunc() error\u5185\u90e8\u4f1a\u542f\u52a8\u4e00\u4e2agoroutine\u53bb\u5904\u7406\uff1b")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Wait\u7c7b\u4f3cWaitGroup\u7684Wait\u65b9\u6cd5\uff0c\u7b49\u5f85\u6240\u6709\u7684goroutine\u7ed3\u675f\u540e\u9000\u51fa\uff0c\u8fd4\u56de\u7684\u9519\u8bef\u662f\u4e00\u4e2a\u51fa\u9519\u7684err\u3002"))),(0,a.kt)("h3",{id:"43\u4f7f\u7528\u6848\u4f8b"},"4.3\uff09\u4f7f\u7528\u6848\u4f8b"),(0,a.kt)("p",null,"\u6ce8\u610f\u8fd9\u91cc\u6709\u4e00\u4e2a\u5751\uff0c\u5728\u540e\u9762\u7684\u4ee3\u7801\u4e2d\u4e0d\u8981\u628actx\u5f53\u505a\u7236 context\u53c8\u4f20\u7ed9\u4e0b\u6e38\uff0c\u56e0\u4e3aerrgroup\u53d6\u6d88\u4e86\uff0c\u8fd9\u4e2acontext\u5c31\u6ca1\u7528\u4e86\uff0c\u4f1a\u5bfc\u81f4\u4e0b\u6e38\u590d\u7528\u7684\u65f6\u5019\u51fa\u9519"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-plain",metastring:"text",text:!0},'func TestErrgroup() {\n   eg, ctx := errgroup.WithContext(context.Background())\n   for i := 0; i < 100; i++ {\n      i := i\n      eg.Go(func() error {\n         time.Sleep(2 * time.Second)\n         select {\n         case <-ctx.Done():\n            fmt.Println("Canceled:", i)\n            return nil\n         default:\n            fmt.Println("End:", i)\n            return nil\n         }})}\n   if err := eg.Wait(); err != nil {\n      log.Fatal(err)\n   }\n}\n')),(0,a.kt)("h3",{id:"44errgroup\u62d3\u5c55\u5305"},"4.4\uff09errgroup\u62d3\u5c55\u5305"),(0,a.kt)("p",null,"B\u7ad9\u62d3\u5c55\u5305"),(0,a.kt)("p",null,"\uff08",(0,a.kt)("a",{parentName:"p",href:"https://github.com/go-kratos/kratos/blob/v0.3.3/pkg/sync/errgroup/errgroup.go%EF%BC%89"},"https://github.com/go-kratos/kratos/blob/v0.3.3/pkg/sync/errgroup/errgroup.go\uff09")),(0,a.kt)("p",null,"\u76f8\u6bd4\u5b98\u65b9\u7684\u7ed3\u6784\uff0cB\u7ad9\u7684\u7ed3\u6784\u591a\u51fa\u4e86\u4e00\u4e2a\u51fd\u6570\u7b7e\u540d\u7ba1\u9053\u548c\u4e00\u4e2a\u51fd\u6570\u7b7e\u540d\u5207\u7247,\u5e76\u628aContext\u76f4\u63a5\u653e\u5165\u4e86\u8fd4\u56de\u7684Group\u7ed3\u6784\uff0c\u8fd4\u56de\u4ec5\u8fd4\u56de\u4e00\u4e2aGroup\u7ed3\u6784\u6307\u9488\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-plain",metastring:"text",text:!0},"type Group struct {\n   err     error\n   wg      sync.WaitGroup\n   errOnce sync.Once\n\n   workerOnce sync.Once\n   ch         chan func(ctx context.Context) error\n   chs        []func(ctx context.Context) error\n\n   ctx    context.Context\n   cancel func()\n}\n\nfunc WithContext(ctx context.Context) *Group {\n   return &Group{ctx: ctx}\n}\n")),(0,a.kt)("p",null,"Go\u65b9\u6cd5\u53ef\u4ee5\u770b\u51fa\u5e76\u4e0d\u662f\u76f4\u63a5\u8d77\u534f\u7a0b\u7684\uff08\u5982\u679c\u7ba1\u9053\u5df2\u7ecf\u521d\u59cb\u5316\u597d\u4e86\uff09\uff0c\u800c\u662f\u4f18\u5148\u5c06\u51fd\u6570\u7b7e\u540d\u653e\u5165\u7ba1\u9053\uff0c\u7ba1\u9053\u5982\u679c\u6ee1\u4e86\u5c31\u653e\u5165\u5207\u7247\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-plain",metastring:"text",text:!0},"func (g *Group) Go(f func(ctx context.Context) error) {\n   g.wg.Add(1)\n   if g.ch != nil {\n      select {\n      case g.ch <- f:\n      default:\n         g.chs = append(g.chs, f)\n      }\n      return\n   }\n   go g.do(f)\n}\n")),(0,a.kt)("p",null,"GOMAXPROCS\u51fd\u6570\u5176\u5b9e\u662f\u8d77\u4e86\u4e00\u4e2a\u5e76\u53d1\u6c60\u6765\u63a7\u5236\u534f\u7a0b\u6570\u91cf\uff0c\u4f20\u5165\u6700\u5927\u534f\u7a0b\u6570\u91cf\u8fdb\u884c\u5e76\u53d1\u6d88\u8d39\u7ba1\u9053\u91cc\u7684\u51fd\u6570\u7b7e\u540d\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-plain",metastring:"text",text:!0},'func (g *Group) GOMAXPROCS(n int) {\n   if n <= 0 {\n      panic("errgroup: GOMAXPROCS must great than 0")\n   }\n   g.workerOnce.Do(func() {\n      g.ch = make(chan func(context.Context) error, n)\n      for i := 0; i < n; i++ {\n         go func() {\n            for f := range g.ch {\n               g.do(f)\n            }\n         }()\n      }\n   })\n}\n')),(0,a.kt)("p",null,"\u6574\u4e2a\u6d41\u7a0b\u68b3\u7406\u4e0b\u6765\u5176\u5b9e\u5c31\u662f\u542f\u52a8\u4e00\u4e2a\u56fa\u5b9a\u6570\u91cf\u7684\u5e76\u53d1\u6c60\u6d88\u8d39\u4efb\u52a1\uff0cGo\u51fd\u6570\u5176\u5b9e\u662f\u5411\u7ba1\u9053\u4e2d\u53d1\u9001\u4efb\u52a1\u7684\u751f\u4ea7\u8005\uff0c\u8fd9\u4e2a\u8bbe\u8ba1\u4e2d\u6709\u610f\u601d\u7684\u662f\u4ed6\u7684\u534f\u7a0b\u751f\u547d\u5468\u671f\u7684\u63a7\u5236\uff0c\u4ed6\u7684\u63a7\u5236\u65b9\u5f0f\u662f\u6bcf\u53d1\u9001\u4e00\u4e2a\u4efb\u52a1\u90fd\u8fdb\u884cWaitGroup\u52a0\u4e00\uff0c\u5728\u6700\u540e\u7ed3\u675f\u65f6\u7684wait\u51fd\u6570\u4e2d\u8fdb\u884c\u7b49\u5f85\uff0c\u7b49\u5f85\u6240\u6709\u7684\u8bf7\u6c42\u90fd\u5904\u7406\u5b8c\u624d\u4f1a\u5173\u95ed\u7ba1\u9053\uff0c\u8fd4\u51fa\u9519\u8bef\u3002"),(0,a.kt)("br",null),(0,a.kt)("p",null,"\ud83d\udca1 \u5907\u6ce8\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"B\u7ad9\u62d3\u5c55\u5305\u4e3b\u8981\u89e3\u51b3\u4e86\u5b98\u65b9ErrGroup\u7684\u51e0\u4e2a\u75db\u70b9\uff1a\u63a7\u5236\u5e76\u53d1\u91cf\u3001Recover\u4f4f\u534f\u7a0b\u7684Panic\u5e76\u6253\u51fa\u5806\u6808\u4fe1\u606f\u3002")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Go\u65b9\u6cd5\u5e76\u53d1\u7684\u53bb\u8c03\u7528\u5728\u91cf\u5f88\u591a\u7684\u60c5\u51b5\u4e0b\u4f1a\u4ea7\u751f\u6b7b\u9501\uff0c\u56e0\u4e3a\u4ed6\u7684\u5207\u7247\u4e0d\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u5982\u679c\u8981\u5e76\u53d1\uff0c\u5e76\u53d1\u6570\u91cf\u4e00\u5b9a\u4e0d\u80fd\u8fc7\u5927\uff0c\u4e00\u65e6\u52a8\u7528\u4e86\u4efb\u52a1\u5207\u7247\uff0c\u90a3\u4e48\u5f88\u6709\u53ef\u80fd\u5c31\u5728wait\u65b9\u6cd5\u90a3\u91cchold\u4f4f\u4e86\u3002\u8fd9\u4e2a\u53ef\u4ee5\u52a0\u4e2a\u9501\u6765\u4f18\u5316\u3002")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Wg watigroup\u53ea\u5728Go\u65b9\u6cd5\u4e2d\u8fdb\u884cAdd()\uff0c\u5e76\u6ca1\u6709\u63a7\u5236\u6d88\u8d39\u8005\u7684\u5e76\u53d1\uff0cWait\u7684\u903b\u8f91\u5c31\u662f\u5206\u53d1\u8005\u90fd\u5206\u53d1\u5b8c\u6210\uff0c\u76f4\u63a5\u5173\u95ed\u7ba1\u9053\uff0c\u8ba9\u6d88\u8d39\u8005\u5e76\u53d1\u6c60\u81ea\u884c\u9500\u6bc1\uff0c\u4e0d\u53bb\u7ba1\u63a7\uff0c\u4e00\u65e6\u903b\u8f91\u4e2d\u6709\u5b8c\u5168hold\u4f4f\u7684\u65b9\u6cd5\u90a3\u4e48\u5bb9\u6613\u4ea7\u751f\u5185\u5b58\u6cc4\u6f0f\u3002"))),(0,a.kt)("br",null),(0,a.kt)("br",null))}s.isMDXComponent=!0},683:(r,e,t)=>{t.d(e,{Z:()=>n});const n=t.p+"assets/images/a836e552b6b57d21-14a94a8cd66480adb545ba8d22011f8c.png"},8170:(r,e,t)=>{t.d(e,{Z:()=>n});const n=t.p+"assets/images/d27045fe0d2c747f-b50b75fbf470160703fdb2213ec26ba3.png"},5115:(r,e,t)=>{t.d(e,{Z:()=>n});const n=t.p+"assets/images/ea01c0de85c29001-2ef176c8f001c68f66ae7bf7e9c5ed78.png"}}]);